/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/
var Box2D={};(function(e,t){function n(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(e,t,n){if(n.get instanceof Function)e.__defineGetter__(t,n.get);if(n.set instanceof Function)e.__defineSetter__(t,n.set)}}e.inherit=function(e,t){var r=e;n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=r};e.generateCallback=function(t,n){return function(){n.apply(t,arguments)}};e.NVector=function(n){if(n===t)n=0;var r=new Array(n||0);for(var i=0;i<n;++i)r[i]=0;return r};e.is=function(n,r){if(n===null)return false;if(r instanceof Function&&n instanceof r)return true;if(n.constructor.__implements!=t&&n.constructor.__implements[r])return true;return false};e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments);if(this.constructor===n)this.b2BoundValues.apply(this,arguments)}function r(){r.b2Collision.apply(this,arguments)}function i(){i.b2ContactID.apply(this,arguments);if(this.constructor===i)this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function o(){o.b2Distance.apply(this,arguments)}function u(){u.b2DistanceInput.apply(this,arguments)}function a(){a.b2DistanceOutput.apply(this,arguments)}function f(){f.b2DistanceProxy.apply(this,arguments)}function l(){l.b2DynamicTree.apply(this,arguments);if(this.constructor===l)this.b2DynamicTree.apply(this,arguments)}function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}function h(){h.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function d(){d.b2Manifold.apply(this,arguments);if(this.constructor===d)this.b2Manifold.apply(this,arguments)}function v(){v.b2ManifoldPoint.apply(this,arguments);if(this.constructor===v)this.b2ManifoldPoint.apply(this,arguments)}function m(){m.b2Point.apply(this,arguments)}function g(){g.b2RayCastInput.apply(this,arguments);if(this.constructor===g)this.b2RayCastInput.apply(this,arguments)}function y(){y.b2RayCastOutput.apply(this,arguments)}function b(){b.b2Segment.apply(this,arguments)}function w(){w.b2SeparationFunction.apply(this,arguments)}function E(){E.b2Simplex.apply(this,arguments);if(this.constructor===E)this.b2Simplex.apply(this,arguments)}function S(){S.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function T(){T.b2TimeOfImpact.apply(this,arguments)}function N(){N.b2TOIInput.apply(this,arguments)}function C(){C.b2WorldManifold.apply(this,arguments);if(this.constructor===C)this.b2WorldManifold.apply(this,arguments)}function k(){k.ClipVertex.apply(this,arguments)}function L(){L.Features.apply(this,arguments)}function A(){A.b2CircleShape.apply(this,arguments);if(this.constructor===A)this.b2CircleShape.apply(this,arguments)}function O(){O.b2EdgeChainDef.apply(this,arguments);if(this.constructor===O)this.b2EdgeChainDef.apply(this,arguments)}function M(){M.b2EdgeShape.apply(this,arguments);if(this.constructor===M)this.b2EdgeShape.apply(this,arguments)}function _(){_.b2MassData.apply(this,arguments)}function D(){D.b2PolygonShape.apply(this,arguments);if(this.constructor===D)this.b2PolygonShape.apply(this,arguments)}function P(){P.b2Shape.apply(this,arguments);if(this.constructor===P)this.b2Shape.apply(this,arguments)}function H(){H.b2Color.apply(this,arguments);if(this.constructor===H)this.b2Color.apply(this,arguments)}function B(){B.b2Settings.apply(this,arguments)}function j(){j.b2Mat22.apply(this,arguments);if(this.constructor===j)this.b2Mat22.apply(this,arguments)}function F(){F.b2Mat33.apply(this,arguments);if(this.constructor===F)this.b2Mat33.apply(this,arguments)}function I(){I.b2Math.apply(this,arguments)}function q(){q.b2Sweep.apply(this,arguments)}function R(){R.b2Transform.apply(this,arguments);if(this.constructor===R)this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments);if(this.constructor===U)this.b2Vec2.apply(this,arguments)}function z(){z.b2Vec3.apply(this,arguments);if(this.constructor===z)this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments);if(this.constructor===W)this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments);if(this.constructor===X)this.b2BodyDef.apply(this,arguments)}function V(){V.b2ContactFilter.apply(this,arguments)}function $(){$.b2ContactImpulse.apply(this,arguments)}function J(){J.b2ContactListener.apply(this,arguments)}function K(){K.b2ContactManager.apply(this,arguments);if(this.constructor===K)this.b2ContactManager.apply(this,arguments)}function Q(){Q.b2DebugDraw.apply(this,arguments);if(this.constructor===Q)this.b2DebugDraw.apply(this,arguments)}function G(){G.b2DestructionListener.apply(this,arguments)}function Y(){Y.b2FilterData.apply(this,arguments)}function Z(){Z.b2Fixture.apply(this,arguments);if(this.constructor===Z)this.b2Fixture.apply(this,arguments)}function et(){et.b2FixtureDef.apply(this,arguments);if(this.constructor===et)this.b2FixtureDef.apply(this,arguments)}function tt(){tt.b2Island.apply(this,arguments);if(this.constructor===tt)this.b2Island.apply(this,arguments)}function nt(){nt.b2TimeStep.apply(this,arguments)}function rt(){rt.b2World.apply(this,arguments);if(this.constructor===rt)this.b2World.apply(this,arguments)}function it(){it.b2CircleContact.apply(this,arguments)}function st(){st.b2Contact.apply(this,arguments);if(this.constructor===st)this.b2Contact.apply(this,arguments)}function ot(){ot.b2ContactConstraint.apply(this,arguments);if(this.constructor===ot)this.b2ContactConstraint.apply(this,arguments)}function ut(){ut.b2ContactConstraintPoint.apply(this,arguments)}function at(){at.b2ContactEdge.apply(this,arguments)}function ft(){ft.b2ContactFactory.apply(this,arguments);if(this.constructor===ft)this.b2ContactFactory.apply(this,arguments)}function lt(){lt.b2ContactRegister.apply(this,arguments)}function ct(){ct.b2ContactResult.apply(this,arguments)}function ht(){ht.b2ContactSolver.apply(this,arguments);if(this.constructor===ht)this.b2ContactSolver.apply(this,arguments)}function pt(){pt.b2EdgeAndCircleContact.apply(this,arguments)}function dt(){dt.b2NullContact.apply(this,arguments);if(this.constructor===dt)this.b2NullContact.apply(this,arguments)}function vt(){vt.b2PolyAndCircleContact.apply(this,arguments)}function mt(){mt.b2PolyAndEdgeContact.apply(this,arguments)}function gt(){gt.b2PolygonContact.apply(this,arguments)}function yt(){yt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===yt)this.b2PositionSolverManifold.apply(this,arguments)}function bt(){bt.b2BuoyancyController.apply(this,arguments)}function wt(){wt.b2ConstantAccelController.apply(this,arguments)}function Et(){Et.b2ConstantForceController.apply(this,arguments)}function St(){St.b2Controller.apply(this,arguments)}function xt(){xt.b2ControllerEdge.apply(this,arguments)}function Tt(){Tt.b2GravityController.apply(this,arguments)}function Nt(){Nt.b2TensorDampingController.apply(this,arguments)}function Ct(){Ct.b2DistanceJoint.apply(this,arguments);if(this.constructor===Ct)this.b2DistanceJoint.apply(this,arguments)}function kt(){kt.b2DistanceJointDef.apply(this,arguments);if(this.constructor===kt)this.b2DistanceJointDef.apply(this,arguments)}function Lt(){Lt.b2FrictionJoint.apply(this,arguments);if(this.constructor===Lt)this.b2FrictionJoint.apply(this,arguments)}function At(){At.b2FrictionJointDef.apply(this,arguments);if(this.constructor===At)this.b2FrictionJointDef.apply(this,arguments)}function Ot(){Ot.b2GearJoint.apply(this,arguments);if(this.constructor===Ot)this.b2GearJoint.apply(this,arguments)}function Mt(){Mt.b2GearJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2GearJointDef.apply(this,arguments)}function _t(){_t.b2Jacobian.apply(this,arguments)}function Dt(){Dt.b2Joint.apply(this,arguments);if(this.constructor===Dt)this.b2Joint.apply(this,arguments)}function Pt(){Pt.b2JointDef.apply(this,arguments);if(this.constructor===Pt)this.b2JointDef.apply(this,arguments)}function Ht(){Ht.b2JointEdge.apply(this,arguments)}function Bt(){Bt.b2LineJoint.apply(this,arguments);if(this.constructor===Bt)this.b2LineJoint.apply(this,arguments)}function jt(){jt.b2LineJointDef.apply(this,arguments);if(this.constructor===jt)this.b2LineJointDef.apply(this,arguments)}function Ft(){Ft.b2MouseJoint.apply(this,arguments);if(this.constructor===Ft)this.b2MouseJoint.apply(this,arguments)}function It(){It.b2MouseJointDef.apply(this,arguments);if(this.constructor===It)this.b2MouseJointDef.apply(this,arguments)}function qt(){qt.b2PrismaticJoint.apply(this,arguments);if(this.constructor===qt)this.b2PrismaticJoint.apply(this,arguments)}function Rt(){Rt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===Rt)this.b2PrismaticJointDef.apply(this,arguments)}function Ut(){Ut.b2PulleyJoint.apply(this,arguments);if(this.constructor===Ut)this.b2PulleyJoint.apply(this,arguments)}function zt(){zt.b2PulleyJointDef.apply(this,arguments);if(this.constructor===zt)this.b2PulleyJointDef.apply(this,arguments)}function Wt(){Wt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Wt)this.b2RevoluteJoint.apply(this,arguments)}function Xt(){Xt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Xt)this.b2RevoluteJointDef.apply(this,arguments)}function Vt(){Vt.b2WeldJoint.apply(this,arguments);if(this.constructor===Vt)this.b2WeldJoint.apply(this,arguments)}function $t(){$t.b2WeldJointDef.apply(this,arguments);if(this.constructor===$t)this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=e;Box2D.Collision.b2Bound=t;Box2D.Collision.b2BoundValues=n;Box2D.Collision.b2Collision=r;Box2D.Collision.b2ContactID=i;Box2D.Collision.b2ContactPoint=s;Box2D.Collision.b2Distance=o;Box2D.Collision.b2DistanceInput=u;Box2D.Collision.b2DistanceOutput=a;Box2D.Collision.b2DistanceProxy=f;Box2D.Collision.b2DynamicTree=l;Box2D.Collision.b2DynamicTreeBroadPhase=c;Box2D.Collision.b2DynamicTreeNode=h;Box2D.Collision.b2DynamicTreePair=p;Box2D.Collision.b2Manifold=d;Box2D.Collision.b2ManifoldPoint=v;Box2D.Collision.b2Point=m;Box2D.Collision.b2RayCastInput=g;Box2D.Collision.b2RayCastOutput=y;Box2D.Collision.b2Segment=b;Box2D.Collision.b2SeparationFunction=w;Box2D.Collision.b2Simplex=E;Box2D.Collision.b2SimplexCache=S;Box2D.Collision.b2SimplexVertex=x;Box2D.Collision.b2TimeOfImpact=T;Box2D.Collision.b2TOIInput=N;Box2D.Collision.b2WorldManifold=C;Box2D.Collision.ClipVertex=k;Box2D.Collision.Features=L;Box2D.Collision.Shapes.b2CircleShape=A;Box2D.Collision.Shapes.b2EdgeChainDef=O;Box2D.Collision.Shapes.b2EdgeShape=M;Box2D.Collision.Shapes.b2MassData=_;Box2D.Collision.Shapes.b2PolygonShape=D;Box2D.Collision.Shapes.b2Shape=P;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=H;Box2D.Common.b2Settings=B;Box2D.Common.Math.b2Mat22=j;Box2D.Common.Math.b2Mat33=F;Box2D.Common.Math.b2Math=I;Box2D.Common.Math.b2Sweep=q;Box2D.Common.Math.b2Transform=R;Box2D.Common.Math.b2Vec2=U;Box2D.Common.Math.b2Vec3=z;Box2D.Dynamics.b2Body=W;Box2D.Dynamics.b2BodyDef=X;Box2D.Dynamics.b2ContactFilter=V;Box2D.Dynamics.b2ContactImpulse=$;Box2D.Dynamics.b2ContactListener=J;Box2D.Dynamics.b2ContactManager=K;Box2D.Dynamics.b2DebugDraw=Q;Box2D.Dynamics.b2DestructionListener=G;Box2D.Dynamics.b2FilterData=Y;Box2D.Dynamics.b2Fixture=Z;Box2D.Dynamics.b2FixtureDef=et;Box2D.Dynamics.b2Island=tt;Box2D.Dynamics.b2TimeStep=nt;Box2D.Dynamics.b2World=rt;Box2D.Dynamics.Contacts.b2CircleContact=it;Box2D.Dynamics.Contacts.b2Contact=st;Box2D.Dynamics.Contacts.b2ContactConstraint=ot;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ut;Box2D.Dynamics.Contacts.b2ContactEdge=at;Box2D.Dynamics.Contacts.b2ContactFactory=ft;Box2D.Dynamics.Contacts.b2ContactRegister=lt;Box2D.Dynamics.Contacts.b2ContactResult=ct;Box2D.Dynamics.Contacts.b2ContactSolver=ht;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pt;Box2D.Dynamics.Contacts.b2NullContact=dt;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=vt;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=mt;Box2D.Dynamics.Contacts.b2PolygonContact=gt;Box2D.Dynamics.Contacts.b2PositionSolverManifold=yt;Box2D.Dynamics.Controllers.b2BuoyancyController=bt;Box2D.Dynamics.Controllers.b2ConstantAccelController=wt;Box2D.Dynamics.Controllers.b2ConstantForceController=Et;Box2D.Dynamics.Controllers.b2Controller=St;Box2D.Dynamics.Controllers.b2ControllerEdge=xt;Box2D.Dynamics.Controllers.b2GravityController=Tt;Box2D.Dynamics.Controllers.b2TensorDampingController=Nt;Box2D.Dynamics.Joints.b2DistanceJoint=Ct;Box2D.Dynamics.Joints.b2DistanceJointDef=kt;Box2D.Dynamics.Joints.b2FrictionJoint=Lt;Box2D.Dynamics.Joints.b2FrictionJointDef=At;Box2D.Dynamics.Joints.b2GearJoint=Ot;Box2D.Dynamics.Joints.b2GearJointDef=Mt;Box2D.Dynamics.Joints.b2Jacobian=_t;Box2D.Dynamics.Joints.b2Joint=Dt;Box2D.Dynamics.Joints.b2JointDef=Pt;Box2D.Dynamics.Joints.b2JointEdge=Ht;Box2D.Dynamics.Joints.b2LineJoint=Bt;Box2D.Dynamics.Joints.b2LineJointDef=jt;Box2D.Dynamics.Joints.b2MouseJoint=Ft;Box2D.Dynamics.Joints.b2MouseJointDef=It;Box2D.Dynamics.Joints.b2PrismaticJoint=qt;Box2D.Dynamics.Joints.b2PrismaticJointDef=Rt;Box2D.Dynamics.Joints.b2PulleyJoint=Ut;Box2D.Dynamics.Joints.b2PulleyJointDef=zt;Box2D.Dynamics.Joints.b2RevoluteJoint=Wt;Box2D.Dynamics.Joints.b2RevoluteJointDef=Xt;Box2D.Dynamics.Joints.b2WeldJoint=Vt;Box2D.Dynamics.Joints.b2WeldJointDef=$t})();Box2D.postDefs=[];(function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,o=Box2D.Common.b2Color,u=Box2D.Common.b2internal,a=Box2D.Common.b2Settings,f=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,v=Box2D.Common.Math.b2Vec3,m=Box2D.Collision.b2AABB,g=Box2D.Collision.b2Bound,y=Box2D.Collision.b2BoundValues,b=Box2D.Collision.b2Collision,w=Box2D.Collision.b2ContactID,E=Box2D.Collision.b2ContactPoint,S=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,T=Box2D.Collision.b2DistanceOutput,N=Box2D.Collision.b2DistanceProxy,C=Box2D.Collision.b2DynamicTree,k=Box2D.Collision.b2DynamicTreeBroadPhase,L=Box2D.Collision.b2DynamicTreeNode,A=Box2D.Collision.b2DynamicTreePair,O=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,_=Box2D.Collision.b2Point,D=Box2D.Collision.b2RayCastInput,P=Box2D.Collision.b2RayCastOutput,H=Box2D.Collision.b2Segment,B=Box2D.Collision.b2SeparationFunction,j=Box2D.Collision.b2Simplex,F=Box2D.Collision.b2SimplexCache,I=Box2D.Collision.b2SimplexVertex,q=Box2D.Collision.b2TimeOfImpact,R=Box2D.Collision.b2TOIInput,U=Box2D.Collision.b2WorldManifold,z=Box2D.Collision.ClipVertex,W=Box2D.Collision.Features,X=Box2D.Collision.IBroadPhase;m.b2AABB=function(){this.lowerBound=new d;this.upperBound=new d};m.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x;var t=this.upperBound.y-this.lowerBound.y;var n=e>=0&&t>=0;n=n&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return n};m.prototype.GetCenter=function(){return new d((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};m.prototype.GetExtents=function(){return new d((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};m.prototype.Contains=function(e){var t=true;t=t&&this.lowerBound.x<=e.lowerBound.x;t=t&&this.lowerBound.y<=e.lowerBound.y;t=t&&e.upperBound.x<=this.upperBound.x;t=t&&e.upperBound.y<=this.upperBound.y;return t};m.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE;var r=Number.MAX_VALUE;var i=t.p1.x;var s=t.p1.y;var o=t.p2.x-t.p1.x;var u=t.p2.y-t.p1.y;var a=Math.abs(o);var f=Math.abs(u);var l=e.normal;var c=0;var h=0;var p=0;var d=0;var v=0;{if(a<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return false}else{c=1/o;h=(this.lowerBound.x-i)*c;p=(this.upperBound.x-i)*c;v=-1;if(h>p){d=h;h=p;p=d;v=1}if(h>n){l.x=v;l.y=0;n=h}r=Math.min(r,p);if(n>r)return false}}{if(f<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return false}else{c=1/u;h=(this.lowerBound.y-s)*c;p=(this.upperBound.y-s)*c;v=-1;if(h>p){d=h;h=p;p=d;v=1}if(h>n){l.y=v;l.x=0;n=h}r=Math.min(r,p);if(n>r)return false}}e.fraction=n;return true};m.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x;var n=e.lowerBound.y-this.upperBound.y;var r=this.lowerBound.x-e.upperBound.x;var i=this.lowerBound.y-e.upperBound.y;if(t>0||n>0)return false;if(r>0||i>0)return false;return true};m.Combine=function(e,t){var n=new m;n.Combine(e,t);return n};m.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x);this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y);this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x);this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)};g.b2Bound=function(){};g.prototype.IsLower=function(){return(this.value&1)==0};g.prototype.IsUpper=function(){return(this.value&1)==1};g.prototype.Swap=function(e){var t=this.value;var n=this.proxy;var r=this.stabbingCount;this.value=e.value;this.proxy=e.proxy;this.stabbingCount=e.stabbingCount;e.value=t;e.proxy=n;e.stabbingCount=r};y.b2BoundValues=function(){};y.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};b.b2Collision=function(){};b.ClipSegmentToLine=function(e,t,n,r){if(r===undefined)r=0;var i;var s=0;i=t[0];var o=i.v;i=t[1];var u=i.v;var a=n.x*o.x+n.y*o.y-r;var f=n.x*u.x+n.y*u.y-r;if(a<=0)e[s++].Set(t[0]);if(f<=0)e[s++].Set(t[1]);if(a*f<0){var l=a/(a-f);i=e[s];var c=i.v;c.x=o.x+l*(u.x-o.x);c.y=o.y+l*(u.y-o.y);i=e[s];var h;if(a>0){h=t[0];i.id=h.id}else{h=t[1];i.id=h.id}++s}return s};b.EdgeSeparation=function(e,t,n,r,i){if(n===undefined)n=0;var s=parseInt(e.m_vertexCount);var o=e.m_vertices;var u=e.m_normals;var a=parseInt(r.m_vertexCount);var f=r.m_vertices;var l;var c;l=t.R;c=u[n];var h=l.col1.x*c.x+l.col2.x*c.y;var p=l.col1.y*c.x+l.col2.y*c.y;l=i.R;var d=l.col1.x*h+l.col1.y*p;var v=l.col2.x*h+l.col2.y*p;var m=0;var g=Number.MAX_VALUE;for(var y=0;y<a;++y){c=f[y];var b=c.x*d+c.y*v;if(b<g){g=b;m=y}}c=o[n];l=t.R;var w=t.position.x+(l.col1.x*c.x+l.col2.x*c.y);var E=t.position.y+(l.col1.y*c.x+l.col2.y*c.y);c=f[m];l=i.R;var S=i.position.x+(l.col1.x*c.x+l.col2.x*c.y);var x=i.position.y+(l.col1.y*c.x+l.col2.y*c.y);S-=w;x-=E;var T=S*h+x*p;return T};b.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount);var o=t.m_normals;var u;var a;a=i.R;u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y);var l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R;u=t.m_centroid;f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y);l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y);var c=f*n.R.col1.x+l*n.R.col1.y;var h=f*n.R.col2.x+l*n.R.col2.y;var p=0;var d=-Number.MAX_VALUE;for(var v=0;v<s;++v){u=o[v];var m=u.x*c+u.y*h;if(m>d){d=m;p=v}}var g=b.EdgeSeparation(t,n,p,r,i);var y=parseInt(p-1>=0?p-1:s-1);var w=b.EdgeSeparation(t,n,y,r,i);var E=parseInt(p+1<s?p+1:0);var S=b.EdgeSeparation(t,n,E,r,i);var x=0;var T=0;var N=0;if(w>g&&w>S){N=-1;x=y;T=w}else if(S>g){N=1;x=E;T=S}else{e[0]=p;return g}while(true){if(N==-1)p=x-1>=0?x-1:s-1;else p=x+1<s?x+1:0;g=b.EdgeSeparation(t,n,p,r,i);if(g>T){x=p;T=g}else{break}}e[0]=x;return T};b.FindIncidentEdge=function(e,t,n,r,i,s){if(r===undefined)r=0;var o=parseInt(t.m_vertexCount);var u=t.m_normals;var a=parseInt(i.m_vertexCount);var f=i.m_vertices;var l=i.m_normals;var c;var h;c=n.R;h=u[r];var p=c.col1.x*h.x+c.col2.x*h.y;var d=c.col1.y*h.x+c.col2.y*h.y;c=s.R;var v=c.col1.x*p+c.col1.y*d;d=c.col2.x*p+c.col2.y*d;p=v;var m=0;var g=Number.MAX_VALUE;for(var y=0;y<a;++y){h=l[y];var b=p*h.x+d*h.y;if(b<g){g=b;m=y}}var w;var E=parseInt(m);var S=parseInt(E+1<a?E+1:0);w=e[0];h=f[E];c=s.R;w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y);w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y);w.id.features.referenceEdge=r;w.id.features.incidentEdge=E;w.id.features.incidentVertex=0;w=e[1];h=f[S];c=s.R;w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y);w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y);w.id.features.referenceEdge=r;w.id.features.incidentEdge=S;w.id.features.incidentVertex=1};b.MakeClipPointVector=function(){var e=new Vector(2);e[0]=new z;e[1]=new z;return e};b.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var o=t.m_radius+r.m_radius;var u=0;b.s_edgeAO[0]=u;var f=b.FindMaxSeparation(b.s_edgeAO,t,n,r,i);u=b.s_edgeAO[0];if(f>o)return;var l=0;b.s_edgeBO[0]=l;var c=b.FindMaxSeparation(b.s_edgeBO,r,i,t,n);l=b.s_edgeBO[0];if(c>o)return;var h;var p;var d;var v;var m=0;var g=0;var y=.98;var w=.001;var E;if(c>y*f+w){h=r;p=t;d=i;v=n;m=l;e.m_type=O.e_faceB;g=1}else{h=t;p=r;d=n;v=i;m=u;e.m_type=O.e_faceA;g=0}var S=b.s_incidentEdge;b.FindIncidentEdge(S,h,d,m,p,v);var x=parseInt(h.m_vertexCount);var T=h.m_vertices;var N=T[m];var C;if(m+1<x){C=T[parseInt(m+1)]}else{C=T[0]}var k=b.s_localTangent;k.Set(C.x-N.x,C.y-N.y);k.Normalize();var L=b.s_localNormal;L.x=k.y;L.y=-k.x;var A=b.s_planePoint;A.Set(.5*(N.x+C.x),.5*(N.y+C.y));var M=b.s_tangent;E=d.R;M.x=E.col1.x*k.x+E.col2.x*k.y;M.y=E.col1.y*k.x+E.col2.y*k.y;var _=b.s_tangent2;_.x=-M.x;_.y=-M.y;var D=b.s_normal;D.x=M.y;D.y=-M.x;var P=b.s_v11;var H=b.s_v12;P.x=d.position.x+(E.col1.x*N.x+E.col2.x*N.y);P.y=d.position.y+(E.col1.y*N.x+E.col2.y*N.y);H.x=d.position.x+(E.col1.x*C.x+E.col2.x*C.y);H.y=d.position.y+(E.col1.y*C.x+E.col2.y*C.y);var B=D.x*P.x+D.y*P.y;var j=-M.x*P.x-M.y*P.y+o;var F=M.x*H.x+M.y*H.y+o;var I=b.s_clipPoints1;var q=b.s_clipPoints2;var R=0;R=b.ClipSegmentToLine(I,S,_,j);if(R<2)return;R=b.ClipSegmentToLine(q,I,M,F);if(R<2)return;e.m_localPlaneNormal.SetV(L);e.m_localPoint.SetV(A);var U=0;for(var z=0;z<a.b2_maxManifoldPoints;++z){s=q[z];var W=D.x*s.v.x+D.y*s.v.y-B;if(W<=o){var X=e.m_points[U];E=v.R;var V=s.v.x-v.position.x;var $=s.v.y-v.position.y;X.m_localPoint.x=V*E.col1.x+$*E.col1.y;X.m_localPoint.y=V*E.col2.x+$*E.col2.y;X.m_id.Set(s.id);X.m_id.features.flip=g;++U}}e.m_pointCount=U};b.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s;var o;s=n.R;o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);var a=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R;o=r.m_p;var f=i.position.x+(s.col1.x*o.x+s.col2.x*o.y);var l=i.position.y+(s.col1.y*o.x+s.col2.y*o.y);var c=f-u;var h=l-a;var p=c*c+h*h;var d=t.m_radius+r.m_radius;if(p>d*d){return}e.m_type=O.e_circles;e.m_localPoint.SetV(t.m_p);e.m_localPlaneNormal.SetZero();e.m_pointCount=1;e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0};b.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s;var o=0;var u=0;var a=0;var f=0;var l;var c;c=i.R;l=r.m_p;var h=i.position.x+(c.col1.x*l.x+c.col2.x*l.y);var p=i.position.y+(c.col1.y*l.x+c.col2.y*l.y);o=h-n.position.x;u=p-n.position.y;c=n.R;var d=o*c.col1.x+u*c.col1.y;var v=o*c.col2.x+u*c.col2.y;var m=0;var g=0;var y=-Number.MAX_VALUE;var b=t.m_radius+r.m_radius;var w=parseInt(t.m_vertexCount);var E=t.m_vertices;var S=t.m_normals;for(var x=0;x<w;++x){l=E[x];o=d-l.x;u=v-l.y;l=S[x];var T=l.x*o+l.y*u;if(T>b){return}if(T>y){y=T;g=x}}var N=parseInt(g);var C=parseInt(N+1<w?N+1:0);var k=E[N];var L=E[C];if(y<Number.MIN_VALUE){e.m_pointCount=1;e.m_type=O.e_faceA;e.m_localPlaneNormal.SetV(S[g]);e.m_localPoint.x=.5*(k.x+L.x);e.m_localPoint.y=.5*(k.y+L.y);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0;return}var A=(d-k.x)*(L.x-k.x)+(v-k.y)*(L.y-k.y);var M=(d-L.x)*(k.x-L.x)+(v-L.y)*(k.y-L.y);if(A<=0){if((d-k.x)*(d-k.x)+(v-k.y)*(v-k.y)>b*b)return;e.m_pointCount=1;e.m_type=O.e_faceA;e.m_localPlaneNormal.x=d-k.x;e.m_localPlaneNormal.y=v-k.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(k);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}else if(M<=0){if((d-L.x)*(d-L.x)+(v-L.y)*(v-L.y)>b*b)return;e.m_pointCount=1;e.m_type=O.e_faceA;e.m_localPlaneNormal.x=d-L.x;e.m_localPlaneNormal.y=v-L.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(L);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}else{var _=.5*(k.x+L.x);var D=.5*(k.y+L.y);y=(d-_)*S[N].x+(v-D)*S[N].y;if(y>b)return;e.m_pointCount=1;e.m_type=O.e_faceA;e.m_localPlaneNormal.x=S[N].x;e.m_localPlaneNormal.y=S[N].y;e.m_localPlaneNormal.Normalize();e.m_localPoint.Set(_,D);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}};b.TestOverlap=function(e,t){var n=t.lowerBound;var r=e.upperBound;var i=n.x-r.x;var s=n.y-r.y;n=e.lowerBound;r=t.upperBound;var o=n.x-r.x;var u=n.y-r.y;if(i>0||s>0)return false;if(o>0||u>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=b.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=b.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=b.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new d;Box2D.Collision.b2Collision.s_localNormal=new d;Box2D.Collision.b2Collision.s_planePoint=new d;Box2D.Collision.b2Collision.s_normal=new d;Box2D.Collision.b2Collision.s_tangent=new d;Box2D.Collision.b2Collision.s_tangent2=new d;Box2D.Collision.b2Collision.s_v11=new d;Box2D.Collision.b2Collision.s_v12=new d;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new d;Box2D.Collision.b2Collision.b2_nullFeature=255});w.b2ContactID=function(){this.features=new W};w.prototype.b2ContactID=function(){this.features._m_id=this};w.prototype.Set=function(e){this.key=e._key};w.prototype.Copy=function(){var e=new w;e.key=this.key;return e};Object.defineProperty(w.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(w.prototype,"key",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._key=e;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});E.b2ContactPoint=function(){this.position=new d;this.velocity=new d;this.normal=new d;this.id=new w};S.b2Distance=function(){};S.Distance=function(e,t,n){++S.b2_gjkCalls;var r=n.proxyA;var i=n.proxyB;var s=n.transformA;var o=n.transformB;var u=S.s_simplex;u.ReadCache(t,r,s,i,o);var f=u.m_vertices;var l=20;var h=S.s_saveA;var p=S.s_saveB;var v=0;var m=u.GetClosestPoint();var g=m.LengthSquared();var y=g;var b=0;var w;var E=0;while(E<l){v=u.m_count;for(b=0;b<v;b++){h[b]=f[b].indexA;p[b]=f[b].indexB}switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:a.b2Assert(false)}if(u.m_count==3){break}w=u.GetClosestPoint();y=w.LengthSquared();if(y>g){}g=y;var x=u.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}var T=f[u.m_count];T.indexA=r.GetSupport(c.MulTMV(s.R,x.GetNegative()));T.wA=c.MulX(s,r.GetVertex(T.indexA));T.indexB=i.GetSupport(c.MulTMV(o.R,x));T.wB=c.MulX(o,i.GetVertex(T.indexB));T.w=c.SubtractVV(T.wB,T.wA);++E;++S.b2_gjkIters;var N=false;for(b=0;b<v;b++){if(T.indexA==h[b]&&T.indexB==p[b]){N=true;break}}if(N){break}++u.m_count}S.b2_gjkMaxIters=c.Max(S.b2_gjkMaxIters,E);u.GetWitnessPoints(e.pointA,e.pointB);e.distance=c.SubtractVV(e.pointA,e.pointB).Length();e.iterations=E;u.WriteCache(t);if(n.useRadii){var C=r.m_radius;var k=i.m_radius;if(e.distance>C+k&&e.distance>Number.MIN_VALUE){e.distance-=C+k;var L=c.SubtractVV(e.pointB,e.pointA);L.Normalize();e.pointA.x+=C*L.x;e.pointA.y+=C*L.y;e.pointB.x-=k*L.x;e.pointB.y-=k*L.y}else{w=new d;w.x=.5*(e.pointA.x+e.pointB.x);w.y=.5*(e.pointA.y+e.pointB.y);e.pointA.x=e.pointB.x=w.x;e.pointA.y=e.pointB.y=w.y;e.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new j;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});x.b2DistanceInput=function(){};T.b2DistanceOutput=function(){this.pointA=new d;this.pointB=new d};N.b2DistanceProxy=function(){};N.prototype.Set=function(t){switch(t.GetType()){case s.e_circleShape:{var r=t instanceof e?t:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=r.m_p;this.m_count=1;this.m_radius=r.m_radius}break;case s.e_polygonShape:{var o=t instanceof i?t:null;this.m_vertices=o.m_vertices;this.m_count=o.m_vertexCount;this.m_radius=o.m_radius}break;case s.e_edgeShape:{var u=t instanceof n?t:null;this.m_vertices=new Vector(2,true);this.m_vertices[0]=u.m_v1;this.m_vertices[1]=u.m_v2;this.m_count=2;this.m_radius=u.m_radius}break;default:a.b2Assert(false)}};N.prototype.GetSupport=function(e){var t=0;var n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(i>n){t=r;n=i}}return t};N.prototype.GetSupportVertex=function(e){var t=0;var n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(i>n){t=r;n=i}}return this.m_vertices[t]};N.prototype.GetVertexCount=function(){return this.m_count};N.prototype.GetVertex=function(e){if(e===undefined)e=0;a.b2Assert(0<=e&&e<this.m_count);return this.m_vertices[e]};C.b2DynamicTree=function(){};C.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};C.prototype.CreateProxy=function(e,t){var n=this.AllocateNode();var r=a.b2_aabbExtension;var i=a.b2_aabbExtension;n.aabb.lowerBound.x=e.lowerBound.x-r;n.aabb.lowerBound.y=e.lowerBound.y-i;n.aabb.upperBound.x=e.upperBound.x+r;n.aabb.upperBound.y=e.upperBound.y+i;n.userData=t;this.InsertLeaf(n);return n};C.prototype.DestroyProxy=function(e){this.RemoveLeaf(e);this.FreeNode(e)};C.prototype.MoveProxy=function(e,t,n){a.b2Assert(e.IsLeaf());if(e.aabb.Contains(t)){return false}this.RemoveLeaf(e);var r=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.x>0?n.x:-n.x);var i=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.y>0?n.y:-n.y);e.aabb.lowerBound.x=t.lowerBound.x-r;e.aabb.lowerBound.y=t.lowerBound.y-i;e.aabb.upperBound.x=t.upperBound.x+r;e.aabb.upperBound.y=t.upperBound.y+i;this.InsertLeaf(e);return true};C.prototype.Rebalance=function(e){if(e===undefined)e=0;if(this.m_root==null)return;for(var t=0;t<e;t++){var n=this.m_root;var r=0;while(n.IsLeaf()==false){n=this.m_path>>r&1?n.child2:n.child1;r=r+1&31}++this.m_path;this.RemoveLeaf(n);this.InsertLeaf(n)}};C.prototype.GetFatAABB=function(e){return e.aabb};C.prototype.GetUserData=function(e){return e.userData};C.prototype.Query=function(e,t){if(this.m_root==null)return;var n=new Vector;var r=0;n[r++]=this.m_root;while(r>0){var i=n[--r];if(i.aabb.TestOverlap(t)){if(i.IsLeaf()){var s=e(i);if(!s)return}else{n[r++]=i.child1;n[r++]=i.child2}}}};C.prototype.RayCast=function(e,t){if(this.m_root==null)return;var n=t.p1;var r=t.p2;var i=c.SubtractVV(n,r);i.Normalize();var s=c.CrossFV(1,i);var o=c.AbsV(s);var u=t.maxFraction;var a=new m;var f=0;var l=0;{f=n.x+u*(r.x-n.x);l=n.y+u*(r.y-n.y);a.lowerBound.x=Math.min(n.x,f);a.lowerBound.y=Math.min(n.y,l);a.upperBound.x=Math.max(n.x,f);a.upperBound.y=Math.max(n.y,l)}var h=new Vector;var p=0;h[p++]=this.m_root;while(p>0){var d=h[--p];if(d.aabb.TestOverlap(a)==false){continue}var v=d.aabb.GetCenter();var g=d.aabb.GetExtents();var y=Math.abs(s.x*(n.x-v.x)+s.y*(n.y-v.y))-o.x*g.x-o.y*g.y;if(y>0)continue;if(d.IsLeaf()){var b=new D;b.p1=t.p1;b.p2=t.p2;b.maxFraction=u;var w=e(b,d);if(w==0)return;if(w>0){u=w;f=n.x+u*(r.x-n.x);l=n.y+u*(r.y-n.y);a.lowerBound.x=Math.min(n.x,f);a.lowerBound.y=Math.min(n.y,l);a.upperBound.x=Math.max(n.x,f);a.upperBound.y=Math.max(n.y,l)}}else{h[p++]=d.child1;h[p++]=d.child2}}};C.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;this.m_freeList=e.parent;e.parent=null;e.child1=null;e.child2=null;return e}return new L};C.prototype.FreeNode=function(e){e.parent=this.m_freeList;this.m_freeList=e};C.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null){this.m_root=e;this.m_root.parent=null;return}var t=e.aabb.GetCenter();var n=this.m_root;if(n.IsLeaf()==false){do{var r=n.child1;var i=n.child2;var s=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y);var o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y);if(s<o){n=r}else{n=i}}while(n.IsLeaf()==false)}var u=n.parent;var a=this.AllocateNode();a.parent=u;a.userData=null;a.aabb.Combine(e.aabb,n.aabb);if(u){if(n.parent.child1==n){u.child1=a}else{u.child2=a}a.child1=n;a.child2=e;n.parent=a;e.parent=a;do{if(u.aabb.Contains(a.aabb))break;u.aabb.Combine(u.child1.aabb,u.child2.aabb);a=u;u=u.parent}while(u)}else{a.child1=n;a.child2=e;n.parent=a;e.parent=a;this.m_root=a}};C.prototype.RemoveLeaf=function(e){if(e==this.m_root){this.m_root=null;return}var t=e.parent;var n=t.parent;var r;if(t.child1==e){r=t.child2}else{r=t.child1}if(n){if(n.child1==t){n.child1=r}else{n.child2=r}r.parent=n;this.FreeNode(t);while(n){var i=n.aabb;n.aabb=m.Combine(n.child1.aabb,n.child2.aabb);if(i.Contains(n.aabb))break;n=n.parent}}else{this.m_root=r;r.parent=null;this.FreeNode(t)}};k.b2DynamicTreeBroadPhase=function(){this.m_tree=new C;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};k.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);++this.m_proxyCount;this.BufferMove(n);return n};k.prototype.DestroyProxy=function(e){this.UnBufferMove(e);--this.m_proxyCount;this.m_tree.DestroyProxy(e)};k.prototype.MoveProxy=function(e,t,n){var r=this.m_tree.MoveProxy(e,t,n);if(r){this.BufferMove(e)}};k.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e);var r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)};k.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)};k.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)};k.prototype.GetProxyCount=function(){return this.m_proxyCount};k.prototype.UpdatePairs=function(e){var t=this;t.m_pairCount=0;var n=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];function i(e){if(e==r)return true;if(t.m_pairCount==t.m_pairBuffer.length){t.m_pairBuffer[t.m_pairCount]=new A}var n=t.m_pairBuffer[t.m_pairCount];n.proxyA=e<r?e:r;n.proxyB=e>=r?e:r;++t.m_pairCount;return true}var s=t.m_tree.GetFatAABB(r);t.m_tree.Query(i,s)}t.m_moveBuffer.length=0;for(var n=0;n<t.m_pairCount;){var o=t.m_pairBuffer[n];var u=t.m_tree.GetUserData(o.proxyA);var a=t.m_tree.GetUserData(o.proxyB);e(u,a);++n;while(n<t.m_pairCount){var f=t.m_pairBuffer[n];if(f.proxyA!=o.proxyA||f.proxyB!=o.proxyB){break}++n}}};k.prototype.Query=function(e,t){this.m_tree.Query(e,t)};k.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)};k.prototype.Validate=function(){};k.prototype.Rebalance=function(e){if(e===undefined)e=0;this.m_tree.Rebalance(e)};k.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e};k.prototype.UnBufferMove=function(e){var t=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(t,1)};k.prototype.ComparePairs=function(e,t){return 0};k.__implements={};k.__implements[X]=true;L.b2DynamicTreeNode=function(){this.aabb=new m};L.prototype.IsLeaf=function(){return this.child1==null};A.b2DynamicTreePair=function(){};O.b2Manifold=function(){this.m_pointCount=0};O.prototype.b2Manifold=function(){this.m_points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++){this.m_points[e]=new M}this.m_localPlaneNormal=new d;this.m_localPoint=new d};O.prototype.Reset=function(){for(var e=0;e<a.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof M?this.m_points[e]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};O.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<a.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof M?this.m_points[t]:null).Set(e.m_points[t])}this.m_localPlaneNormal.SetV(e.m_localPlaneNormal);this.m_localPoint.SetV(e.m_localPoint);this.m_type=e.m_type};O.prototype.Copy=function(){var e=new O;e.Set(this);return e};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});M.b2ManifoldPoint=function(){this.m_localPoint=new d;this.m_id=new w};M.prototype.b2ManifoldPoint=function(){this.Reset()};M.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};M.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint);this.m_normalImpulse=e.m_normalImpulse;this.m_tangentImpulse=e.m_tangentImpulse;this.m_id.Set(e.m_id)};_.b2Point=function(){this.p=new d};_.prototype.Support=function(e,t,n){if(t===undefined)t=0;if(n===undefined)n=0;return this.p};_.prototype.GetFirstVertex=function(e){return this.p};D.b2RayCastInput=function(){this.p1=new d;this.p2=new d};D.prototype.b2RayCastInput=function(e,t,n){if(e===undefined)e=null;if(t===undefined)t=null;if(n===undefined)n=1;if(e)this.p1.SetV(e);if(t)this.p2.SetV(t);this.maxFraction=n};P.b2RayCastOutput=function(){this.normal=new d};H.b2Segment=function(){this.p1=new d;this.p2=new d};H.prototype.TestSegment=function(e,t,n,r){if(r===undefined)r=0;var i=n.p1;var s=n.p2.x-i.x;var o=n.p2.y-i.y;var u=this.p2.x-this.p1.x;var a=this.p2.y-this.p1.y;var f=a;var l=-u;var c=100*Number.MIN_VALUE;var h=-(s*f+o*l);if(h>c){var p=i.x-this.p1.x;var d=i.y-this.p1.y;var v=p*f+d*l;if(0<=v&&v<=r*h){var m=-s*d+o*p;if(-c*h<=m&&m<=h*(1+c)){v/=h;var g=Math.sqrt(f*f+l*l);f/=g;l/=g;e[0]=v;t.Set(f,l);return true}}}return false};H.prototype.Extend=function(e){this.ExtendForward(e);this.ExtendBackward(e)};H.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x;var n=this.p2.y-this.p1.y;var r=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*r;this.p2.y=this.p1.y+n*r};H.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x;var n=-this.p2.y+this.p1.y;var r=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*r;this.p1.y=this.p2.y+n*r};B.b2SeparationFunction=function(){this.m_localPoint=new d;this.m_axis=new d};B.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t;this.m_proxyB=r;var s=parseInt(e.count);a.b2Assert(0<s&&s<3);var o;var u;var f;var l;var h;var p;var v=0;var m=0;var g=0;var y=0;var b=0;var w=0;var E;var S;var x=0;var T=0;if(s==1){this.m_type=B.e_points;o=this.m_proxyA.GetVertex(e.indexA[0]);l=this.m_proxyB.GetVertex(e.indexB[0]);S=o;E=n.R;v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y);m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y);S=l;E=i.R;g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y);y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y);this.m_axis.x=g-v;this.m_axis.y=y-m;this.m_axis.Normalize()}else if(e.indexB[0]==e.indexB[1]){this.m_type=B.e_faceA;u=this.m_proxyA.GetVertex(e.indexA[0]);f=this.m_proxyA.GetVertex(e.indexA[1]);l=this.m_proxyB.GetVertex(e.indexB[0]);this.m_localPoint.x=.5*(u.x+f.x);this.m_localPoint.y=.5*(u.y+f.y);this.m_axis=c.CrossVF(c.SubtractVV(f,u),1);this.m_axis.Normalize();S=this.m_axis;E=n.R;b=E.col1.x*S.x+E.col2.x*S.y;w=E.col1.y*S.x+E.col2.y*S.y;S=this.m_localPoint;E=n.R;v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y);m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y);S=l;E=i.R;g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y);y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y);x=(g-v)*b+(y-m)*w;if(x<0){this.m_axis.NegativeSelf()}}else if(e.indexA[0]==e.indexA[0]){this.m_type=B.e_faceB;h=this.m_proxyB.GetVertex(e.indexB[0]);p=this.m_proxyB.GetVertex(e.indexB[1]);o=this.m_proxyA.GetVertex(e.indexA[0]);this.m_localPoint.x=.5*(h.x+p.x);this.m_localPoint.y=.5*(h.y+p.y);this.m_axis=c.CrossVF(c.SubtractVV(p,h),1);this.m_axis.Normalize();S=this.m_axis;E=i.R;b=E.col1.x*S.x+E.col2.x*S.y;w=E.col1.y*S.x+E.col2.y*S.y;S=this.m_localPoint;E=i.R;g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y);y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y);S=o;E=n.R;v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y);m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y);x=(v-g)*b+(m-y)*w;if(x<0){this.m_axis.NegativeSelf()}}else{u=this.m_proxyA.GetVertex(e.indexA[0]);f=this.m_proxyA.GetVertex(e.indexA[1]);h=this.m_proxyB.GetVertex(e.indexB[0]);p=this.m_proxyB.GetVertex(e.indexB[1]);var N=c.MulX(n,o);var C=c.MulMV(n.R,c.SubtractVV(f,u));var k=c.MulX(i,l);var L=c.MulMV(i.R,c.SubtractVV(p,h));var A=C.x*C.x+C.y*C.y;var O=L.x*L.x+L.y*L.y;var M=c.SubtractVV(L,C);var _=C.x*M.x+C.y*M.y;var D=L.x*M.x+L.y*M.y;var P=C.x*L.x+C.y*L.y;var H=A*O-P*P;x=0;if(H!=0){x=c.Clamp((P*D-_*O)/H,0,1)}var j=(P*x+D)/O;if(j<0){j=0;x=c.Clamp((P-_)/A,0,1)}o=new d;o.x=u.x+x*(f.x-u.x);o.y=u.y+x*(f.y-u.y);l=new d;l.x=h.x+x*(p.x-h.x);l.y=h.y+x*(p.y-h.y);if(x==0||x==1){this.m_type=B.e_faceB;this.m_axis=c.CrossVF(c.SubtractVV(p,h),1);this.m_axis.Normalize();this.m_localPoint=l;S=this.m_axis;E=i.R;b=E.col1.x*S.x+E.col2.x*S.y;w=E.col1.y*S.x+E.col2.y*S.y;S=this.m_localPoint;E=i.R;g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y);y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y);S=o;E=n.R;v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y);m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y);T=(v-g)*b+(m-y)*w;if(x<0){this.m_axis.NegativeSelf()}}else{this.m_type=B.e_faceA;this.m_axis=c.CrossVF(c.SubtractVV(f,u),1);this.m_localPoint=o;S=this.m_axis;E=n.R;b=E.col1.x*S.x+E.col2.x*S.y;w=E.col1.y*S.x+E.col2.y*S.y;S=this.m_localPoint;E=n.R;v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y);m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y);S=l;E=i.R;g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y);y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y);T=(g-v)*b+(y-m)*w;if(x<0){this.m_axis.NegativeSelf()}}}};B.prototype.Evaluate=function(e,t){var n;var r;var i;var s;var o;var u;var f=0;var l;switch(this.m_type){case B.e_points:{n=c.MulTMV(e.R,this.m_axis);r=c.MulTMV(t.R,this.m_axis.GetNegative());i=this.m_proxyA.GetSupportVertex(n);s=this.m_proxyB.GetSupportVertex(r);o=c.MulX(e,i);u=c.MulX(t,s);f=(u.x-o.x)*this.m_axis.x+(u.y-o.y)*this.m_axis.y;return f};case B.e_faceA:{l=c.MulMV(e.R,this.m_axis);o=c.MulX(e,this.m_localPoint);r=c.MulTMV(t.R,l.GetNegative());s=this.m_proxyB.GetSupportVertex(r);u=c.MulX(t,s);f=(u.x-o.x)*l.x+(u.y-o.y)*l.y;return f};case B.e_faceB:{l=c.MulMV(t.R,this.m_axis);u=c.MulX(t,this.m_localPoint);n=c.MulTMV(e.R,l.GetNegative());i=this.m_proxyA.GetSupportVertex(n);o=c.MulX(e,i);f=(o.x-u.x)*l.x+(o.y-u.y)*l.y;return f};default:a.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});j.b2Simplex=function(){this.m_v1=new I;this.m_v2=new I;this.m_v3=new I;this.m_vertices=new Vector(3)};j.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};j.prototype.ReadCache=function(e,t,n,r,i){a.b2Assert(0<=e.count&&e.count<=3);var s;var o;this.m_count=e.count;var u=this.m_vertices;for(var f=0;f<this.m_count;f++){var l=u[f];l.indexA=e.indexA[f];l.indexB=e.indexB[f];s=t.GetVertex(l.indexA);o=r.GetVertex(l.indexB);l.wA=c.MulX(n,s);l.wB=c.MulX(i,o);l.w=c.SubtractVV(l.wB,l.wA);l.a=0}if(this.m_count>1){var h=e.metric;var p=this.GetMetric();if(p<.5*h||2*h<p||p<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){l=u[0];l.indexA=0;l.indexB=0;s=t.GetVertex(0);o=r.GetVertex(0);l.wA=c.MulX(n,s);l.wB=c.MulX(i,o);l.w=c.SubtractVV(l.wB,l.wA);this.m_count=1}};j.prototype.WriteCache=function(e){e.metric=this.GetMetric();e.count=Box2D.parseUInt(this.m_count);var t=this.m_vertices;for(var n=0;n<this.m_count;n++){e.indexA[n]=Box2D.parseUInt(t[n].indexA);e.indexB[n]=Box2D.parseUInt(t[n].indexB)}};j.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var e=c.SubtractVV(this.m_v2.w,this.m_v1.w);var t=c.CrossVV(e,this.m_v1.w.GetNegative());if(t>0){return c.CrossFV(1,e)}else{return c.CrossVF(e,1)}};default:a.b2Assert(false);return new d}};j.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:a.b2Assert(false);return new d;case 1:return this.m_v1.w;case 2:return new d(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:a.b2Assert(false);return new d}};j.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:a.b2Assert(false);break;case 1:e.SetV(this.m_v1.wA);t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:a.b2Assert(false);break}};j.prototype.GetMetric=function(){switch(this.m_count){case 0:a.b2Assert(false);return 0;case 1:return 0;case 2:return c.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return c.CrossVV(c.SubtractVV(this.m_v2.w,this.m_v1.w),c.SubtractVV(this.m_v3.w,this.m_v1.w));default:a.b2Assert(false);return 0}};j.prototype.Solve2=function(){var e=this.m_v1.w;var t=this.m_v2.w;var n=c.SubtractVV(t,e);var r=-(e.x*n.x+e.y*n.y);if(r<=0){this.m_v1.a=1;this.m_count=1;return}var i=t.x*n.x+t.y*n.y;if(i<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var s=1/(i+r);this.m_v1.a=i*s;this.m_v2.a=r*s;this.m_count=2};j.prototype.Solve3=function(){var e=this.m_v1.w;var t=this.m_v2.w;var n=this.m_v3.w;var r=c.SubtractVV(t,e);var i=c.Dot(e,r);var s=c.Dot(t,r);var o=s;var u=-i;var a=c.SubtractVV(n,e);var f=c.Dot(e,a);var l=c.Dot(n,a);var h=l;var p=-f;var d=c.SubtractVV(n,t);var v=c.Dot(t,d);var m=c.Dot(n,d);var g=m;var y=-v;var b=c.CrossVV(r,a);var w=b*c.CrossVV(t,n);var E=b*c.CrossVV(n,e);var S=b*c.CrossVV(e,t);if(u<=0&&p<=0){this.m_v1.a=1;this.m_count=1;return}if(o>0&&u>0&&S<=0){var x=1/(o+u);this.m_v1.a=o*x;this.m_v2.a=u*x;this.m_count=2;return}if(h>0&&p>0&&E<=0){var T=1/(h+p);this.m_v1.a=h*T;this.m_v3.a=p*T;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(o<=0&&y<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(h<=0&&g<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(g>0&&y>0&&w<=0){var N=1/(g+y);this.m_v2.a=g*N;this.m_v3.a=y*N;this.m_count=2;this.m_v1.Set(this.m_v3);return}var C=1/(w+E+S);this.m_v1.a=w*C;this.m_v2.a=E*C;this.m_v3.a=S*C;this.m_count=3};F.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};I.b2SimplexVertex=function(){};I.prototype.Set=function(e){this.wA.SetV(e.wA);this.wB.SetV(e.wB);this.w.SetV(e.w);this.a=e.a;this.indexA=e.indexA;this.indexB=e.indexB};q.b2TimeOfImpact=function(){};q.TimeOfImpact=function(e){++q.b2_toiCalls;var t=e.proxyA;var n=e.proxyB;var r=e.sweepA;var i=e.sweepB;a.b2Assert(r.t0==i.t0);a.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius;var o=e.tolerance;var u=0;var f=1e3;var l=0;var h=0;q.s_cache.count=0;q.s_distanceInput.useRadii=false;for(;;){r.GetTransform(q.s_xfA,u);i.GetTransform(q.s_xfB,u);q.s_distanceInput.proxyA=t;q.s_distanceInput.proxyB=n;q.s_distanceInput.transformA=q.s_xfA;q.s_distanceInput.transformB=q.s_xfB;S.Distance(q.s_distanceOutput,q.s_cache,q.s_distanceInput);if(q.s_distanceOutput.distance<=0){u=1;break}q.s_fcn.Initialize(q.s_cache,t,q.s_xfA,n,q.s_xfB);var p=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(p<=0){u=1;break}if(l==0){if(p>s){h=c.Max(s-o,.75*s)}else{h=c.Max(p-o,.02*s)}}if(p-h<.5*o){if(l==0){u=1;break}break}var d=u;{var v=u;var m=1;var g=p;r.GetTransform(q.s_xfA,m);i.GetTransform(q.s_xfB,m);var y=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(y>=h){u=1;break}var b=0;for(;;){var w=0;if(b&1){w=v+(h-g)*(m-v)/(y-g)}else{w=.5*(v+m)}r.GetTransform(q.s_xfA,w);i.GetTransform(q.s_xfB,w);var E=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(c.Abs(E-h)<.025*o){d=w;break}if(E>h){v=w;g=E}else{m=w;y=E}++b;++q.b2_toiRootIters;if(b==50){break}}q.b2_toiMaxRootIters=c.Max(q.b2_toiMaxRootIters,b)}if(d<(1+100*Number.MIN_VALUE)*u){break}u=d;l++;++q.b2_toiIters;if(l==f){break}}q.b2_toiMaxIters=c.Max(q.b2_toiMaxIters,l);return u};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new F;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new x;Box2D.Collision.b2TimeOfImpact.s_xfA=new p;Box2D.Collision.b2TimeOfImpact.s_xfB=new p;Box2D.Collision.b2TimeOfImpact.s_fcn=new B;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new T});R.b2TOIInput=function(){this.proxyA=new N;this.proxyB=new N;this.sweepA=new h;this.sweepB=new h};U.b2WorldManifold=function(){this.m_normal=new d};U.prototype.b2WorldManifold=function(){this.m_points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++){this.m_points[e]=new d}};U.prototype.Initialize=function(e,t,n,r,i){if(n===undefined)n=0;if(i===undefined)i=0;if(e.m_pointCount==0){return}var s=0;var o;var u;var a=0;var f=0;var l=0;var c=0;var h=0;var p=0;switch(e.m_type){case O.e_circles:{u=t.R;o=e.m_localPoint;var d=t.position.x+u.col1.x*o.x+u.col2.x*o.y;var v=t.position.y+u.col1.y*o.x+u.col2.y*o.y;u=r.R;o=e.m_points[0].m_localPoint;var m=r.position.x+u.col1.x*o.x+u.col2.x*o.y;var g=r.position.y+u.col1.y*o.x+u.col2.y*o.y;var y=m-d;var b=g-v;var w=y*y+b*b;if(w>Number.MIN_VALUE*Number.MIN_VALUE){var E=Math.sqrt(w);this.m_normal.x=y/E;this.m_normal.y=b/E}else{this.m_normal.x=1;this.m_normal.y=0}var S=d+n*this.m_normal.x;var x=v+n*this.m_normal.y;var T=m-i*this.m_normal.x;var N=g-i*this.m_normal.y;this.m_points[0].x=.5*(S+T);this.m_points[0].y=.5*(x+N)}break;case O.e_faceA:{u=t.R;o=e.m_localPlaneNormal;a=u.col1.x*o.x+u.col2.x*o.y;f=u.col1.y*o.x+u.col2.y*o.y;u=t.R;o=e.m_localPoint;l=t.position.x+u.col1.x*o.x+u.col2.x*o.y;c=t.position.y+u.col1.y*o.x+u.col2.y*o.y;this.m_normal.x=a;this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++){u=r.R;o=e.m_points[s].m_localPoint;h=r.position.x+u.col1.x*o.x+u.col2.x*o.y;p=r.position.y+u.col1.y*o.x+u.col2.y*o.y;this.m_points[s].x=h+.5*(n-(h-l)*a-(p-c)*f-i)*a;this.m_points[s].y=p+.5*(n-(h-l)*a-(p-c)*f-i)*f}}break;case O.e_faceB:{u=r.R;o=e.m_localPlaneNormal;a=u.col1.x*o.x+u.col2.x*o.y;f=u.col1.y*o.x+u.col2.y*o.y;u=r.R;o=e.m_localPoint;l=r.position.x+u.col1.x*o.x+u.col2.x*o.y;c=r.position.y+u.col1.y*o.x+u.col2.y*o.y;this.m_normal.x=-a;this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++){u=t.R;o=e.m_points[s].m_localPoint;h=t.position.x+u.col1.x*o.x+u.col2.x*o.y;p=t.position.y+u.col1.y*o.x+u.col2.y*o.y;this.m_points[s].x=h+.5*(i-(h-l)*a-(p-c)*f-n)*a;this.m_points[s].y=p+.5*(i-(h-l)*a-(p-c)*f-n)*f}}break}};z.ClipVertex=function(){this.v=new d;this.id=new w};z.prototype.Set=function(e){this.v.SetV(e.v);this.id.Set(e.id)};W.Features=function(){};Object.defineProperty(W.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(W.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._referenceEdge=e;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(W.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(W.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._incidentEdge=e;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(W.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(W.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._incidentVertex=e;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(W.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(W.prototype,"flip",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._flip=e;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,s=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,u=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,f=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,v=Box2D.Common.Math.b2Vec3,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,y=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,w=Box2D.Dynamics.b2ContactListener,E=Box2D.Dynamics.b2ContactManager,S=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,T=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,C=Box2D.Dynamics.b2FixtureDef,k=Box2D.Dynamics.b2Island,L=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,O=Box2D.Collision.b2AABB,M=Box2D.Collision.b2Bound,_=Box2D.Collision.b2BoundValues,D=Box2D.Collision.b2Collision,P=Box2D.Collision.b2ContactID,H=Box2D.Collision.b2ContactPoint,B=Box2D.Collision.b2Distance,j=Box2D.Collision.b2DistanceInput,F=Box2D.Collision.b2DistanceOutput,I=Box2D.Collision.b2DistanceProxy,q=Box2D.Collision.b2DynamicTree,R=Box2D.Collision.b2DynamicTreeBroadPhase,U=Box2D.Collision.b2DynamicTreeNode,z=Box2D.Collision.b2DynamicTreePair,W=Box2D.Collision.b2Manifold,X=Box2D.Collision.b2ManifoldPoint,V=Box2D.Collision.b2Point,$=Box2D.Collision.b2RayCastInput,J=Box2D.Collision.b2RayCastOutput,K=Box2D.Collision.b2Segment,Q=Box2D.Collision.b2SeparationFunction,G=Box2D.Collision.b2Simplex,Y=Box2D.Collision.b2SimplexCache,Z=Box2D.Collision.b2SimplexVertex,et=Box2D.Collision.b2TimeOfImpact,tt=Box2D.Collision.b2TOIInput,nt=Box2D.Collision.b2WorldManifold,rt=Box2D.Collision.ClipVertex,it=Box2D.Collision.Features,st=Box2D.Collision.IBroadPhase;Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape);r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;r.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new d};r.prototype.Copy=function(){var e=new r;e.Set(this);return e};r.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,r)){var t=e instanceof r?e:null;this.m_p.SetV(t.m_p)}};r.prototype.TestPoint=function(e,t){var n=e.R;var r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var i=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);r=t.x-r;i=t.y-i;return r*r+i*i<=this.m_radius*this.m_radius};r.prototype.RayCast=function(e,t,n){var r=n.R;var i=n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y);var s=n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y);var o=t.p1.x-i;var u=t.p1.y-s;var a=o*o+u*u-this.m_radius*this.m_radius;var f=t.p2.x-t.p1.x;var l=t.p2.y-t.p1.y;var c=o*f+u*l;var h=f*f+l*l;var p=c*c-h*a;if(p<0||h<Number.MIN_VALUE){return false}var d=-(c+Math.sqrt(p));if(0<=d&&d<=t.maxFraction*h){d/=h;e.fraction=d;e.normal.x=o+d*f;e.normal.y=u+d*l;e.normal.Normalize();return true}return false};r.prototype.ComputeAABB=function(e,t){var n=t.R;var r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var i=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);e.lowerBound.Set(r-this.m_radius,i-this.m_radius);e.upperBound.Set(r+this.m_radius,i+this.m_radius)};r.prototype.ComputeMass=function(e,t){if(t===undefined)t=0;e.mass=t*n.b2_pi*this.m_radius*this.m_radius;e.center.SetV(this.m_p);e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};r.prototype.ComputeSubmergedArea=function(e,t,n,r){if(t===undefined)t=0;var i=c.MulX(n,this.m_p);var s=-(c.Dot(e,i)-t);if(s<-this.m_radius+Number.MIN_VALUE){return 0}if(s>this.m_radius){r.SetV(i);return Math.PI*this.m_radius*this.m_radius}var o=this.m_radius*this.m_radius;var u=s*s;var a=o*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(o-u);var f=-2/3*Math.pow(o-u,1.5)/a;r.x=i.x+e.x*f;r.y=i.y+e.y*f;return a};r.prototype.GetLocalPosition=function(){return this.m_p};r.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)};r.prototype.GetRadius=function(){return this.m_radius};r.prototype.SetRadius=function(e){if(e===undefined)e=0;this.m_radius=e};r.prototype.b2CircleShape=function(e){if(e===undefined)e=0;this.__super.b2Shape.call(this);this.m_type=a.e_circleShape;this.m_radius=e};i.b2EdgeChainDef=function(){};i.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new d;this.m_v1=new d;this.m_v2=new d;this.m_coreV1=new d;this.m_coreV2=new d;this.m_normal=new d;this.m_direction=new d;this.m_cornerDir1=new d;this.m_cornerDir2=new d};s.prototype.TestPoint=function(e,t){return false};s.prototype.Copy=function(){var e=new s(this.m_v1,this.m_v2);e.Set(this);return e};s.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,s)){var t=e instanceof s?e:null;this.s_supportVec.SetV(t.s_supportVec);this.m_v1.SetV(t.m_v1);this.m_v2.SetV(t.m_v2);this.m_coreV1.SetV(t.m_coreV1);this.m_coreV2.SetV(t.m_coreV2);this.m_normal.SetV(t.m_normal);this.m_direction.SetV(t.m_direction);this.m_cornerDir1.SetV(t.m_cornerDir1);this.m_cornerDir2.SetV(t.m_cornerDir2)}};s.prototype.RayCast=function(e,t,n){var r;var i=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y);var u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y);var a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;var f=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o);var l=100*Number.MIN_VALUE;var c=-(i*a+s*f);if(c>l){var h=t.p1.x-o;var p=t.p1.y-u;var d=h*a+p*f;if(0<=d&&d<=t.maxFraction*c){var v=-i*p+s*h;if(-l*c<=v&&v<=c*(1+l)){d/=c;e.fraction=d;var m=Math.sqrt(a*a+f*f);e.normal.x=a/m;e.normal.y=f/m;return true}}}return false};s.prototype.ComputeAABB=function(e,t){var n=t.R;var r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y);var i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y);var s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);var o=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y);if(r<s){e.lowerBound.x=r;e.upperBound.x=s}else{e.lowerBound.x=s;e.upperBound.x=r}if(i<o){e.lowerBound.y=i;e.upperBound.y=o}else{e.lowerBound.y=o;e.upperBound.y=i}};s.prototype.ComputeMass=function(e,t){if(t===undefined)t=0;e.mass=0;e.center.SetV(this.m_v1);e.I=0};s.prototype.ComputeSubmergedArea=function(e,t,n,r){if(t===undefined)t=0;var i=new d(e.x*t,e.y*t);var s=c.MulX(n,this.m_v1);var o=c.MulX(n,this.m_v2);var u=c.Dot(e,s)-t;var a=c.Dot(e,o)-t;if(u>0){if(a>0){return 0}else{s.x=-a/(u-a)*s.x+u/(u-a)*o.x;s.y=-a/(u-a)*s.y+u/(u-a)*o.y}}else{if(a>0){o.x=-a/(u-a)*s.x+u/(u-a)*o.x;o.y=-a/(u-a)*s.y+u/(u-a)*o.y}else{}}r.x=(i.x+s.x+o.x)/3;r.y=(i.y+s.y+o.y)/3;return.5*((s.x-i.x)*(o.y-i.y)-(s.y-i.y)*(o.x-i.x))};s.prototype.GetLength=function(){return this.m_length};s.prototype.GetVertex1=function(){return this.m_v1};s.prototype.GetVertex2=function(){return this.m_v2};s.prototype.GetCoreVertex1=function(){return this.m_coreV1};s.prototype.GetCoreVertex2=function(){return this.m_coreV2};s.prototype.GetNormalVector=function(){return this.m_normal};s.prototype.GetDirectionVector=function(){return this.m_direction};s.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};s.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};s.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};s.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};s.prototype.GetFirstVertex=function(e){var t=e.R;return new d(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))};s.prototype.GetNextEdge=function(){return this.m_nextEdge};s.prototype.GetPrevEdge=function(){return this.m_prevEdge};s.prototype.Support=function(e,t,n){if(t===undefined)t=0;if(n===undefined)n=0;var r=e.R;var i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y);var s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y);var o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);var u=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);if(i*t+s*n>o*t+u*n){this.s_supportVec.x=i;this.s_supportVec.y=s}else{this.s_supportVec.x=o;this.s_supportVec.y=u}return this.s_supportVec};s.prototype.b2EdgeShape=function(e,t){this.__super.b2Shape.call(this);this.m_type=a.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=e;this.m_v2=t;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-n.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-n.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-n.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-n.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};s.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e;this.m_coreV1=t;this.m_cornerDir1=n;this.m_cornerConvex1=r};s.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e;this.m_coreV2=t;this.m_cornerDir2=n;this.m_cornerConvex2=r};o.b2MassData=function(){this.mass=0;this.center=new d(0,0);this.I=0};Box2D.inherit(u,Box2D.Collision.Shapes.b2Shape);u.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;u.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};u.prototype.Copy=function(){var e=new u;e.Set(this);return e};u.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,u)){var t=e instanceof u?e:null;this.m_centroid.SetV(t.m_centroid);this.m_vertexCount=t.m_vertexCount;this.Reserve(this.m_vertexCount);for(var n=0;n<this.m_vertexCount;n++){this.m_vertices[n].SetV(t.m_vertices[n]);this.m_normals[n].SetV(t.m_normals[n])}}};u.prototype.SetAsArray=function(e,t){if(t===undefined)t=0;var n=new Vector;var r=0,i;for(r=0;r<e.length;++r){i=e[r];n.push(i)}this.SetAsVector(n,t)};u.AsArray=function(e,t){if(t===undefined)t=0;var n=new u;n.SetAsArray(e,t);return n};u.prototype.SetAsVector=function(e,t){if(t===undefined)t=0;if(t==0)t=e.length;n.b2Assert(2<=t);this.m_vertexCount=t;this.Reserve(t);var r=0;for(r=0;r<this.m_vertexCount;r++){this.m_vertices[r].SetV(e[r])}for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r);var s=parseInt(r+1<this.m_vertexCount?r+1:0);var o=c.SubtractVV(this.m_vertices[s],this.m_vertices[i]);n.b2Assert(o.LengthSquared()>Number.MIN_VALUE);this.m_normals[r].SetV(c.CrossVF(o,1));this.m_normals[r].Normalize()}this.m_centroid=u.ComputeCentroid(this.m_vertices,this.m_vertexCount)};u.AsVector=function(e,t){if(t===undefined)t=0;var n=new u;n.SetAsVector(e,t);return n};u.prototype.SetAsBox=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-e,-t);this.m_vertices[1].Set(e,-t);this.m_vertices[2].Set(e,t);this.m_vertices[3].Set(-e,t);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};u.AsBox=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;var n=new u;n.SetAsBox(e,t);return n};u.prototype.SetAsOrientedBox=function(e,t,n,r){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=null;if(r===undefined)r=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-e,-t);this.m_vertices[1].Set(e,-t);this.m_vertices[2].Set(e,t);this.m_vertices[3].Set(-e,t);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=n;var i=new p;i.position=n;i.R.Set(r);for(var s=0;s<this.m_vertexCount;++s){this.m_vertices[s]=c.MulX(i,this.m_vertices[s]);this.m_normals[s]=c.MulMV(i.R,this.m_normals[s])}};u.AsOrientedBox=function(e,t,n,r){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=null;if(r===undefined)r=0;var i=new u;i.SetAsOrientedBox(e,t,n,r);return i};u.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(e);this.m_vertices[1].SetV(t);this.m_centroid.x=.5*(e.x+t.x);this.m_centroid.y=.5*(e.y+t.y);this.m_normals[0]=c.CrossVF(c.SubtractVV(t,e),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};u.AsEdge=function(e,t){var n=new u;n.SetAsEdge(e,t);return n};u.prototype.TestPoint=function(e,t){var n;var r=e.R;var i=t.x-e.position.x;var s=t.y-e.position.y;var o=i*r.col1.x+s*r.col1.y;var u=i*r.col2.x+s*r.col2.y;for(var a=0;a<this.m_vertexCount;++a){n=this.m_vertices[a];i=o-n.x;s=u-n.y;n=this.m_normals[a];var f=n.x*i+n.y*s;if(f>0){return false}}return true};u.prototype.RayCast=function(e,t,n){var r=0;var i=t.maxFraction;var s=0;var o=0;var u;var a;s=t.p1.x-n.position.x;o=t.p1.y-n.position.y;u=n.R;var f=s*u.col1.x+o*u.col1.y;var l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x;o=t.p2.y-n.position.y;u=n.R;var c=s*u.col1.x+o*u.col1.y;var h=s*u.col2.x+o*u.col2.y;var p=c-f;var d=h-l;var v=parseInt(-1);for(var m=0;m<this.m_vertexCount;++m){a=this.m_vertices[m];s=a.x-f;o=a.y-l;a=this.m_normals[m];var g=a.x*s+a.y*o;var y=a.x*p+a.y*d;if(y==0){if(g<0){return false}}else{if(y<0&&g<r*y){r=g/y;v=m}else if(y>0&&g<i*y){i=g/y}}if(i<r-1.1920929e-7){return false}}if(v>=0){e.fraction=r;u=n.R;a=this.m_normals[v];e.normal.x=u.col1.x*a.x+u.col2.x*a.y;e.normal.y=u.col1.y*a.x+u.col2.y*a.y;return true}console.log("out 3");return false};u.prototype.ComputeAABB=function(e,t){var n=t.R;var r=this.m_vertices[0];var i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);var s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y);var o=i;var u=s;for(var a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);var l=t.position.y+(n.col1.y*r.x+n.col2.y*r.y);i=i<f?i:f;s=s<l?s:l;o=o>f?o:f;u=u>l?u:l}e.lowerBound.x=i-this.m_radius;e.lowerBound.y=s-this.m_radius;e.upperBound.x=o+this.m_radius;e.upperBound.y=u+this.m_radius};u.prototype.ComputeMass=function(e,t){if(t===undefined)t=0;if(this.m_vertexCount==2){e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);e.mass=0;e.I=0;return}var n=0;var r=0;var i=0;var s=0;var o=0;var u=0;var a=1/3;for(var f=0;f<this.m_vertexCount;++f){var l=this.m_vertices[f];var c=f+1<this.m_vertexCount?this.m_vertices[parseInt(f+1)]:this.m_vertices[0];var h=l.x-o;var p=l.y-u;var d=c.x-o;var v=c.y-u;var m=h*v-p*d;var g=.5*m;i+=g;n+=g*a*(o+l.x+c.x);r+=g*a*(u+l.y+c.y);var y=o;var b=u;var w=h;var E=p;var S=d;var x=v;var T=a*(.25*(w*w+S*w+S*S)+(y*w+y*S))+.5*y*y;var N=a*(.25*(E*E+x*E+x*x)+(b*E+b*x))+.5*b*b;s+=m*(T+N)}e.mass=t*i;n*=1/i;r*=1/i;e.center.Set(n,r);e.I=t*s};u.prototype.ComputeSubmergedArea=function(e,t,n,r){if(t===undefined)t=0;var i=c.MulTMV(n.R,e);var s=t-c.Dot(e,n.position);var u=new Vector_a2j_Number;var a=0;var f=parseInt(-1);var l=parseInt(-1);var h=false;var p=0;for(p=0;p<this.m_vertexCount;++p){u[p]=c.Dot(i,this.m_vertices[p])-s;var v=u[p]<-Number.MIN_VALUE;if(p>0){if(v){if(!h){f=p-1;a++}}else{if(h){l=p-1;a++}}}h=v}switch(a){case 0:if(h){var m=new o;this.ComputeMass(m,1);r.SetV(c.MulX(n,m.center));return m.mass}else{return 0}break;case 1:if(f==-1){f=this.m_vertexCount-1}else{l=this.m_vertexCount-1}break}var g=parseInt((f+1)%this.m_vertexCount);var y=parseInt((l+1)%this.m_vertexCount);var b=(0-u[f])/(u[g]-u[f]);var w=(0-u[l])/(u[y]-u[l]);var E=new d(this.m_vertices[f].x*(1-b)+this.m_vertices[g].x*b,this.m_vertices[f].y*(1-b)+this.m_vertices[g].y*b);var S=new d(this.m_vertices[l].x*(1-w)+this.m_vertices[y].x*w,this.m_vertices[l].y*(1-w)+this.m_vertices[y].y*w);var x=0;var T=new d;var N=this.m_vertices[g];var C;p=g;while(p!=y){p=(p+1)%this.m_vertexCount;if(p==y)C=S;else C=this.m_vertices[p];var k=.5*((N.x-E.x)*(C.y-E.y)-(N.y-E.y)*(C.x-E.x));x+=k;T.x+=k*(E.x+N.x+C.x)/3;T.y+=k*(E.y+N.y+C.y)/3;N=C}T.Multiply(1/x);r.SetV(c.MulX(n,T));return x};u.prototype.GetVertexCount=function(){return this.m_vertexCount};u.prototype.GetVertices=function(){return this.m_vertices};u.prototype.GetNormals=function(){return this.m_normals};u.prototype.GetSupport=function(e){var t=0;var n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(i>n){t=r;n=i}}return t};u.prototype.GetSupportVertex=function(e){var t=0;var n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(i>n){t=r;n=i}}return this.m_vertices[t]};u.prototype.Validate=function(){return false};u.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=a.e_polygonShape;this.m_centroid=new d;this.m_vertices=new Vector;this.m_normals=new Vector};u.prototype.Reserve=function(e){if(e===undefined)e=0;for(var t=parseInt(this.m_vertices.length);t<e;t++){this.m_vertices[t]=new d;this.m_normals[t]=new d}};u.ComputeCentroid=function(e,t){if(t===undefined)t=0;var n=new d;var r=0;var i=0;var s=0;var o=1/3;for(var u=0;u<t;++u){var a=e[u];var f=u+1<t?e[parseInt(u+1)]:e[0];var l=a.x-i;var c=a.y-s;var h=f.x-i;var p=f.y-s;var v=l*p-c*h;var m=.5*v;r+=m;n.x+=m*o*(i+a.x+f.x);n.y+=m*o*(s+a.y+f.y)}n.x*=1/r;n.y*=1/r;return n};u.ComputeOBB=function(e,t,n){if(n===undefined)n=0;var r=0;var i=new Vector(n+1);for(r=0;r<n;++r){i[r]=t[r]}i[n]=i[0];var s=Number.MAX_VALUE;for(r=1;r<=n;++r){var o=i[parseInt(r-1)];var u=i[r].x-o.x;var a=i[r].y-o.y;var f=Math.sqrt(u*u+a*a);u/=f;a/=f;var l=-a;var c=u;var h=Number.MAX_VALUE;var p=Number.MAX_VALUE;var d=-Number.MAX_VALUE;var v=-Number.MAX_VALUE;for(var m=0;m<n;++m){var g=i[m].x-o.x;var y=i[m].y-o.y;var b=u*g+a*y;var w=l*g+c*y;if(b<h)h=b;if(w<p)p=w;if(b>d)d=b;if(w>v)v=w}var E=(d-h)*(v-p);if(E<.95*s){s=E;e.R.col1.x=u;e.R.col1.y=a;e.R.col2.x=l;e.R.col2.y=c;var S=.5*(h+d);var x=.5*(p+v);var T=e.R;e.center.x=o.x+(T.col1.x*S+T.col2.x*x);e.center.y=o.y+(T.col1.y*S+T.col2.y*x);e.extents.x=.5*(d-h);e.extents.y=.5*(v-p)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new f});a.b2Shape=function(){};a.prototype.Copy=function(){return null};a.prototype.Set=function(e){this.m_radius=e.m_radius};a.prototype.GetType=function(){return this.m_type};a.prototype.TestPoint=function(e,t){return false};a.prototype.RayCast=function(e,t,n){return false};a.prototype.ComputeAABB=function(e,t){};a.prototype.ComputeMass=function(e,t){if(t===undefined)t=0};a.prototype.ComputeSubmergedArea=function(e,t,n,r){if(t===undefined)t=0;return 0};a.TestOverlap=function(e,t,n,r){var i=new j;i.proxyA=new I;i.proxyA.Set(e);i.proxyB=new I;i.proxyB.Set(n);i.transformA=t;i.transformB=r;i.useRadii=true;var s=new Y;s.count=0;var o=new F;B.Distance(o,s,i);return o.distance<10*Number.MIN_VALUE};a.prototype.b2Shape=function(){this.m_type=a.e_unknownShape;this.m_radius=n.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,f=Box2D.Common.Math.b2Vec3;e.b2Color=function(){this._r=0;this._g=0;this._b=0};e.prototype.b2Color=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;this._r=Box2D.parseUInt(255*s.Clamp(e,0,1));this._g=Box2D.parseUInt(255*s.Clamp(t,0,1));this._b=Box2D.parseUInt(255*s.Clamp(n,0,1))};e.prototype.Set=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;this._r=Box2D.parseUInt(255*s.Clamp(e,0,1));this._g=Box2D.parseUInt(255*s.Clamp(t,0,1));this._b=Box2D.parseUInt(255*s.Clamp(n,0,1))};Object.defineProperty(e.prototype,"r",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._r=Box2D.parseUInt(255*s.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"g",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._g=Box2D.parseUInt(255*s.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"b",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._b=Box2D.parseUInt(255*s.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});n.b2Settings=function(){};n.b2MixFriction=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return Math.sqrt(e*t)};n.b2MixRestitution=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e>t?e:t};n.b2Assert=function(e){if(!e){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*n.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*n.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*n.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*n.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=n.b2_maxTranslation*n.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*n.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=n.b2_maxRotation*n.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*n.b2_pi})})();(function(){var e=Box2D.Collision.b2AABB,t=Box2D.Common.b2Color,n=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Mat22,s=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,u=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3;i.b2Mat22=function(){this.col1=new f;this.col2=new f};i.prototype.b2Mat22=function(){this.SetIdentity()};i.FromAngle=function(e){if(e===undefined)e=0;var t=new i;t.Set(e);return t};i.FromVV=function(e,t){var n=new i;n.SetVV(e,t);return n};i.prototype.Set=function(e){if(e===undefined)e=0;var t=Math.cos(e);var n=Math.sin(e);this.col1.x=t;this.col2.x=-n;this.col1.y=n;this.col2.y=t};i.prototype.SetVV=function(e,t){this.col1.SetV(e);this.col2.SetV(t)};i.prototype.Copy=function(){var e=new i;e.SetM(this);return e};i.prototype.SetM=function(e){this.col1.SetV(e.col1);this.col2.SetV(e.col2)};i.prototype.AddM=function(e){this.col1.x+=e.col1.x;this.col1.y+=e.col1.y;this.col2.x+=e.col2.x;this.col2.y+=e.col2.y};i.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};i.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};i.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};i.prototype.GetInverse=function(e){var t=this.col1.x;var n=this.col2.x;var r=this.col1.y;var i=this.col2.y;var s=t*i-n*r;if(s!=0){s=1/s}e.col1.x=s*i;e.col2.x=-s*n;e.col1.y=-s*r;e.col2.y=s*t;return e};i.prototype.Solve=function(e,t,n){if(t===undefined)t=0;if(n===undefined)n=0;var r=this.col1.x;var i=this.col2.x;var s=this.col1.y;var o=this.col2.y;var u=r*o-i*s;if(u!=0){u=1/u}e.x=u*(o*t-i*n);e.y=u*(r*n-s*t);return e};i.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};s.b2Mat33=function(){this.col1=new l;this.col2=new l;this.col3=new l};s.prototype.b2Mat33=function(e,t,n){if(e===undefined)e=null;if(t===undefined)t=null;if(n===undefined)n=null;if(!e&&!t&&!n){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(e);this.col2.SetV(t);this.col3.SetV(n)}};s.prototype.SetVVV=function(e,t,n){this.col1.SetV(e);this.col2.SetV(t);this.col3.SetV(n)};s.prototype.Copy=function(){return new s(this.col1,this.col2,this.col3)};s.prototype.SetM=function(e){this.col1.SetV(e.col1);this.col2.SetV(e.col2);this.col3.SetV(e.col3)};s.prototype.AddM=function(e){this.col1.x+=e.col1.x;this.col1.y+=e.col1.y;this.col1.z+=e.col1.z;this.col2.x+=e.col2.x;this.col2.y+=e.col2.y;this.col2.z+=e.col2.z;this.col3.x+=e.col3.x;this.col3.y+=e.col3.y;this.col3.z+=e.col3.z};s.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};s.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};s.prototype.Solve22=function(e,t,n){if(t===undefined)t=0;if(n===undefined)n=0;var r=this.col1.x;var i=this.col2.x;var s=this.col1.y;var o=this.col2.y;var u=r*o-i*s;if(u!=0){u=1/u}e.x=u*(o*t-i*n);e.y=u*(r*n-s*t);return e};s.prototype.Solve33=function(e,t,n,r){if(t===undefined)t=0;if(n===undefined)n=0;if(r===undefined)r=0;var i=this.col1.x;var s=this.col1.y;var o=this.col1.z;var u=this.col2.x;var a=this.col2.y;var f=this.col2.z;var l=this.col3.x;var c=this.col3.y;var h=this.col3.z;var p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);if(p!=0){p=1/p}e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l));e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l));e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t));return e};o.b2Math=function(){};o.IsValid=function(e){if(e===undefined)e=0;return isFinite(e)};o.Dot=function(e,t){return e.x*t.x+e.y*t.y};o.CrossVV=function(e,t){return e.x*t.y-e.y*t.x};o.CrossVF=function(e,t){if(t===undefined)t=0;var n=new f(t*e.y,-t*e.x);return n};o.CrossFV=function(e,t){if(e===undefined)e=0;var n=new f(-e*t.y,e*t.x);return n};o.MulMV=function(e,t){var n=new f(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return n};o.MulTMV=function(e,t){var n=new f(o.Dot(t,e.col1),o.Dot(t,e.col2));return n};o.MulX=function(e,t){var n=o.MulMV(e.R,t);n.x+=e.position.x;n.y+=e.position.y;return n};o.MulXT=function(e,t){var n=o.SubtractVV(t,e.position);var r=n.x*e.R.col1.x+n.y*e.R.col1.y;n.y=n.x*e.R.col2.x+n.y*e.R.col2.y;n.x=r;return n};o.AddVV=function(e,t){var n=new f(e.x+t.x,e.y+t.y);return n};o.SubtractVV=function(e,t){var n=new f(e.x-t.x,e.y-t.y);return n};o.Distance=function(e,t){var n=e.x-t.x;var r=e.y-t.y;return Math.sqrt(n*n+r*r)};o.DistanceSquared=function(e,t){var n=e.x-t.x;var r=e.y-t.y;return n*n+r*r};o.MulFV=function(e,t){if(e===undefined)e=0;var n=new f(e*t.x,e*t.y);return n};o.AddMM=function(e,t){var n=i.FromVV(o.AddVV(e.col1,t.col1),o.AddVV(e.col2,t.col2));return n};o.MulMM=function(e,t){var n=i.FromVV(o.MulMV(e,t.col1),o.MulMV(e,t.col2));return n};o.MulTMM=function(e,t){var n=new f(o.Dot(e.col1,t.col1),o.Dot(e.col2,t.col1));var r=new f(o.Dot(e.col1,t.col2),o.Dot(e.col2,t.col2));var s=i.FromVV(n,r);return s};o.Abs=function(e){if(e===undefined)e=0;return e>0?e:-e};o.AbsV=function(e){var t=new f(o.Abs(e.x),o.Abs(e.y));return t};o.AbsM=function(e){var t=i.FromVV(o.AbsV(e.col1),o.AbsV(e.col2));return t};o.Min=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e<t?e:t};o.MinV=function(e,t){var n=new f(o.Min(e.x,t.x),o.Min(e.y,t.y));return n};o.Max=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e>t?e:t};o.MaxV=function(e,t){var n=new f(o.Max(e.x,t.x),o.Max(e.y,t.y));return n};o.Clamp=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;return e<t?t:e>n?n:e};o.ClampV=function(e,t,n){return o.MaxV(t,o.MinV(e,n))};o.Swap=function(e,t){var n=e[0];e[0]=t[0];t[0]=n};o.Random=function(){return Math.random()*2-1};o.RandomRange=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;var n=Math.random();n=(t-e)*n+e;return n};o.NextPowerOfTwo=function(e){if(e===undefined)e=0;e|=e>>1&2147483647;e|=e>>2&1073741823;e|=e>>4&268435455;e|=e>>8&16777215;e|=e>>16&65535;return e+1};o.IsPowerOfTwo=function(e){if(e===undefined)e=0;var t=e>0&&(e&e-1)==0;return t};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new f(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=i.FromVV(new f(1,0),new f(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new a(o.b2Vec2_zero,o.b2Mat22_identity)});u.b2Sweep=function(){this.localCenter=new f;this.c0=new f;this.c=new f};u.prototype.Set=function(e){this.localCenter.SetV(e.localCenter);this.c0.SetV(e.c0);this.c.SetV(e.c);this.a0=e.a0;this.a=e.a;this.t0=e.t0};u.prototype.Copy=function(){var e=new u;e.localCenter.SetV(this.localCenter);e.c0.SetV(this.c0);e.c.SetV(this.c);e.a0=this.a0;e.a=this.a;e.t0=this.t0;return e};u.prototype.GetTransform=function(e,t){if(t===undefined)t=0;e.position.x=(1-t)*this.c0.x+t*this.c.x;e.position.y=(1-t)*this.c0.y+t*this.c.y;var n=(1-t)*this.a0+t*this.a;e.R.Set(n);var r=e.R;e.position.x-=r.col1.x*this.localCenter.x+r.col2.x*this.localCenter.y;e.position.y-=r.col1.y*this.localCenter.x+r.col2.y*this.localCenter.y};u.prototype.Advance=function(e){if(e===undefined)e=0;if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x;this.c0.y=(1-t)*this.c0.y+t*this.c.y;this.a0=(1-t)*this.a0+t*this.a;this.t0=e}};a.b2Transform=function(){this.position=new f;this.R=new i};a.prototype.b2Transform=function(e,t){if(e===undefined)e=null;if(t===undefined)t=null;if(e){this.position.SetV(e);this.R.SetM(t)}};a.prototype.Initialize=function(e,t){this.position.SetV(e);this.R.SetM(t)};a.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};a.prototype.Set=function(e){this.position.SetV(e.position);this.R.SetM(e.R)};a.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};f.b2Vec2=function(){};f.prototype.b2Vec2=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.x=e;this.y=t};f.prototype.SetZero=function(){this.x=0;this.y=0};f.prototype.Set=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.x=e;this.y=t};f.prototype.SetV=function(e){this.x=e.x;this.y=e.y};f.prototype.GetNegative=function(){return new f(-this.x,-this.y)};f.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};f.Make=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return new f(e,t)};f.prototype.Copy=function(){return new f(this.x,this.y)};f.prototype.Add=function(e){this.x+=e.x;this.y+=e.y};f.prototype.Subtract=function(e){this.x-=e.x;this.y-=e.y};f.prototype.Multiply=function(e){if(e===undefined)e=0;this.x*=e;this.y*=e};f.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y;this.y=e.col1.y*t+e.col2.y*this.y};f.prototype.MulTM=function(e){var t=o.Dot(this,e.col1);this.y=o.Dot(this,e.col2);this.x=t};f.prototype.CrossVF=function(e){if(e===undefined)e=0;var t=this.x;this.x=e*this.y;this.y=-e*t};f.prototype.CrossFV=function(e){if(e===undefined)e=0;var t=this.x;this.x=-e*this.y;this.y=e*t};f.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x;this.y=this.y<e.y?this.y:e.y};f.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x;this.y=this.y>e.y?this.y:e.y};f.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};f.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};f.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};f.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE){return 0}var t=1/e;this.x*=t;this.y*=t;return e};f.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)};l.b2Vec3=function(){};l.prototype.b2Vec3=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;this.x=e;this.y=t;this.z=n};l.prototype.SetZero=function(){this.x=this.y=this.z=0};l.prototype.Set=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;this.x=e;this.y=t;this.z=n};l.prototype.SetV=function(e){this.x=e.x;this.y=e.y;this.z=e.z};l.prototype.GetNegative=function(){return new l(-this.x,-this.y,-this.z)};l.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};l.prototype.Copy=function(){return new l(this.x,this.y,this.z)};l.prototype.Add=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z};l.prototype.Subtract=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z};l.prototype.Multiply=function(e){if(e===undefined)e=0;this.x*=e;this.y*=e;this.z*=e}})();(function(){var e=Box2D.Dynamics.Controllers.b2ControllerEdge,t=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3,a=Box2D.Common.b2Color,f=Box2D.Common.b2internal,l=Box2D.Common.b2Settings,c=Box2D.Collision.b2AABB,h=Box2D.Collision.b2Bound,p=Box2D.Collision.b2BoundValues,d=Box2D.Collision.b2Collision,v=Box2D.Collision.b2ContactID,m=Box2D.Collision.b2ContactPoint,g=Box2D.Collision.b2Distance,y=Box2D.Collision.b2DistanceInput,b=Box2D.Collision.b2DistanceOutput,w=Box2D.Collision.b2DistanceProxy,E=Box2D.Collision.b2DynamicTree,S=Box2D.Collision.b2DynamicTreeBroadPhase,x=Box2D.Collision.b2DynamicTreeNode,T=Box2D.Collision.b2DynamicTreePair,N=Box2D.Collision.b2Manifold,C=Box2D.Collision.b2ManifoldPoint,k=Box2D.Collision.b2Point,L=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,O=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,_=Box2D.Collision.b2Simplex,D=Box2D.Collision.b2SimplexCache,P=Box2D.Collision.b2SimplexVertex,H=Box2D.Collision.b2TimeOfImpact,B=Box2D.Collision.b2TOIInput,j=Box2D.Collision.b2WorldManifold,F=Box2D.Collision.ClipVertex,I=Box2D.Collision.Features,q=Box2D.Collision.IBroadPhase,R=Box2D.Collision.Shapes.b2CircleShape,U=Box2D.Collision.Shapes.b2EdgeChainDef,z=Box2D.Collision.Shapes.b2EdgeShape,W=Box2D.Collision.Shapes.b2MassData,X=Box2D.Collision.Shapes.b2PolygonShape,V=Box2D.Collision.Shapes.b2Shape,$=Box2D.Dynamics.b2Body,J=Box2D.Dynamics.b2BodyDef,K=Box2D.Dynamics.b2ContactFilter,Q=Box2D.Dynamics.b2ContactImpulse,G=Box2D.Dynamics.b2ContactListener,Y=Box2D.Dynamics.b2ContactManager,Z=Box2D.Dynamics.b2DebugDraw,et=Box2D.Dynamics.b2DestructionListener,tt=Box2D.Dynamics.b2FilterData,nt=Box2D.Dynamics.b2Fixture,rt=Box2D.Dynamics.b2FixtureDef,it=Box2D.Dynamics.b2Island,st=Box2D.Dynamics.b2TimeStep,ot=Box2D.Dynamics.b2World,ut=Box2D.Dynamics.Contacts.b2CircleContact,at=Box2D.Dynamics.Contacts.b2Contact,ft=Box2D.Dynamics.Contacts.b2ContactConstraint,lt=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ct=Box2D.Dynamics.Contacts.b2ContactEdge,ht=Box2D.Dynamics.Contacts.b2ContactFactory,pt=Box2D.Dynamics.Contacts.b2ContactRegister,dt=Box2D.Dynamics.Contacts.b2ContactResult,vt=Box2D.Dynamics.Contacts.b2ContactSolver,mt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,gt=Box2D.Dynamics.Contacts.b2NullContact,yt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,bt=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,wt=Box2D.Dynamics.Contacts.b2PolygonContact,Et=Box2D.Dynamics.Contacts.b2PositionSolverManifold,St=Box2D.Dynamics.Controllers.b2Controller,xt=Box2D.Dynamics.Joints.b2DistanceJoint,Tt=Box2D.Dynamics.Joints.b2DistanceJointDef,Nt=Box2D.Dynamics.Joints.b2FrictionJoint,Ct=Box2D.Dynamics.Joints.b2FrictionJointDef,kt=Box2D.Dynamics.Joints.b2GearJoint,Lt=Box2D.Dynamics.Joints.b2GearJointDef,At=Box2D.Dynamics.Joints.b2Jacobian,Ot=Box2D.Dynamics.Joints.b2Joint,Mt=Box2D.Dynamics.Joints.b2JointDef,_t=Box2D.Dynamics.Joints.b2JointEdge,Dt=Box2D.Dynamics.Joints.b2LineJoint,Pt=Box2D.Dynamics.Joints.b2LineJointDef,Ht=Box2D.Dynamics.Joints.b2MouseJoint,Bt=Box2D.Dynamics.Joints.b2MouseJointDef,jt=Box2D.Dynamics.Joints.b2PrismaticJoint,Ft=Box2D.Dynamics.Joints.b2PrismaticJointDef,It=Box2D.Dynamics.Joints.b2PulleyJoint,qt=Box2D.Dynamics.Joints.b2PulleyJointDef,Rt=Box2D.Dynamics.Joints.b2RevoluteJoint,Ut=Box2D.Dynamics.Joints.b2RevoluteJointDef,zt=Box2D.Dynamics.Joints.b2WeldJoint,Wt=Box2D.Dynamics.Joints.b2WeldJointDef;$.b2Body=function(){this.m_xf=new s;this.m_sweep=new i;this.m_linearVelocity=new o;this.m_force=new o};$.prototype.connectEdges=function(e,t,n){if(n===undefined)n=0;var i=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x);var s=Math.tan((i-n)*.5);var o=r.MulFV(s,t.GetDirectionVector());o=r.SubtractVV(o,t.GetNormalVector());o=r.MulFV(l.b2_toiSlop,o);o=r.AddVV(o,t.GetVertex1());var u=r.AddVV(e.GetDirectionVector(),t.GetDirectionVector());u.Normalize();var a=r.Dot(e.GetDirectionVector(),t.GetNormalVector())>0;e.SetNextEdge(t,o,u,a);t.SetPrevEdge(e,o,u,a);return i};$.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==true){return null}var t=new nt;t.Create(this,this.m_xf,e);if(this.m_flags&$.e_activeFlag){var n=this.m_world.m_contactManager.m_broadPhase;t.CreateProxy(n,this.m_xf)}t.m_next=this.m_fixtureList;this.m_fixtureList=t;++this.m_fixtureCount;t.m_body=this;if(t.m_density>0){this.ResetMassData()}this.m_world.m_flags|=ot.e_newFixture;return t};$.prototype.CreateFixture2=function(e,t){if(t===undefined)t=0;var n=new rt;n.shape=e;n.density=t;return this.CreateFixture(n)};$.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()==true){return}var t=this.m_fixtureList;var n=null;var r=false;while(t!=null){if(t==e){if(n)n.m_next=e.m_next;else this.m_fixtureList=e.m_next;r=true;break}n=t;t=t.m_next}var i=this.m_contactList;while(i){var s=i.contact;i=i.next;var o=s.GetFixtureA();var u=s.GetFixtureB();if(e==o||e==u){this.m_world.m_contactManager.Destroy(s)}}if(this.m_flags&$.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxy(a)}else{}e.Destroy();e.m_body=null;e.m_next=null;--this.m_fixtureCount;this.ResetMassData()};$.prototype.SetPositionAndAngle=function(e,t){if(t===undefined)t=0;var n;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(t);this.m_xf.position.SetV(e);var r=this.m_xf.R;var i=this.m_sweep.localCenter;this.m_sweep.c.x=r.col1.x*i.x+r.col2.x*i.y;this.m_sweep.c.y=r.col1.y*i.x+r.col2.y*i.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=t;var s=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(s,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};$.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())};$.prototype.GetTransform=function(){return this.m_xf};$.prototype.GetPosition=function(){return this.m_xf.position};$.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())};$.prototype.GetAngle=function(){return this.m_sweep.a};$.prototype.SetAngle=function(e){if(e===undefined)e=0;this.SetPositionAndAngle(this.GetPosition(),e)};$.prototype.GetWorldCenter=function(){return this.m_sweep.c};$.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};$.prototype.SetLinearVelocity=function(e){if(this.m_type==$.b2_staticBody){return}this.m_linearVelocity.SetV(e)};$.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};$.prototype.SetAngularVelocity=function(e){if(e===undefined)e=0;if(this.m_type==$.b2_staticBody){return}this.m_angularVelocity=e};$.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};$.prototype.GetDefinition=function(){var e=new J;e.type=this.GetType();e.allowSleep=(this.m_flags&$.e_allowSleepFlag)==$.e_allowSleepFlag;e.angle=this.GetAngle();e.angularDamping=this.m_angularDamping;e.angularVelocity=this.m_angularVelocity;e.fixedRotation=(this.m_flags&$.e_fixedRotationFlag)==$.e_fixedRotationFlag;e.bullet=(this.m_flags&$.e_bulletFlag)==$.e_bulletFlag;e.awake=(this.m_flags&$.e_awakeFlag)==$.e_awakeFlag;e.linearDamping=this.m_linearDamping;e.linearVelocity.SetV(this.GetLinearVelocity());e.position=this.GetPosition();e.userData=this.GetUserData();return e};$.prototype.ApplyForce=function(e,t){if(this.m_type!=$.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=e.x;this.m_force.y+=e.y;this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x};$.prototype.ApplyTorque=function(e){if(e===undefined)e=0;if(this.m_type!=$.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=e};$.prototype.ApplyImpulse=function(e,t){if(this.m_type!=$.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*e.x;this.m_linearVelocity.y+=this.m_invMass*e.y;this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)};$.prototype.Split=function(e){var t=this.GetLinearVelocity().Copy();var n=this.GetAngularVelocity();var i=this.GetWorldCenter();var s=this;var o=this.m_world.CreateBody(this.GetDefinition());var u;for(var a=s.m_fixtureList;a;){if(e(a)){var f=a.m_next;if(u){u.m_next=f}else{s.m_fixtureList=f}s.m_fixtureCount--;a.m_next=o.m_fixtureList;o.m_fixtureList=a;o.m_fixtureCount++;a.m_body=o;a=f}else{u=a;a=a.m_next}}s.ResetMassData();o.ResetMassData();var l=s.GetWorldCenter();var c=o.GetWorldCenter();var h=r.AddVV(t,r.CrossFV(n,r.SubtractVV(l,i)));var p=r.AddVV(t,r.CrossFV(n,r.SubtractVV(c,i)));s.SetLinearVelocity(h);o.SetLinearVelocity(p);s.SetAngularVelocity(n);o.SetAngularVelocity(n);s.SynchronizeFixtures();o.SynchronizeFixtures();return o};$.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--;t.m_next=this.m_fixtureList;this.m_fixtureList=t;this.m_fixtureCount++;t.m_body=i;t=n}r.m_fixtureCount=0;var r=this;var i=e;var s=r.GetWorldCenter();var o=i.GetWorldCenter();var u=r.GetLinearVelocity().Copy();var a=i.GetLinearVelocity().Copy();var f=r.GetAngularVelocity();var l=i.GetAngularVelocity();r.ResetMassData();this.SynchronizeFixtures()};$.prototype.GetMass=function(){return this.m_mass};$.prototype.GetInertia=function(){return this.m_I};$.prototype.GetMassData=function(e){e.mass=this.m_mass;e.I=this.m_I;e.center.SetV(this.m_sweep.localCenter)};$.prototype.SetMassData=function(e){l.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=$.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=e.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(e.I>0&&(this.m_flags&$.e_fixedRotationFlag)==0){this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y);this.m_invI=1/this.m_I}var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center);this.m_sweep.c0.SetV(r.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)};$.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==$.b2_staticBody||this.m_type==$.b2_kinematicBody){return}var e=o.Make(0,0);for(var t=this.m_fixtureList;t;t=t.m_next){if(t.m_density==0){continue}var n=t.GetMassData();this.m_mass+=n.mass;e.x+=n.center.x*n.mass;e.y+=n.center.y*n.mass;this.m_I+=n.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;e.x*=this.m_invMass;e.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&$.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y);this.m_I*=this.m_inertiaScale;l.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e);this.m_sweep.c0.SetV(r.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)};$.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;var n=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);n.x+=this.m_xf.position.x;n.y+=this.m_xf.position.y;return n};$.prototype.GetWorldVector=function(e){return r.MulMV(this.m_xf.R,e)};$.prototype.GetLocalPoint=function(e){return r.MulXT(this.m_xf,e)};$.prototype.GetLocalVector=function(e){return r.MulTMV(this.m_xf.R,e)};$.prototype.GetLinearVelocityFromWorldPoint=function(e){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))};$.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;var n=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);n.x+=this.m_xf.position.x;n.y+=this.m_xf.position.y;return new o(this.m_linearVelocity.x-this.m_angularVelocity*(n.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(n.x-this.m_sweep.c.x))};$.prototype.GetLinearDamping=function(){return this.m_linearDamping};$.prototype.SetLinearDamping=function(e){if(e===undefined)e=0;this.m_linearDamping=e};$.prototype.GetAngularDamping=function(){return this.m_angularDamping};$.prototype.SetAngularDamping=function(e){if(e===undefined)e=0;this.m_angularDamping=e};$.prototype.SetType=function(e){if(e===undefined)e=0;if(this.m_type==e){return}this.m_type=e;this.ResetMassData();if(this.m_type==$.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var t=this.m_contactList;t;t=t.next){t.contact.FlagForFiltering()}};$.prototype.GetType=function(){return this.m_type};$.prototype.SetBullet=function(e){if(e){this.m_flags|=$.e_bulletFlag}else{this.m_flags&=~$.e_bulletFlag}};$.prototype.IsBullet=function(){return(this.m_flags&$.e_bulletFlag)==$.e_bulletFlag};$.prototype.SetSleepingAllowed=function(e){if(e){this.m_flags|=$.e_allowSleepFlag}else{this.m_flags&=~$.e_allowSleepFlag;this.SetAwake(true)}};$.prototype.SetAwake=function(e){if(e){this.m_flags|=$.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~$.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};$.prototype.IsAwake=function(){return(this.m_flags&$.e_awakeFlag)==$.e_awakeFlag};$.prototype.SetFixedRotation=function(e){if(e){this.m_flags|=$.e_fixedRotationFlag}else{this.m_flags&=~$.e_fixedRotationFlag}this.ResetMassData()};$.prototype.IsFixedRotation=function(){return(this.m_flags&$.e_fixedRotationFlag)==$.e_fixedRotationFlag};$.prototype.SetActive=function(e){if(e==this.IsActive()){return}var t;var n;if(e){this.m_flags|=$.e_activeFlag;t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.CreateProxy(t,this.m_xf)}}else{this.m_flags&=~$.e_activeFlag;t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.DestroyProxy(t)}var r=this.m_contactList;while(r){var i=r;r=r.next;this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null}};$.prototype.IsActive=function(){return(this.m_flags&$.e_activeFlag)==$.e_activeFlag};$.prototype.IsSleepingAllowed=function(){return(this.m_flags&$.e_allowSleepFlag)==$.e_allowSleepFlag};$.prototype.GetFixtureList=function(){return this.m_fixtureList};$.prototype.GetJointList=function(){return this.m_jointList};$.prototype.GetControllerList=function(){return this.m_controllerList};$.prototype.GetContactList=function(){return this.m_contactList};$.prototype.GetNext=function(){return this.m_next};$.prototype.GetUserData=function(){return this.m_userData};$.prototype.SetUserData=function(e){this.m_userData=e};$.prototype.GetWorld=function(){return this.m_world};$.prototype.b2Body=function(e,t){this.m_flags=0;if(e.bullet){this.m_flags|=$.e_bulletFlag}if(e.fixedRotation){this.m_flags|=$.e_fixedRotationFlag}if(e.allowSleep){this.m_flags|=$.e_allowSleepFlag}if(e.awake){this.m_flags|=$.e_awakeFlag}if(e.active){this.m_flags|=$.e_activeFlag}this.m_world=t;this.m_xf.position.SetV(e.position);this.m_xf.R.Set(e.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y;this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(e.linearVelocity);this.m_angularVelocity=e.angularVelocity;this.m_linearDamping=e.linearDamping;this.m_angularDamping=e.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=e.type;if(this.m_type==$.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=e.inertiaScale;this.m_userData=e.userData;this.m_fixtureList=null;this.m_fixtureCount=0};$.prototype.SynchronizeFixtures=function(){var e=$.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R;var n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y);e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y);var r;var i=this.m_world.m_contactManager.m_broadPhase;for(r=this.m_fixtureList;r;r=r.m_next){r.Synchronize(i,e,this.m_xf)}};$.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R;var t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y);this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)};$.prototype.ShouldCollide=function(e){if(this.m_type!=$.b2_dynamicBody&&e.m_type!=$.b2_dynamicBody){return false}for(var t=this.m_jointList;t;t=t.next){if(t.other==e)if(t.joint.m_collideConnected==false){return false}}return true};$.prototype.Advance=function(e){if(e===undefined)e=0;this.m_sweep.Advance(e);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new s;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});J.b2BodyDef=function(){this.position=new o;this.linearVelocity=new o};J.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=$.b2_staticBody;this.active=true;this.inertiaScale=1};K.b2ContactFilter=function(){};K.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData();var r=t.GetFilterData();if(n.groupIndex==r.groupIndex&&n.groupIndex!=0){return n.groupIndex>0}var i=(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0;return i};K.prototype.RayCollide=function(e,t){if(!e)return true;return this.ShouldCollide(e instanceof nt?e:null,t)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new K});Q.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(l.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(l.b2_maxManifoldPoints)};G.b2ContactListener=function(){};G.prototype.BeginContact=function(e){};G.prototype.EndContact=function(e){};G.prototype.PreSolve=function(e,t){};G.prototype.PostSolve=function(e,t){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new G});Y.b2ContactManager=function(){};Y.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=K.b2_defaultFilter;this.m_contactListener=G.b2_defaultListener;this.m_contactFactory=new ht(this.m_allocator);this.m_broadPhase=new S};Y.prototype.AddPair=function(e,t){var n=e instanceof nt?e:null;var r=t instanceof nt?t:null;var i=n.GetBody();var s=r.GetBody();if(i==s)return;var o=s.GetContactList();while(o){if(o.other==i){var u=o.contact.GetFixtureA();var a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}if(s.ShouldCollide(i)==false){return}if(this.m_contactFilter.ShouldCollide(n,r)==false){return}var f=this.m_contactFactory.Create(n,r);n=f.GetFixtureA();r=f.GetFixtureB();i=n.m_body;s=r.m_body;f.m_prev=null;f.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=f}this.m_world.m_contactList=f;f.m_nodeA.contact=f;f.m_nodeA.other=s;f.m_nodeA.prev=null;f.m_nodeA.next=i.m_contactList;if(i.m_contactList!=null){i.m_contactList.prev=f.m_nodeA}i.m_contactList=f.m_nodeA;f.m_nodeB.contact=f;f.m_nodeB.other=i;f.m_nodeB.prev=null;f.m_nodeB.next=s.m_contactList;if(s.m_contactList!=null){s.m_contactList.prev=f.m_nodeB}s.m_contactList=f.m_nodeB;++this.m_world.m_contactCount;return};Y.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Y.prototype.Destroy=function(e){var t=e.GetFixtureA();var n=e.GetFixtureB();var r=t.GetBody();var i=n.GetBody();if(e.IsTouching()){this.m_contactListener.EndContact(e)}if(e.m_prev){e.m_prev.m_next=e.m_next}if(e.m_next){e.m_next.m_prev=e.m_prev}if(e==this.m_world.m_contactList){this.m_world.m_contactList=e.m_next}if(e.m_nodeA.prev){e.m_nodeA.prev.next=e.m_nodeA.next}if(e.m_nodeA.next){e.m_nodeA.next.prev=e.m_nodeA.prev}if(e.m_nodeA==r.m_contactList){r.m_contactList=e.m_nodeA.next}if(e.m_nodeB.prev){e.m_nodeB.prev.next=e.m_nodeB.next}if(e.m_nodeB.next){e.m_nodeB.next.prev=e.m_nodeB.prev}if(e.m_nodeB==i.m_contactList){i.m_contactList=e.m_nodeB.next}this.m_contactFactory.Destroy(e);--this.m_contactCount};Y.prototype.Collide=function(){var e=this.m_world.m_contactList;while(e){var t=e.GetFixtureA();var n=e.GetFixtureB();var r=t.GetBody();var i=n.GetBody();if(r.IsAwake()==false&&i.IsAwake()==false){e=e.GetNext();continue}if(e.m_flags&at.e_filterFlag){if(i.ShouldCollide(r)==false){var s=e;e=s.GetNext();this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(t,n)==false){s=e;e=s.GetNext();this.Destroy(s);continue}e.m_flags&=~at.e_filterFlag}var o=t.m_proxy;var u=n.m_proxy;var a=this.m_broadPhase.TestOverlap(o,u);if(a==false){s=e;e=s.GetNext();this.Destroy(s);continue}e.Update(this.m_contactListener);e=e.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new m});Z.b2DebugDraw=function(){};Z.prototype.b2DebugDraw=function(){};Z.prototype.SetFlags=function(e){if(e===undefined)e=0};Z.prototype.GetFlags=function(){};Z.prototype.AppendFlags=function(e){if(e===undefined)e=0};Z.prototype.ClearFlags=function(e){if(e===undefined)e=0};Z.prototype.SetSprite=function(e){};Z.prototype.GetSprite=function(){};Z.prototype.SetDrawScale=function(e){if(e===undefined)e=0};Z.prototype.GetDrawScale=function(){};Z.prototype.SetLineThickness=function(e){if(e===undefined)e=0};Z.prototype.GetLineThickness=function(){};Z.prototype.SetAlpha=function(e){if(e===undefined)e=0};Z.prototype.GetAlpha=function(){};Z.prototype.SetFillAlpha=function(e){if(e===undefined)e=0};Z.prototype.GetFillAlpha=function(){};Z.prototype.SetXFormScale=function(e){if(e===undefined)e=0};Z.prototype.GetXFormScale=function(){};Z.prototype.DrawPolygon=function(e,t,n){if(t===undefined)t=0};Z.prototype.DrawSolidPolygon=function(e,t,n){if(t===undefined)t=0};Z.prototype.DrawCircle=function(e,t,n){if(t===undefined)t=0};Z.prototype.DrawSolidCircle=function(e,t,n,r){if(t===undefined)t=0};Z.prototype.DrawSegment=function(e,t,n){};Z.prototype.DrawTransform=function(e){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});et.b2DestructionListener=function(){};et.prototype.SayGoodbyeJoint=function(e){};et.prototype.SayGoodbyeFixture=function(e){};tt.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};tt.prototype.Copy=function(){var e=new tt;e.categoryBits=this.categoryBits;e.maskBits=this.maskBits;e.groupIndex=this.groupIndex;return e};nt.b2Fixture=function(){this.m_filter=new tt};nt.prototype.GetType=function(){return this.m_shape.GetType()};nt.prototype.GetShape=function(){return this.m_shape};nt.prototype.SetSensor=function(e){if(this.m_isSensor==e)return;this.m_isSensor=e;if(this.m_body==null)return;var t=this.m_body.GetContactList();while(t){var n=t.contact;var r=n.GetFixtureA();var i=n.GetFixtureB();if(r==this||i==this)n.SetSensor(r.IsSensor()||i.IsSensor());t=t.next}};nt.prototype.IsSensor=function(){return this.m_isSensor};nt.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(this.m_body)return;var t=this.m_body.GetContactList();while(t){var n=t.contact;var r=n.GetFixtureA();var i=n.GetFixtureB();if(r==this||i==this)n.FlagForFiltering();t=t.next}};nt.prototype.GetFilterData=function(){return this.m_filter.Copy()};nt.prototype.GetBody=function(){return this.m_body};nt.prototype.GetNext=function(){return this.m_next};nt.prototype.GetUserData=function(){return this.m_userData};nt.prototype.SetUserData=function(e){this.m_userData=e};nt.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)};nt.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())};nt.prototype.GetMassData=function(e){if(e===undefined)e=null;if(e==null){e=new W}this.m_shape.ComputeMass(e,this.m_density);return e};nt.prototype.SetDensity=function(e){if(e===undefined)e=0;this.m_density=e};nt.prototype.GetDensity=function(){return this.m_density};nt.prototype.GetFriction=function(){return this.m_friction};nt.prototype.SetFriction=function(e){if(e===undefined)e=0;this.m_friction=e};nt.prototype.GetRestitution=function(){return this.m_restitution};nt.prototype.SetRestitution=function(e){if(e===undefined)e=0;this.m_restitution=e};nt.prototype.GetAABB=function(){return this.m_aabb};nt.prototype.b2Fixture=function(){this.m_aabb=new c;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};nt.prototype.Create=function(e,t,n){this.m_userData=n.userData;this.m_friction=n.friction;this.m_restitution=n.restitution;this.m_body=e;this.m_next=null;this.m_filter=n.filter.Copy();this.m_isSensor=n.isSensor;this.m_shape=n.shape.Copy();this.m_density=n.density};nt.prototype.Destroy=function(){this.m_shape=null};nt.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t);this.m_proxy=e.CreateProxy(this.m_aabb,this)};nt.prototype.DestroyProxy=function(e){if(this.m_proxy==null){return}e.DestroyProxy(this.m_proxy);this.m_proxy=null};nt.prototype.Synchronize=function(e,t,n){if(!this.m_proxy)return;var i=new c;var s=new c;this.m_shape.ComputeAABB(i,t);this.m_shape.ComputeAABB(s,n);this.m_aabb.Combine(i,s);var o=r.SubtractVV(n.position,t.position);e.MoveProxy(this.m_proxy,this.m_aabb,o)};rt.b2FixtureDef=function(){this.filter=new tt};rt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};it.b2Island=function(){};it.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};it.prototype.Initialize=function(e,t,n,r,i,s){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;var o=0;this.m_bodyCapacity=e;this.m_contactCapacity=t;this.m_jointCapacity=n;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=r;this.m_listener=i;this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null};it.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};it.prototype.Solve=function(e,t,n){var i=0;var s=0;var o;var u;for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()!=$.b2_dynamicBody)continue;o.m_linearVelocity.x+=e.dt*(t.x+o.m_invMass*o.m_force.x);o.m_linearVelocity.y+=e.dt*(t.y+o.m_invMass*o.m_force.y);o.m_angularVelocity+=e.dt*o.m_invI*o.m_torque;o.m_linearVelocity.Multiply(r.Clamp(1-e.dt*o.m_linearDamping,0,1));o.m_angularVelocity*=r.Clamp(1-e.dt*o.m_angularDamping,0,1)}this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var a=this.m_contactSolver;a.InitVelocityConstraints(e);for(i=0;i<this.m_jointCount;++i){u=this.m_joints[i];u.InitVelocityConstraints(e)}for(i=0;i<e.velocityIterations;++i){for(s=0;s<this.m_jointCount;++s){u=this.m_joints[s];u.SolveVelocityConstraints(e)}a.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i){u=this.m_joints[i];u.FinalizeVelocityConstraints()}a.FinalizeVelocityConstraints();for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()==$.b2_staticBody)continue;var f=e.dt*o.m_linearVelocity.x;var c=e.dt*o.m_linearVelocity.y;if(f*f+c*c>l.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=l.b2_maxTranslation*e.inv_dt;o.m_linearVelocity.y*=l.b2_maxTranslation*e.inv_dt}var h=e.dt*o.m_angularVelocity;if(h*h>l.b2_maxRotationSquared){if(o.m_angularVelocity<0){o.m_angularVelocity=-l.b2_maxRotation*e.inv_dt}else{o.m_angularVelocity=l.b2_maxRotation*e.inv_dt}}o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=e.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=e.dt*o.m_linearVelocity.y;o.m_sweep.a+=e.dt*o.m_angularVelocity;o.SynchronizeTransform()}for(i=0;i<e.positionIterations;++i){var p=a.SolvePositionConstraints(l.b2_contactBaumgarte);var d=true;for(s=0;s<this.m_jointCount;++s){u=this.m_joints[s];var v=u.SolvePositionConstraints(l.b2_contactBaumgarte);d=d&&v}if(p&&d){break}}this.Report(a.m_constraints);if(n){var m=Number.MAX_VALUE;var g=l.b2_linearSleepTolerance*l.b2_linearSleepTolerance;var y=l.b2_angularSleepTolerance*l.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()==$.b2_staticBody){continue}if((o.m_flags&$.e_allowSleepFlag)==0){o.m_sleepTime=0;m=0}if((o.m_flags&$.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>y||r.Dot(o.m_linearVelocity,o.m_linearVelocity)>g){o.m_sleepTime=0;m=0}else{o.m_sleepTime+=e.dt;m=r.Min(m,o.m_sleepTime)}}if(m>=l.b2_timeToSleep){for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];o.SetAwake(false)}}}};it.prototype.SolveTOI=function(e){var t=0;var n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t){this.m_joints[t].InitVelocityConstraints(e)}for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n){this.m_joints[n].SolveVelocityConstraints(e)}}for(t=0;t<this.m_bodyCount;++t){var i=this.m_bodies[t];if(i.GetType()==$.b2_staticBody)continue;var s=e.dt*i.m_linearVelocity.x;var o=e.dt*i.m_linearVelocity.y;if(s*s+o*o>l.b2_maxTranslationSquared){i.m_linearVelocity.Normalize();i.m_linearVelocity.x*=l.b2_maxTranslation*e.inv_dt;i.m_linearVelocity.y*=l.b2_maxTranslation*e.inv_dt}var u=e.dt*i.m_angularVelocity;if(u*u>l.b2_maxRotationSquared){if(i.m_angularVelocity<0){i.m_angularVelocity=-l.b2_maxRotation*e.inv_dt}else{i.m_angularVelocity=l.b2_maxRotation*e.inv_dt}}i.m_sweep.c0.SetV(i.m_sweep.c);i.m_sweep.a0=i.m_sweep.a;i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x;i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y;i.m_sweep.a+=e.dt*i.m_angularVelocity;i.SynchronizeTransform()}var a=.75;for(t=0;t<e.positionIterations;++t){var f=r.SolvePositionConstraints(a);var c=true;for(n=0;n<this.m_jointCount;++n){var h=this.m_joints[n].SolvePositionConstraints(l.b2_contactBaumgarte);c=c&&h}if(f&&c){break}}this.Report(r.m_constraints)};it.prototype.Report=function(e){if(this.m_listener==null){return}for(var t=0;t<this.m_contactCount;++t){var n=this.m_contacts[t];var r=e[t];for(var i=0;i<r.pointCount;++i){it.s_impulse.normalImpulses[i]=r.points[i].normalImpulse;it.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse}this.m_listener.PostSolve(n,it.s_impulse)}};it.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=e};it.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e};it.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new Q});st.b2TimeStep=function(){};st.prototype.Set=function(e){this.dt=e.dt;this.inv_dt=e.inv_dt;this.positionIterations=e.positionIterations;this.velocityIterations=e.velocityIterations;this.warmStarting=e.warmStarting};ot.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Y;this.m_contactSolver=new vt;this.m_island=new it};ot.prototype.b2World=function(e,t){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;ot.m_warmStarting=true;ot.m_continuousPhysics=true;this.m_allowSleep=t;this.m_gravity=e;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var n=new J;this.m_groundBody=this.CreateBody(n)};ot.prototype.SetDestructionListener=function(e){this.m_destructionListener=e};ot.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e};ot.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e};ot.prototype.SetDebugDraw=function(e){this.m_debugDraw=e};ot.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next){for(var r=n.m_fixtureList;r;r=r.m_next){r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)}}};ot.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};ot.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};ot.prototype.CreateBody=function(e){if(this.IsLocked()==true){return null}var t=new $(e,this);t.m_prev=null;t.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=t}this.m_bodyList=t;++this.m_bodyCount;return t};ot.prototype.DestroyBody=function(e){if(this.IsLocked()==true){return}var t=e.m_jointList;while(t){var n=t;t=t.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(n.joint)}this.DestroyJoint(n.joint)}var r=e.m_controllerList;while(r){var i=r;r=r.nextController;i.controller.RemoveBody(e)}var s=e.m_contactList;while(s){var o=s;s=s.next;this.m_contactManager.Destroy(o.contact)}e.m_contactList=null;var u=e.m_fixtureList;while(u){var a=u;u=u.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(a)}a.DestroyProxy(this.m_contactManager.m_broadPhase);a.Destroy()}e.m_fixtureList=null;e.m_fixtureCount=0;if(e.m_prev){e.m_prev.m_next=e.m_next}if(e.m_next){e.m_next.m_prev=e.m_prev}if(e==this.m_bodyList){this.m_bodyList=e.m_next}--this.m_bodyCount};ot.prototype.CreateJoint=function(e){var t=Ot.Create(e,null);t.m_prev=null;t.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=t}this.m_jointList=t;++this.m_jointCount;t.m_edgeA.joint=t;t.m_edgeA.other=t.m_bodyB;t.m_edgeA.prev=null;t.m_edgeA.next=t.m_bodyA.m_jointList;if(t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA;t.m_edgeB.joint=t;t.m_edgeB.other=t.m_bodyA;t.m_edgeB.prev=null;t.m_edgeB.next=t.m_bodyB.m_jointList;if(t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA;var r=e.bodyB;if(e.collideConnected==false){var i=r.GetContactList();while(i){if(i.other==n){i.contact.FlagForFiltering()}i=i.next}}return t};ot.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;if(e.m_prev){e.m_prev.m_next=e.m_next}if(e.m_next){e.m_next.m_prev=e.m_prev}if(e==this.m_jointList){this.m_jointList=e.m_next}var n=e.m_bodyA;var r=e.m_bodyB;n.SetAwake(true);r.SetAwake(true);if(e.m_edgeA.prev){e.m_edgeA.prev.next=e.m_edgeA.next}if(e.m_edgeA.next){e.m_edgeA.next.prev=e.m_edgeA.prev}if(e.m_edgeA==n.m_jointList){n.m_jointList=e.m_edgeA.next}e.m_edgeA.prev=null;e.m_edgeA.next=null;if(e.m_edgeB.prev){e.m_edgeB.prev.next=e.m_edgeB.next}if(e.m_edgeB.next){e.m_edgeB.next.prev=e.m_edgeB.prev}if(e.m_edgeB==r.m_jointList){r.m_jointList=e.m_edgeB.next}e.m_edgeB.prev=null;e.m_edgeB.next=null;Ot.Destroy(e,null);--this.m_jointCount;if(t==false){var i=r.GetContactList();while(i){if(i.other==n){i.contact.FlagForFiltering()}i=i.next}}};ot.prototype.AddController=function(e){e.m_next=this.m_controllerList;e.m_prev=null;this.m_controllerList=e;e.m_world=this;this.m_controllerCount++;return e};ot.prototype.RemoveController=function(e){if(e.m_prev)e.m_prev.m_next=e.m_next;if(e.m_next)e.m_next.m_prev=e.m_prev;if(this.m_controllerList==e)this.m_controllerList=e.m_next;this.m_controllerCount--};ot.prototype.CreateController=function(e){if(e.m_world!=this)throw new Error("Controller can only be a member of one world");e.m_next=this.m_controllerList;e.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=e;this.m_controllerList=e;++this.m_controllerCount;e.m_world=this;return e};ot.prototype.DestroyController=function(e){e.Clear();if(e.m_next)e.m_next.m_prev=e.m_prev;if(e.m_prev)e.m_prev.m_next=e.m_next;if(e==this.m_controllerList)this.m_controllerList=e.m_next;--this.m_controllerCount};ot.prototype.SetWarmStarting=function(e){ot.m_warmStarting=e};ot.prototype.SetContinuousPhysics=function(e){ot.m_continuousPhysics=e};ot.prototype.GetBodyCount=function(){return this.m_bodyCount};ot.prototype.GetJointCount=function(){return this.m_jointCount};ot.prototype.GetContactCount=function(){return this.m_contactCount};ot.prototype.SetGravity=function(e){this.m_gravity=e};ot.prototype.GetGravity=function(){return this.m_gravity};ot.prototype.GetGroundBody=function(){return this.m_groundBody};ot.prototype.Step=function(e,t,n){if(e===undefined)e=0;if(t===undefined)t=0;if(n===undefined)n=0;if(this.m_flags&ot.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~ot.e_newFixture}this.m_flags|=ot.e_locked;var r=ot.s_timestep2;r.dt=e;r.velocityIterations=t;r.positionIterations=n;if(e>0){r.inv_dt=1/e}else{r.inv_dt=0}r.dtRatio=this.m_inv_dt0*e;r.warmStarting=ot.m_warmStarting;this.m_contactManager.Collide();if(r.dt>0){this.Solve(r)}if(ot.m_continuousPhysics&&r.dt>0){this.SolveTOI(r)}if(r.dt>0){this.m_inv_dt0=r.inv_dt}this.m_flags&=~ot.e_locked};ot.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next){e.m_force.SetZero();e.m_torque=0}};ot.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags();var t=0;var n;var r;var i;var s;var u;var f=new o;var l=new o;var h=new o;var p;var d=new c;var v=new c;var m=[new o,new o,new o,new o];var g=new a(0,0,0);if(e&Z.e_shapeBit){for(n=this.m_bodyList;n;n=n.m_next){p=n.m_xf;for(r=n.GetFixtureList();r;r=r.m_next){i=r.GetShape();if(n.IsActive()==false){g.Set(.5,.5,.3);this.DrawShape(i,p,g)}else if(n.GetType()==$.b2_staticBody){g.Set(.5,.9,.5);this.DrawShape(i,p,g)}else if(n.GetType()==$.b2_kinematicBody){g.Set(.5,.5,.9);this.DrawShape(i,p,g)}else if(n.IsAwake()==false){g.Set(.6,.6,.6);this.DrawShape(i,p,g)}else{g.Set(.9,.7,.7);this.DrawShape(i,p,g)}}}}if(e&Z.e_jointBit){for(s=this.m_jointList;s;s=s.m_next){this.DrawJoint(s)}}if(e&Z.e_controllerBit){for(var y=this.m_controllerList;y;y=y.m_next){y.Draw(this.m_debugDraw)}}if(e&Z.e_pairBit){g.Set(.3,.9,.9);for(var b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var w=b.GetFixtureA();var E=b.GetFixtureB();var S=w.GetAABB().GetCenter();var x=E.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(S,x,g)}}if(e&Z.e_aabbBit){g.Set(.9,.3,.9);u=this.m_contactManager.m_broadPhase;m=[new o,new o,new o,new o];for(n=this.m_bodyList;n;n=n.GetNext()){if(n.IsActive()==false){continue}for(r=n.GetFixtureList();r;r=r.GetNext()){var T=u.GetFatAABB(r.m_proxy);m[0].Set(T.lowerBound.x,T.lowerBound.y);m[1].Set(T.upperBound.x,T.lowerBound.y);m[2].Set(T.upperBound.x,T.upperBound.y);m[3].Set(T.lowerBound.x,T.upperBound.y);this.m_debugDraw.DrawPolygon(m,4,g)}}}if(e&Z.e_centerOfMassBit){for(n=this.m_bodyList;n;n=n.m_next){p=ot.s_xf;p.R=n.m_xf.R;p.position=n.GetWorldCenter();this.m_debugDraw.DrawTransform(p)}}};ot.prototype.QueryAABB=function(e,t){function i(t){return e.ReportFixture(r.GetUserData(t))}var n=this;var r=n.m_contactManager.m_broadPhase;r.Query(i,t)};ot.prototype.QueryShape=function(e,t,n){function o(r){var s=i.GetUserData(r)instanceof nt?i.GetUserData(r):null;if(V.TestOverlap(t,n,s.GetShape(),s.GetBody().GetTransform()))return e(s);return true}var r=this;if(n===undefined)n=null;if(n==null){n=new s;n.SetIdentity()}var i=r.m_contactManager.m_broadPhase;var u=new c;t.ComputeAABB(u,n);i.Query(o,u)};ot.prototype.QueryPoint=function(e,t){function i(n){var i=r.GetUserData(n)instanceof nt?r.GetUserData(n):null;if(i.TestPoint(t))return e(i);return true}var n=this;var r=n.m_contactManager.m_broadPhase;var s=new c;s.lowerBound.Set(t.x-l.b2_linearSlop,t.y-l.b2_linearSlop);s.upperBound.Set(t.x+l.b2_linearSlop,t.y+l.b2_linearSlop);r.Query(i,s)};ot.prototype.RayCast=function(e,t,n){function u(r,u){var a=i.GetUserData(u);var f=a instanceof nt?a:null;var l=f.RayCast(s,r);if(l){var c=s.fraction;var h=new o((1-c)*t.x+c*n.x,(1-c)*t.y+c*n.y);return e.ReportFixture(f,h,s.normal,c)}return r.maxFraction}var r=this;var i=r.m_contactManager.m_broadPhase;var s=new A;var a=new L(t,n);i.RayCast(u,a)};ot.prototype.RayCastOne=function(e,t){function i(e,t,n,i){if(i===undefined)i=0;r=e;return i}var n=this;var r;n.RayCast(i,e,t);return r};ot.prototype.RayCastAll=function(e,t){function i(e,t,n,i){if(i===undefined)i=0;r[r.length]=e;return 1}var n=this;var r=new Vector;n.RayCast(i,e,t);return r};ot.prototype.GetBodyList=function(){return this.m_bodyList};ot.prototype.GetJointList=function(){return this.m_jointList};ot.prototype.GetContactList=function(){return this.m_contactList};ot.prototype.IsLocked=function(){return(this.m_flags&ot.e_locked)>0};ot.prototype.Solve=function(e){var t;for(var n=this.m_controllerList;n;n=n.m_next){n.Step(e)}var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next){t.m_flags&=~$.e_islandFlag}for(var i=this.m_contactList;i;i=i.m_next){i.m_flags&=~at.e_islandFlag}for(var s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}var o=parseInt(this.m_bodyCount);var u=this.s_stack;for(var a=this.m_bodyList;a;a=a.m_next){if(a.m_flags&$.e_islandFlag){continue}if(a.IsAwake()==false||a.IsActive()==false){continue}if(a.GetType()==$.b2_staticBody){continue}r.Clear();var f=0;u[f++]=a;a.m_flags|=$.e_islandFlag;while(f>0){t=u[--f];r.AddBody(t);if(t.IsAwake()==false){t.SetAwake(true)}if(t.GetType()==$.b2_staticBody){continue}var l;for(var c=t.m_contactList;c;c=c.next){if(c.contact.m_flags&at.e_islandFlag){continue}if(c.contact.IsSensor()==true||c.contact.IsEnabled()==false||c.contact.IsTouching()==false){continue}r.AddContact(c.contact);c.contact.m_flags|=at.e_islandFlag;l=c.other;if(l.m_flags&$.e_islandFlag){continue}u[f++]=l;l.m_flags|=$.e_islandFlag}for(var h=t.m_jointList;h;h=h.next){if(h.joint.m_islandFlag==true){continue}l=h.other;if(l.IsActive()==false){continue}r.AddJoint(h.joint);h.joint.m_islandFlag=true;if(l.m_flags&$.e_islandFlag){continue}u[f++]=l;l.m_flags|=$.e_islandFlag}}r.Solve(e,this.m_gravity,this.m_allowSleep);for(var p=0;p<r.m_bodyCount;++p){t=r.m_bodies[p];if(t.GetType()==$.b2_staticBody){t.m_flags&=~$.e_islandFlag}}}for(p=0;p<u.length;++p){if(!u[p])break;u[p]=null}for(t=this.m_bodyList;t;t=t.m_next){if(t.IsAwake()==false||t.IsActive()==false){continue}if(t.GetType()==$.b2_staticBody){continue}t.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};ot.prototype.SolveTOI=function(e){var t;var n;var r;var i;var s;var o;var u;var a=this.m_island;a.Initialize(this.m_bodyCount,l.b2_maxTOIContactsPerIsland,l.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var f=ot.s_queue;for(t=this.m_bodyList;t;t=t.m_next){t.m_flags&=~$.e_islandFlag;t.m_sweep.t0=0}var c;for(c=this.m_contactList;c;c=c.m_next){c.m_flags&=~(at.e_toiFlag|at.e_islandFlag)}for(u=this.m_jointList;u;u=u.m_next){u.m_islandFlag=false}for(;;){var h=null;var p=1;for(c=this.m_contactList;c;c=c.m_next){if(c.IsSensor()==true||c.IsEnabled()==false||c.IsContinuous()==false){continue}var d=1;if(c.m_flags&at.e_toiFlag){d=c.m_toi}else{n=c.m_fixtureA;r=c.m_fixtureB;i=n.m_body;s=r.m_body;if((i.GetType()!=$.b2_dynamicBody||i.IsAwake()==false)&&(s.GetType()!=$.b2_dynamicBody||s.IsAwake()==false)){continue}var v=i.m_sweep.t0;if(i.m_sweep.t0<s.m_sweep.t0){v=s.m_sweep.t0;i.m_sweep.Advance(v)}else if(s.m_sweep.t0<i.m_sweep.t0){v=i.m_sweep.t0;s.m_sweep.Advance(v)}d=c.ComputeTOI(i.m_sweep,s.m_sweep);l.b2Assert(0<=d&&d<=1);if(d>0&&d<1){d=(1-d)*v+d;if(d>1)d=1}c.m_toi=d;c.m_flags|=at.e_toiFlag}if(Number.MIN_VALUE<d&&d<p){h=c;p=d}}if(h==null||1-100*Number.MIN_VALUE<p){break}n=h.m_fixtureA;r=h.m_fixtureB;i=n.m_body;s=r.m_body;ot.s_backupA.Set(i.m_sweep);ot.s_backupB.Set(s.m_sweep);i.Advance(p);s.Advance(p);h.Update(this.m_contactManager.m_contactListener);h.m_flags&=~at.e_toiFlag;if(h.IsSensor()==true||h.IsEnabled()==false){i.m_sweep.Set(ot.s_backupA);s.m_sweep.Set(ot.s_backupB);i.SynchronizeTransform();s.SynchronizeTransform();continue}if(h.IsTouching()==false){continue}var m=i;if(m.GetType()!=$.b2_dynamicBody){m=s}a.Clear();var g=0;var y=0;f[g+y++]=m;m.m_flags|=$.e_islandFlag;while(y>0){t=f[g++];--y;a.AddBody(t);if(t.IsAwake()==false){t.SetAwake(true)}if(t.GetType()!=$.b2_dynamicBody){continue}for(o=t.m_contactList;o;o=o.next){if(a.m_contactCount==a.m_contactCapacity){break}if(o.contact.m_flags&at.e_islandFlag){continue}if(o.contact.IsSensor()==true||o.contact.IsEnabled()==false||o.contact.IsTouching()==false){continue}a.AddContact(o.contact);o.contact.m_flags|=at.e_islandFlag;var b=o.other;if(b.m_flags&$.e_islandFlag){continue}if(b.GetType()!=$.b2_staticBody){b.Advance(p);b.SetAwake(true)}f[g+y]=b;++y;b.m_flags|=$.e_islandFlag}for(var w=t.m_jointList;w;w=w.next){if(a.m_jointCount==a.m_jointCapacity)continue;if(w.joint.m_islandFlag==true)continue;b=w.other;if(b.IsActive()==false){continue}a.AddJoint(w.joint);w.joint.m_islandFlag=true;if(b.m_flags&$.e_islandFlag)continue;if(b.GetType()!=$.b2_staticBody){b.Advance(p);b.SetAwake(true)}f[g+y]=b;++y;b.m_flags|=$.e_islandFlag}}var E=ot.s_timestep;E.warmStarting=false;E.dt=(1-p)*e.dt;E.inv_dt=1/E.dt;E.dtRatio=0;E.velocityIterations=e.velocityIterations;E.positionIterations=e.positionIterations;a.SolveTOI(E);var S=0;for(S=0;S<a.m_bodyCount;++S){t=a.m_bodies[S];t.m_flags&=~$.e_islandFlag;if(t.IsAwake()==false){continue}if(t.GetType()!=$.b2_dynamicBody){continue}t.SynchronizeFixtures();for(o=t.m_contactList;o;o=o.next){o.contact.m_flags&=~at.e_toiFlag}}for(S=0;S<a.m_contactCount;++S){c=a.m_contacts[S];c.m_flags&=~(at.e_toiFlag|at.e_islandFlag)}for(S=0;S<a.m_jointCount;++S){u=a.m_joints[S];u.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};ot.prototype.DrawJoint=function(e){var t=e.GetBodyA();var n=e.GetBodyB();var r=t.m_xf;var i=n.m_xf;var s=r.position;var o=i.position;var u=e.GetAnchorA();var a=e.GetAnchorB();var f=ot.s_jointColor;switch(e.m_type){case Ot.e_distanceJoint:this.m_debugDraw.DrawSegment(u,a,f);break;case Ot.e_pulleyJoint:{var l=e instanceof It?e:null;var c=l.GetGroundAnchorA();var h=l.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,u,f);this.m_debugDraw.DrawSegment(h,a,f);this.m_debugDraw.DrawSegment(c,h,f)}break;case Ot.e_mouseJoint:this.m_debugDraw.DrawSegment(u,a,f);break;default:if(t!=this.m_groundBody)this.m_debugDraw.DrawSegment(s,u,f);this.m_debugDraw.DrawSegment(u,a,f);if(n!=this.m_groundBody)this.m_debugDraw.DrawSegment(o,a,f)}};ot.prototype.DrawShape=function(e,t,n){switch(e.m_type){case V.e_circleShape:{var i=e instanceof R?e:null;var s=r.MulX(t,i.m_p);var o=i.m_radius;var u=t.R.col1;this.m_debugDraw.DrawSolidCircle(s,o,u,n)}break;case V.e_polygonShape:{var a=0;var f=e instanceof X?e:null;var l=parseInt(f.GetVertexCount());var c=f.GetVertices();var h=new Vector(l);for(a=0;a<l;++a){h[a]=r.MulX(t,c[a])}this.m_debugDraw.DrawPolygon(h,l,n)}break;case V.e_edgeShape:{var p=e instanceof z?e:null;this.m_debugDraw.DrawSegment(r.MulX(t,p.GetVertex1()),r.MulX(t,p.GetVertex2()),n)}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new st;Box2D.Dynamics.b2World.s_xf=new s;Box2D.Dynamics.b2World.s_backupA=new i;Box2D.Dynamics.b2World.s_backupB=new i;Box2D.Dynamics.b2World.s_timestep=new st;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new a(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,u=Box2D.Dynamics.Contacts.b2Contact,a=Box2D.Dynamics.Contacts.b2ContactConstraint,f=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,h=Box2D.Dynamics.Contacts.b2ContactRegister,p=Box2D.Dynamics.Contacts.b2ContactResult,d=Box2D.Dynamics.Contacts.b2ContactSolver,v=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,m=Box2D.Dynamics.Contacts.b2NullContact,g=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,y=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,b=Box2D.Dynamics.Contacts.b2PolygonContact,w=Box2D.Dynamics.Contacts.b2PositionSolverManifold,E=Box2D.Dynamics.b2Body,S=Box2D.Dynamics.b2BodyDef,x=Box2D.Dynamics.b2ContactFilter,T=Box2D.Dynamics.b2ContactImpulse,N=Box2D.Dynamics.b2ContactListener,C=Box2D.Dynamics.b2ContactManager,k=Box2D.Dynamics.b2DebugDraw,L=Box2D.Dynamics.b2DestructionListener,A=Box2D.Dynamics.b2FilterData,O=Box2D.Dynamics.b2Fixture,M=Box2D.Dynamics.b2FixtureDef,_=Box2D.Dynamics.b2Island,D=Box2D.Dynamics.b2TimeStep,P=Box2D.Dynamics.b2World,H=Box2D.Common.b2Color,B=Box2D.Common.b2internal,j=Box2D.Common.b2Settings,F=Box2D.Common.Math.b2Mat22,I=Box2D.Common.Math.b2Mat33,q=Box2D.Common.Math.b2Math,R=Box2D.Common.Math.b2Sweep,U=Box2D.Common.Math.b2Transform,z=Box2D.Common.Math.b2Vec2,W=Box2D.Common.Math.b2Vec3,X=Box2D.Collision.b2AABB,V=Box2D.Collision.b2Bound,$=Box2D.Collision.b2BoundValues,J=Box2D.Collision.b2Collision,K=Box2D.Collision.b2ContactID,Q=Box2D.Collision.b2ContactPoint,G=Box2D.Collision.b2Distance,Y=Box2D.Collision.b2DistanceInput,Z=Box2D.Collision.b2DistanceOutput,et=Box2D.Collision.b2DistanceProxy,tt=Box2D.Collision.b2DynamicTree,nt=Box2D.Collision.b2DynamicTreeBroadPhase,rt=Box2D.Collision.b2DynamicTreeNode,it=Box2D.Collision.b2DynamicTreePair,st=Box2D.Collision.b2Manifold,ot=Box2D.Collision.b2ManifoldPoint,ut=Box2D.Collision.b2Point,at=Box2D.Collision.b2RayCastInput,ft=Box2D.Collision.b2RayCastOutput,lt=Box2D.Collision.b2Segment,ct=Box2D.Collision.b2SeparationFunction,ht=Box2D.Collision.b2Simplex,pt=Box2D.Collision.b2SimplexCache,dt=Box2D.Collision.b2SimplexVertex,vt=Box2D.Collision.b2TimeOfImpact,mt=Box2D.Collision.b2TOIInput,gt=Box2D.Collision.b2WorldManifold,yt=Box2D.Collision.ClipVertex,bt=Box2D.Collision.Features,wt=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact);o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};o.Create=function(e){return new o};o.Destroy=function(e,t){};o.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)};o.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();J.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)};u.b2Contact=function(){this.m_nodeA=new l;this.m_nodeB=new l;this.m_manifold=new st;this.m_oldManifold=new st};u.prototype.GetManifold=function(){return this.m_manifold};u.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();var r=this.m_fixtureA.GetShape();var i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)};u.prototype.IsTouching=function(){return(this.m_flags&u.e_touchingFlag)==u.e_touchingFlag};u.prototype.IsContinuous=function(){return(this.m_flags&u.e_continuousFlag)==u.e_continuousFlag};u.prototype.SetSensor=function(e){if(e){this.m_flags|=u.e_sensorFlag}else{this.m_flags&=~u.e_sensorFlag}};u.prototype.IsSensor=function(){return(this.m_flags&u.e_sensorFlag)==u.e_sensorFlag};u.prototype.SetEnabled=function(e){if(e){this.m_flags|=u.e_enabledFlag}else{this.m_flags&=~u.e_enabledFlag}};u.prototype.IsEnabled=function(){return(this.m_flags&u.e_enabledFlag)==u.e_enabledFlag};u.prototype.GetNext=function(){return this.m_next};u.prototype.GetFixtureA=function(){return this.m_fixtureA};u.prototype.GetFixtureB=function(){return this.m_fixtureB};u.prototype.FlagForFiltering=function(){this.m_flags|=u.e_filterFlag};u.prototype.b2Contact=function(){};u.prototype.Reset=function(e,t){if(e===undefined)e=null;if(t===undefined)t=null;this.m_flags=u.e_enabledFlag;if(!e||!t){this.m_fixtureA=null;this.m_fixtureB=null;return}if(e.IsSensor()||t.IsSensor()){this.m_flags|=u.e_sensorFlag}var n=e.GetBody();var r=t.GetBody();if(n.GetType()!=E.b2_dynamicBody||n.IsBullet()||r.GetType()!=E.b2_dynamicBody||r.IsBullet()){this.m_flags|=u.e_continuousFlag}this.m_fixtureA=e;this.m_fixtureB=t;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};u.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=t;this.m_flags|=u.e_enabledFlag;var n=false;var r=(this.m_flags&u.e_touchingFlag)==u.e_touchingFlag;var i=this.m_fixtureA.m_body;var o=this.m_fixtureB.m_body;var a=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&u.e_sensorFlag){if(a){var f=this.m_fixtureA.GetShape();var l=this.m_fixtureB.GetShape();var c=i.GetTransform();var h=o.GetTransform();n=s.TestOverlap(f,c,l,h)}this.m_manifold.m_pointCount=0}else{if(i.GetType()!=E.b2_dynamicBody||i.IsBullet()||o.GetType()!=E.b2_dynamicBody||o.IsBullet()){this.m_flags|=u.e_continuousFlag}else{this.m_flags&=~u.e_continuousFlag}if(a){this.Evaluate();n=this.m_manifold.m_pointCount>0;for(var p=0;p<this.m_manifold.m_pointCount;++p){var d=this.m_manifold.m_points[p];d.m_normalImpulse=0;d.m_tangentImpulse=0;var v=d.m_id;for(var m=0;m<this.m_oldManifold.m_pointCount;++m){var g=this.m_oldManifold.m_points[m];if(g.m_id.key==v.key){d.m_normalImpulse=g.m_normalImpulse;d.m_tangentImpulse=g.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(n!=r){i.SetAwake(true);o.SetAwake(true)}}if(n){this.m_flags|=u.e_touchingFlag}else{this.m_flags&=~u.e_touchingFlag}if(r==false&&n==true){e.BeginContact(this)}if(r==true&&n==false){e.EndContact(this)}if((this.m_flags&u.e_sensorFlag)==0){e.PreSolve(this,this.m_oldManifold)}};u.prototype.Evaluate=function(){};u.prototype.ComputeTOI=function(e,t){u.s_input.proxyA.Set(this.m_fixtureA.GetShape());u.s_input.proxyB.Set(this.m_fixtureB.GetShape());u.s_input.sweepA=e;u.s_input.sweepB=t;u.s_input.tolerance=j.b2_linearSlop;return vt.TimeOfImpact(u.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new mt});a.b2ContactConstraint=function(){this.localPlaneNormal=new z;this.localPoint=new z;this.normal=new z;this.normalMass=new F;this.K=new F};a.prototype.b2ContactConstraint=function(){this.points=new Vector(j.b2_maxManifoldPoints);for(var e=0;e<j.b2_maxManifoldPoints;e++){this.points[e]=new f}};f.b2ContactConstraintPoint=function(){this.localPoint=new z;this.rA=new z;this.rB=new z};l.b2ContactEdge=function(){};c.b2ContactFactory=function(){};c.prototype.b2ContactFactory=function(e){this.m_allocator=e;this.InitializeRegisters()};c.prototype.AddType=function(e,t,n,r){if(n===undefined)n=0;if(r===undefined)r=0;this.m_registers[n][r].createFcn=e;this.m_registers[n][r].destroyFcn=t;this.m_registers[n][r].primary=true;if(n!=r){this.m_registers[r][n].createFcn=e;this.m_registers[r][n].destroyFcn=t;this.m_registers[r][n].primary=false}};c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(s.e_shapeTypeCount);for(var e=0;e<s.e_shapeTypeCount;e++){this.m_registers[e]=new Vector(s.e_shapeTypeCount);for(var t=0;t<s.e_shapeTypeCount;t++){this.m_registers[e][t]=new h}}this.AddType(o.Create,o.Destroy,s.e_circleShape,s.e_circleShape);this.AddType(g.Create,g.Destroy,s.e_polygonShape,s.e_circleShape);this.AddType(b.Create,b.Destroy,s.e_polygonShape,s.e_polygonShape);this.AddType(v.Create,v.Destroy,s.e_edgeShape,s.e_circleShape);this.AddType(y.Create,y.Destroy,s.e_polygonShape,s.e_edgeShape)};c.prototype.Create=function(e,t){var n=parseInt(e.GetType());var r=parseInt(t.GetType());var i=this.m_registers[n][r];var s;if(i.pool){s=i.pool;i.pool=s.m_next;i.poolCount--;s.Reset(e,t);return s}var o=i.createFcn;if(o!=null){if(i.primary){s=o(this.m_allocator);s.Reset(e,t);return s}else{s=o(this.m_allocator);s.Reset(t,e);return s}}else{return null}};c.prototype.Destroy=function(e){if(e.m_manifold.m_pointCount>0){e.m_fixtureA.m_body.SetAwake(true);e.m_fixtureB.m_body.SetAwake(true)}var t=parseInt(e.m_fixtureA.GetType());var n=parseInt(e.m_fixtureB.GetType());var r=this.m_registers[t][n];if(true){r.poolCount++;e.m_next=r.pool;r.pool=e}var i=r.destroyFcn;i(e,this.m_allocator)};h.b2ContactRegister=function(){};p.b2ContactResult=function(){this.position=new z;this.normal=new z;this.id=new K};d.b2ContactSolver=function(){this.m_step=new D;this.m_constraints=new Vector};d.prototype.b2ContactSolver=function(){};d.prototype.Initialize=function(e,t,n,r){if(n===undefined)n=0;var i;this.m_step.Set(e);this.m_allocator=r;var s=0;var o;var u;this.m_constraintCount=n;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new a}for(s=0;s<n;++s){i=t[s];var f=i.m_fixtureA;var l=i.m_fixtureB;var c=f.m_shape;var h=l.m_shape;var p=c.m_radius;var v=h.m_radius;var m=f.m_body;var g=l.m_body;var y=i.GetManifold();var b=j.b2MixFriction(f.GetFriction(),l.GetFriction());var w=j.b2MixRestitution(f.GetRestitution(),l.GetRestitution());var E=m.m_linearVelocity.x;var S=m.m_linearVelocity.y;var x=g.m_linearVelocity.x;var T=g.m_linearVelocity.y;var N=m.m_angularVelocity;var C=g.m_angularVelocity;j.b2Assert(y.m_pointCount>0);d.s_worldManifold.Initialize(y,m.m_xf,p,g.m_xf,v);var k=d.s_worldManifold.m_normal.x;var L=d.s_worldManifold.m_normal.y;var A=this.m_constraints[s];A.bodyA=m;A.bodyB=g;A.manifold=y;A.normal.x=k;A.normal.y=L;A.pointCount=y.m_pointCount;A.friction=b;A.restitution=w;A.localPlaneNormal.x=y.m_localPlaneNormal.x;A.localPlaneNormal.y=y.m_localPlaneNormal.y;A.localPoint.x=y.m_localPoint.x;A.localPoint.y=y.m_localPoint.y;A.radius=p+v;A.type=y.m_type;for(var O=0;O<A.pointCount;++O){var M=y.m_points[O];var _=A.points[O];_.normalImpulse=M.m_normalImpulse;_.tangentImpulse=M.m_tangentImpulse;_.localPoint.SetV(M.m_localPoint);var D=_.rA.x=d.s_worldManifold.m_points[O].x-m.m_sweep.c.x;var P=_.rA.y=d.s_worldManifold.m_points[O].y-m.m_sweep.c.y;var H=_.rB.x=d.s_worldManifold.m_points[O].x-g.m_sweep.c.x;var B=_.rB.y=d.s_worldManifold.m_points[O].y-g.m_sweep.c.y;var F=D*L-P*k;var I=H*L-B*k;F*=F;I*=I;var q=m.m_invMass+g.m_invMass+m.m_invI*F+g.m_invI*I;_.normalMass=1/q;var R=m.m_mass*m.m_invMass+g.m_mass*g.m_invMass;R+=m.m_mass*m.m_invI*F+g.m_mass*g.m_invI*I;_.equalizedMass=1/R;var U=L;var z=-k;var W=D*z-P*U;var X=H*z-B*U;W*=W;X*=X;var V=m.m_invMass+g.m_invMass+m.m_invI*W+g.m_invI*X;_.tangentMass=1/V;_.velocityBias=0;var $=x+ -C*B-E- -N*P;var J=T+C*H-S-N*D;var K=A.normal.x*$+A.normal.y*J;if(K<-j.b2_velocityThreshold){_.velocityBias+=-A.restitution*K}}if(A.pointCount==2){var Q=A.points[0];var G=A.points[1];var Y=m.m_invMass;var Z=m.m_invI;var et=g.m_invMass;var tt=g.m_invI;var nt=Q.rA.x*L-Q.rA.y*k;var rt=Q.rB.x*L-Q.rB.y*k;var it=G.rA.x*L-G.rA.y*k;var st=G.rB.x*L-G.rB.y*k;var ot=Y+et+Z*nt*nt+tt*rt*rt;var ut=Y+et+Z*it*it+tt*st*st;var at=Y+et+Z*nt*it+tt*rt*st;var ft=100;if(ot*ot<ft*(ot*ut-at*at)){A.K.col1.Set(ot,at);A.K.col2.Set(at,ut);A.K.GetInverse(A.normalMass)}else{A.pointCount=1}}}};d.prototype.InitVelocityConstraints=function(e){var t;var n;var r;for(var i=0;i<this.m_constraintCount;++i){var s=this.m_constraints[i];var o=s.bodyA;var u=s.bodyB;var a=o.m_invMass;var f=o.m_invI;var l=u.m_invMass;var c=u.m_invI;var h=s.normal.x;var p=s.normal.y;var d=p;var v=-h;var m=0;var g=0;var y=0;if(e.warmStarting){y=s.pointCount;for(g=0;g<y;++g){var b=s.points[g];b.normalImpulse*=e.dtRatio;b.tangentImpulse*=e.dtRatio;var w=b.normalImpulse*h+b.tangentImpulse*d;var E=b.normalImpulse*p+b.tangentImpulse*v;o.m_angularVelocity-=f*(b.rA.x*E-b.rA.y*w);o.m_linearVelocity.x-=a*w;o.m_linearVelocity.y-=a*E;u.m_angularVelocity+=c*(b.rB.x*E-b.rB.y*w);u.m_linearVelocity.x+=l*w;u.m_linearVelocity.y+=l*E}}else{y=s.pointCount;for(g=0;g<y;++g){var S=s.points[g];S.normalImpulse=0;S.tangentImpulse=0}}}};d.prototype.SolveVelocityConstraints=function(){var e=0;var t;var n=0;var r=0;var i=0;var s=0;var o=0;var u=0;var a=0;var f=0;var l=0;var c=0;var h=0;var p=0;var d=0;var v=0;var m=0;var g=0;var y=0;var b=0;var w=0;var E;var S;for(var x=0;x<this.m_constraintCount;++x){var T=this.m_constraints[x];var N=T.bodyA;var C=T.bodyB;var k=N.m_angularVelocity;var L=C.m_angularVelocity;var A=N.m_linearVelocity;var O=C.m_linearVelocity;var M=N.m_invMass;var _=N.m_invI;var D=C.m_invMass;var P=C.m_invI;var H=T.normal.x;var B=T.normal.y;var j=B;var F=-H;var I=T.friction;var R=0;for(e=0;e<T.pointCount;e++){t=T.points[e];o=O.x-L*t.rB.y-A.x+k*t.rA.y;u=O.y+L*t.rB.x-A.y-k*t.rA.x;f=o*j+u*F;l=t.tangentMass*-f;c=I*t.normalImpulse;h=q.Clamp(t.tangentImpulse+l,-c,c);l=h-t.tangentImpulse;p=l*j;d=l*F;A.x-=M*p;A.y-=M*d;k-=_*(t.rA.x*d-t.rA.y*p);O.x+=D*p;O.y+=D*d;L+=P*(t.rB.x*d-t.rB.y*p);t.tangentImpulse=h}var U=parseInt(T.pointCount);if(T.pointCount==1){t=T.points[0];o=O.x+ -L*t.rB.y-A.x- -k*t.rA.y;u=O.y+L*t.rB.x-A.y-k*t.rA.x;a=o*H+u*B;l=-t.normalMass*(a-t.velocityBias);h=t.normalImpulse+l;h=h>0?h:0;l=h-t.normalImpulse;p=l*H;d=l*B;A.x-=M*p;A.y-=M*d;k-=_*(t.rA.x*d-t.rA.y*p);O.x+=D*p;O.y+=D*d;L+=P*(t.rB.x*d-t.rB.y*p);t.normalImpulse=h}else{var z=T.points[0];var W=T.points[1];var X=z.normalImpulse;var V=W.normalImpulse;var $=O.x-L*z.rB.y-A.x+k*z.rA.y;var J=O.y+L*z.rB.x-A.y-k*z.rA.x;var K=O.x-L*W.rB.y-A.x+k*W.rA.y;var Q=O.y+L*W.rB.x-A.y-k*W.rA.x;var G=$*H+J*B;var Y=K*H+Q*B;var Z=G-z.velocityBias;var et=Y-W.velocityBias;E=T.K;Z-=E.col1.x*X+E.col2.x*V;et-=E.col1.y*X+E.col2.y*V;var tt=.001;for(;;){E=T.normalMass;var nt=-(E.col1.x*Z+E.col2.x*et);var rt=-(E.col1.y*Z+E.col2.y*et);if(nt>=0&&rt>=0){v=nt-X;m=rt-V;g=v*H;y=v*B;b=m*H;w=m*B;A.x-=M*(g+b);A.y-=M*(y+w);k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b);O.x+=D*(g+b);O.y+=D*(y+w);L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b);z.normalImpulse=nt;W.normalImpulse=rt;break}nt=-z.normalMass*Z;rt=0;G=0;Y=T.K.col1.y*nt+et;if(nt>=0&&Y>=0){v=nt-X;m=rt-V;g=v*H;y=v*B;b=m*H;w=m*B;A.x-=M*(g+b);A.y-=M*(y+w);k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b);O.x+=D*(g+b);O.y+=D*(y+w);L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b);z.normalImpulse=nt;W.normalImpulse=rt;break}nt=0;rt=-W.normalMass*et;G=T.K.col2.x*rt+Z;Y=0;if(rt>=0&&G>=0){v=nt-X;m=rt-V;g=v*H;y=v*B;b=m*H;w=m*B;A.x-=M*(g+b);A.y-=M*(y+w);k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b);O.x+=D*(g+b);O.y+=D*(y+w);L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b);z.normalImpulse=nt;W.normalImpulse=rt;break}nt=0;rt=0;G=Z;Y=et;if(G>=0&&Y>=0){v=nt-X;m=rt-V;g=v*H;y=v*B;b=m*H;w=m*B;A.x-=M*(g+b);A.y-=M*(y+w);k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b);O.x+=D*(g+b);O.y+=D*(y+w);L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b);z.normalImpulse=nt;W.normalImpulse=rt;break}break}}N.m_angularVelocity=k;C.m_angularVelocity=L}};d.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e){var t=this.m_constraints[e];var n=t.manifold;for(var r=0;r<t.pointCount;++r){var i=n.m_points[r];var s=t.points[r];i.m_normalImpulse=s.normalImpulse;i.m_tangentImpulse=s.tangentImpulse}}};d.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=0;for(var n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n];var i=r.bodyA;var s=r.bodyB;var o=i.m_mass*i.m_invMass;var u=i.m_mass*i.m_invI;var a=s.m_mass*s.m_invMass;var f=s.m_mass*s.m_invI;d.s_psm.Initialize(r);var l=d.s_psm.m_normal;for(var c=0;c<r.pointCount;c++){var h=r.points[c];var p=d.s_psm.m_points[c];var v=d.s_psm.m_separations[c];var m=p.x-i.m_sweep.c.x;var g=p.y-i.m_sweep.c.y;var y=p.x-s.m_sweep.c.x;var b=p.y-s.m_sweep.c.y;t=t<v?t:v;var w=q.Clamp(e*(v+j.b2_linearSlop),-j.b2_maxLinearCorrection,0);var E=-h.equalizedMass*w;var S=E*l.x;var x=E*l.y;i.m_sweep.c.x-=o*S;i.m_sweep.c.y-=o*x;i.m_sweep.a-=u*(m*x-g*S);i.SynchronizeTransform();s.m_sweep.c.x+=a*S;s.m_sweep.c.y+=a*x;s.m_sweep.a+=f*(y*x-b*S);s.SynchronizeTransform()}}return t>-1.5*j.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new gt;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new w});Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(e){return new v};v.Destroy=function(e,t){};v.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t);j.b2Assert(e.GetType()==s.e_edgeShape);j.b2Assert(t.GetType()==s.e_circleShape)};v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)};v.prototype.b2CollideEdgeAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s;var o=0;var u=0;var a=0;var f=0;var l;var c;c=i.R;l=r.m_p;var h=i.position.x+(c.col1.x*l.x+c.col2.x*l.y);var p=i.position.y+(c.col1.y*l.x+c.col2.y*l.y);o=h-n.position.x;u=p-n.position.y;c=n.R;var d=o*c.col1.x+u*c.col1.y;var v=o*c.col2.x+u*c.col2.y;var m=0;var g=t.m_radius+r.m_radius;l=t.m_normal;var y=l.x*o+l.y*u;var b=t.m_v1;var w=t.m_v2;if(y<Number.MIN_VALUE){console.log(1);e.m_pointCount=1;e.m_type=st.e_faceA;e.m_localPlaneNormal.SetV(t.m_normal);e.m_localPoint.x=.5*(b.x+w.x);e.m_localPoint.y=.5*(b.y+w.y);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0;return}var E=(d-b.x)*(w.x-b.x)+(v-b.y)*(w.y-b.y);var S=(d-w.x)*(b.x-w.x)+(v-w.y)*(b.y-w.y);if(E<=0){console.log(2);if((d-b.x)*(d-b.x)+(v-b.y)*(v-b.y)>g*g)return;e.m_pointCount=1;e.m_type=st.e_faceA;e.m_localPlaneNormal.x=d-b.x;e.m_localPlaneNormal.y=v-b.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(b);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}else if(S<=0){console.log(3);if((d-w.x)*(d-w.x)+(v-w.y)*(v-w.y)>g*g)return;e.m_pointCount=1;e.m_type=st.e_faceA;e.m_localPlaneNormal.x=d-w.x;e.m_localPlaneNormal.y=v-w.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(w);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}else{var x=.5*(b.x+w.x);var T=.5*(b.y+w.y);y=(d-x)*l.x+(v-T)*l.y;if(y>g)return;e.m_pointCount=1;e.m_type=st.e_faceA;e.m_localPlaneNormal.x=l.x;e.m_localPlaneNormal.y=l.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.Set(x,T);e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}};Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact);m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;m.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};m.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};m.prototype.Evaluate=function(){};Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact);g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;g.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.Create=function(e){return new g};g.Destroy=function(e,t){};g.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t);j.b2Assert(e.GetType()==s.e_polygonShape);j.b2Assert(t.GetType()==s.e_circleShape)};g.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body;var n=this.m_fixtureB.m_body;J.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.Create=function(e){return new y};y.Destroy=function(e,t){};y.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t);j.b2Assert(e.GetType()==s.e_polygonShape);j.b2Assert(t.GetType()==s.e_edgeShape)};y.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,t.m_xf)};y.prototype.b2CollidePolyAndEdge=function(e,t,n,r,i){};Box2D.inherit(b,Box2D.Dynamics.Contacts.b2Contact);b.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;b.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};b.Create=function(e){return new b};b.Destroy=function(e,t){};b.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)};b.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var t=this.m_fixtureB.GetBody();J.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)};w.b2PositionSolverManifold=function(){};w.prototype.b2PositionSolverManifold=function(){this.m_normal=new z;this.m_separations=new Vector_a2j_Number(j.b2_maxManifoldPoints);this.m_points=new Vector(j.b2_maxManifoldPoints);for(var e=0;e<j.b2_maxManifoldPoints;e++){this.m_points[e]=new z}};w.prototype.Initialize=function(e){j.b2Assert(e.pointCount>0);var t=0;var n=0;var r=0;var i;var s;var o=0;var u=0;switch(e.type){case st.e_circles:{i=e.bodyA.m_xf.R;s=e.localPoint;var a=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);var f=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);i=e.bodyB.m_xf.R;s=e.points[0].localPoint;var l=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);var c=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);var h=l-a;var p=c-f;var d=h*h+p*p;if(d>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(d);this.m_normal.x=h/v;this.m_normal.y=p/v}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(a+l);this.m_points[0].y=.5*(f+c);this.m_separations[0]=h*this.m_normal.x+p*this.m_normal.y-e.radius}break;case st.e_faceA:{i=e.bodyA.m_xf.R;s=e.localPlaneNormal;this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y;this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y;i=e.bodyA.m_xf.R;s=e.localPoint;o=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);u=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t){s=e.points[t].localPoint;n=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);r=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius;this.m_points[t].x=n;this.m_points[t].y=r}}break;case st.e_faceB:{i=e.bodyB.m_xf.R;s=e.localPlaneNormal;this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y;this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y;i=e.bodyB.m_xf.R;s=e.localPoint;o=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);u=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t){s=e.points[t].localPoint;n=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y);r=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius;this.m_points[t].Set(n,r)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new z;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new z})})();(function(){var e=Box2D.Dynamics.b2Body,t=Box2D.Dynamics.b2BodyDef,n=Box2D.Dynamics.b2ContactFilter,r=Box2D.Dynamics.b2ContactImpulse,i=Box2D.Dynamics.b2ContactListener,s=Box2D.Dynamics.b2ContactManager,o=Box2D.Dynamics.b2DebugDraw,u=Box2D.Dynamics.b2DestructionListener,a=Box2D.Dynamics.b2FilterData,f=Box2D.Dynamics.b2Fixture,l=Box2D.Dynamics.b2FixtureDef,c=Box2D.Dynamics.b2Island,h=Box2D.Dynamics.b2TimeStep,p=Box2D.Dynamics.b2World,d=Box2D.Common.Math.b2Mat22,v=Box2D.Common.Math.b2Mat33,m=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,y=Box2D.Common.Math.b2Transform,b=Box2D.Common.Math.b2Vec2,w=Box2D.Common.Math.b2Vec3,E=Box2D.Common.b2Color,S=Box2D.Common.b2internal,x=Box2D.Common.b2Settings,T=Box2D.Collision.Shapes.b2CircleShape,N=Box2D.Collision.Shapes.b2EdgeChainDef,C=Box2D.Collision.Shapes.b2EdgeShape,k=Box2D.Collision.Shapes.b2MassData,L=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,O=Box2D.Dynamics.Controllers.b2BuoyancyController,M=Box2D.Dynamics.Controllers.b2ConstantAccelController,_=Box2D.Dynamics.Controllers.b2ConstantForceController,D=Box2D.Dynamics.Controllers.b2Controller,P=Box2D.Dynamics.Controllers.b2ControllerEdge,H=Box2D.Dynamics.Controllers.b2GravityController,B=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(O,Box2D.Dynamics.Controllers.b2Controller);O.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;O.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new b(0,-1);this.offset=0;this.density=0;this.velocity=new b(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};O.prototype.Step=function(e){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(n.IsAwake()==false){continue}var r=new b;var i=new b;var s=0;var o=0;for(var u=n.GetFixtureList();u;u=u.GetNext()){var a=new b;var f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,n.GetTransform(),a);s+=f;r.x+=f*a.x;r.y+=f*a.y;var l=0;if(this.useDensity){l=1}else{l=1}o+=f*l;i.x+=f*a.x*l;i.y+=f*a.y*l}r.x/=s;r.y/=s;i.x/=o;i.y/=o;if(s<Number.MIN_VALUE)continue;var c=this.gravity.GetNegative();c.Multiply(this.density*s);n.ApplyForce(c,i);var h=n.GetLinearVelocityFromWorldPoint(r);h.Subtract(this.velocity);h.Multiply(-this.linearDrag*s);n.ApplyForce(h,r);n.ApplyTorque(-n.GetInertia()/n.GetMass()*s*n.GetAngularVelocity()*this.angularDrag)}};O.prototype.Draw=function(e){var t=1e3;var n=new b;var r=new b;n.x=this.normal.x*this.offset+this.normal.y*t;n.y=this.normal.y*this.offset-this.normal.x*t;r.x=this.normal.x*this.offset-this.normal.y*t;r.y=this.normal.y*this.offset+this.normal.x*t;var i=new E(0,0,1);e.DrawSegment(n,r,i)};Box2D.inherit(M,Box2D.Dynamics.Controllers.b2Controller);M.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;M.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new b(0,0)};M.prototype.Step=function(e){var t=new b(this.A.x*e.dt,this.A.y*e.dt);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake())continue;r.SetLinearVelocity(new b(r.GetLinearVelocity().x+t.x,r.GetLinearVelocity().y+t.y))}};Box2D.inherit(_,Box2D.Dynamics.Controllers.b2Controller);_.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;_.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new b(0,0)};_.prototype.Step=function(e){for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(!n.IsAwake())continue;n.ApplyForce(this.F,n.GetWorldCenter())}};D.b2Controller=function(){};D.prototype.Step=function(e){};D.prototype.Draw=function(e){};D.prototype.AddBody=function(e){var t=new P;t.controller=this;t.body=e;t.nextBody=this.m_bodyList;t.prevBody=null;this.m_bodyList=t;if(t.nextBody)t.nextBody.prevBody=t;this.m_bodyCount++;t.nextController=e.m_controllerList;t.prevController=null;e.m_controllerList=t;if(t.nextController)t.nextController.prevController=t;e.m_controllerCount++};D.prototype.RemoveBody=function(e){var t=e.m_controllerList;while(t&&t.controller!=this)t=t.nextController;if(t.prevBody)t.prevBody.nextBody=t.nextBody;if(t.nextBody)t.nextBody.prevBody=t.prevBody;if(t.nextController)t.nextController.prevController=t.prevController;if(t.prevController)t.prevController.nextController=t.nextController;if(this.m_bodyList==t)this.m_bodyList=t.nextBody;if(e.m_controllerList==t)e.m_controllerList=t.nextController;e.m_controllerCount--;this.m_bodyCount--};D.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};D.prototype.GetNext=function(){return this.m_next};D.prototype.GetWorld=function(){return this.m_world};D.prototype.GetBodyList=function(){return this.m_bodyList};P.b2ControllerEdge=function(){};Box2D.inherit(H,Box2D.Dynamics.Controllers.b2Controller);H.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;H.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};H.prototype.Step=function(e){var t=null;var n=null;var r=null;var i=0;var s=null;var o=null;var u=null;var a=0;var f=0;var l=0;var c=null;if(this.invSqr){for(t=this.m_bodyList;t;t=t.nextBody){n=t.body;r=n.GetWorldCenter();i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body;u=o.GetWorldCenter();a=u.x-r.x;f=u.y-r.y;l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new b(a,f);c.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass());if(n.IsAwake())n.ApplyForce(c,r);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,u)}}}else{for(t=this.m_bodyList;t;t=t.nextBody){n=t.body;r=n.GetWorldCenter();i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body;u=o.GetWorldCenter();a=u.x-r.x;f=u.y-r.y;l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new b(a,f);c.Multiply(this.G/l*i*o.GetMass());if(n.IsAwake())n.ApplyForce(c,r);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,u)}}}};Box2D.inherit(B,Box2D.Dynamics.Controllers.b2Controller);B.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;B.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new d;this.maxTimestep=0};B.prototype.SetAxisAligned=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.T.col1.x=-e;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-t;if(e>0||t>0){this.maxTimestep=1/Math.max(e,t)}else{this.maxTimestep=0}};B.prototype.Step=function(e){var t=e.dt;if(t<=Number.MIN_VALUE)return;if(t>this.maxTimestep&&this.maxTimestep>0)t=this.maxTimestep;for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake()){continue}var i=r.GetWorldVector(m.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity())));r.SetLinearVelocity(new b(r.GetLinearVelocity().x+i.x*t,r.GetLinearVelocity().y+i.y*t))}}})();(function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,f=Box2D.Common.Math.b2Vec3,l=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,h=Box2D.Dynamics.Joints.b2FrictionJoint,p=Box2D.Dynamics.Joints.b2FrictionJointDef,d=Box2D.Dynamics.Joints.b2GearJoint,v=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,g=Box2D.Dynamics.Joints.b2Joint,y=Box2D.Dynamics.Joints.b2JointDef,b=Box2D.Dynamics.Joints.b2JointEdge,w=Box2D.Dynamics.Joints.b2LineJoint,E=Box2D.Dynamics.Joints.b2LineJointDef,S=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,T=Box2D.Dynamics.Joints.b2PrismaticJoint,N=Box2D.Dynamics.Joints.b2PrismaticJointDef,C=Box2D.Dynamics.Joints.b2PulleyJoint,k=Box2D.Dynamics.Joints.b2PulleyJointDef,L=Box2D.Dynamics.Joints.b2RevoluteJoint,A=Box2D.Dynamics.Joints.b2RevoluteJointDef,O=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,_=Box2D.Dynamics.b2Body,D=Box2D.Dynamics.b2BodyDef,P=Box2D.Dynamics.b2ContactFilter,H=Box2D.Dynamics.b2ContactImpulse,B=Box2D.Dynamics.b2ContactListener,j=Box2D.Dynamics.b2ContactManager,F=Box2D.Dynamics.b2DebugDraw,I=Box2D.Dynamics.b2DestructionListener,q=Box2D.Dynamics.b2FilterData,R=Box2D.Dynamics.b2Fixture,U=Box2D.Dynamics.b2FixtureDef,z=Box2D.Dynamics.b2Island,W=Box2D.Dynamics.b2TimeStep,X=Box2D.Dynamics.b2World;Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint);l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;l.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_u=new a};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};l.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)};l.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return 0};l.prototype.GetLength=function(){return this.m_length};l.prototype.SetLength=function(e){if(e===undefined)e=0;this.m_length=e};l.prototype.GetFrequency=function(){return this.m_frequencyHz};l.prototype.SetFrequency=function(e){if(e===undefined)e=0;this.m_frequencyHz=e};l.prototype.GetDampingRatio=function(){return this.m_dampingRatio};l.prototype.SetDampingRatio=function(e){if(e===undefined)e=0;this.m_dampingRatio=e};l.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e);var t;var n=0;var r=0;this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_length=e.length;this.m_frequencyHz=e.frequencyHz;this.m_dampingRatio=e.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};l.prototype.InitVelocityConstraints=function(e){var t;var r=0;var i=this.m_bodyA;var s=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=t.col1.x*o+t.col2.x*u;u=t.col1.y*o+t.col2.y*u;o=r;t=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*f;f=t.col1.y*a+t.col2.y*f;a=r;this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o;this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u;var l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(l>n.b2_linearSlop){this.m_u.Multiply(1/l)}else{this.m_u.SetZero()}var c=o*this.m_u.y-u*this.m_u.x;var h=a*this.m_u.y-f*this.m_u.x;var p=i.m_invMass+i.m_invI*c*c+s.m_invMass+s.m_invI*h*h;this.m_mass=p!=0?1/p:0;if(this.m_frequencyHz>0){var d=l-this.m_length;var v=2*Math.PI*this.m_frequencyHz;var m=2*this.m_mass*this.m_dampingRatio*v;var g=this.m_mass*v*v;this.m_gamma=e.dt*(m+e.dt*g);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=d*e.dt*g*this.m_gamma;this.m_mass=p+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var y=this.m_impulse*this.m_u.x;var b=this.m_impulse*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*y;i.m_linearVelocity.y-=i.m_invMass*b;i.m_angularVelocity-=i.m_invI*(o*b-u*y);s.m_linearVelocity.x+=s.m_invMass*y;s.m_linearVelocity.y+=s.m_invMass*b;s.m_angularVelocity+=s.m_invI*(a*b-f*y)}else{this.m_impulse=0}};l.prototype.SolveVelocityConstraints=function(e){var t;var n=this.m_bodyA;var r=this.m_bodyB;t=n.m_xf.R;var i=this.m_localAnchor1.x-n.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-n.m_sweep.localCenter.y;var o=t.col1.x*i+t.col2.x*s;s=t.col1.y*i+t.col2.y*s;i=o;t=r.m_xf.R;var u=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var a=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=t.col1.x*u+t.col2.x*a;a=t.col1.y*u+t.col2.y*a;u=o;var f=n.m_linearVelocity.x+ -n.m_angularVelocity*s;var l=n.m_linearVelocity.y+n.m_angularVelocity*i;var c=r.m_linearVelocity.x+ -r.m_angularVelocity*a;var h=r.m_linearVelocity.y+r.m_angularVelocity*u;var p=this.m_u.x*(c-f)+this.m_u.y*(h-l);var d=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=d;var v=d*this.m_u.x;var m=d*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*v;n.m_linearVelocity.y-=n.m_invMass*m;n.m_angularVelocity-=n.m_invI*(i*m-s*v);r.m_linearVelocity.x+=r.m_invMass*v;r.m_linearVelocity.y+=r.m_invMass*m;r.m_angularVelocity+=r.m_invI*(u*m-a*v)};l.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t;if(this.m_frequencyHz>0){return true}var r=this.m_bodyA;var i=this.m_bodyB;t=r.m_xf.R;var o=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var u=this.m_localAnchor1.y-r.m_sweep.localCenter.y;var a=t.col1.x*o+t.col2.x*u;u=t.col1.y*o+t.col2.y*u;o=a;t=i.m_xf.R;var f=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;a=t.col1.x*f+t.col2.x*l;l=t.col1.y*f+t.col2.y*l;f=a;var c=i.m_sweep.c.x+f-r.m_sweep.c.x-o;var h=i.m_sweep.c.y+l-r.m_sweep.c.y-u;var p=Math.sqrt(c*c+h*h);c/=p;h/=p;var d=p-this.m_length;d=s.Clamp(d,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection);var v=-this.m_mass*d;this.m_u.Set(c,h);var m=v*this.m_u.x;var g=v*this.m_u.y;r.m_sweep.c.x-=r.m_invMass*m;r.m_sweep.c.y-=r.m_invMass*g;r.m_sweep.a-=r.m_invI*(o*g-u*m);i.m_sweep.c.x+=i.m_invMass*m;i.m_sweep.c.y+=i.m_invMass*g;i.m_sweep.a+=i.m_invI*(f*g-l*m);r.SynchronizeTransform();i.SynchronizeTransform();return s.Abs(d)<n.b2_linearSlop};Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef);c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a};c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};c.prototype.Initialize=function(e,t,n,r){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var i=r.x-n.x;var s=r.y-n.y;this.length=Math.sqrt(i*i+s*s);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new a;this.m_localAnchorB=new a;this.m_linearMass=new r;this.m_linearImpulse=new a};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};h.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)};h.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_angularImpulse};h.prototype.SetMaxForce=function(e){if(e===undefined)e=0;this.m_maxForce=e};h.prototype.GetMaxForce=function(){return this.m_maxForce};h.prototype.SetMaxTorque=function(e){if(e===undefined)e=0;this.m_maxTorque=e};h.prototype.GetMaxTorque=function(){return this.m_maxTorque};h.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchorA.SetV(e.localAnchorA);this.m_localAnchorB.SetV(e.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=e.maxForce;this.m_maxTorque=e.maxTorque};h.prototype.InitVelocityConstraints=function(e){var t;var n=0;var i=this.m_bodyA;var s=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchorA.x-i.m_sweep.localCenter.x;var u=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=t.col1.x*o+t.col2.x*u;u=t.col1.y*o+t.col2.y*u;o=n;t=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x;var f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=t.col1.x*a+t.col2.x*f;f=t.col1.y*a+t.col2.y*f;a=n;var l=i.m_invMass;var c=s.m_invMass;var h=i.m_invI;var p=s.m_invI;var d=new r;d.col1.x=l+c;d.col2.x=0;d.col1.y=0;d.col2.y=l+c;d.col1.x+=h*u*u;d.col2.x+=-h*o*u;d.col1.y+=-h*o*u;d.col2.y+=h*o*o;d.col1.x+=p*f*f;d.col2.x+=-p*a*f;d.col1.y+=-p*a*f;d.col2.y+=p*a*a;d.GetInverse(this.m_linearMass);this.m_angularMass=h+p;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(e.warmStarting){this.m_linearImpulse.x*=e.dtRatio;this.m_linearImpulse.y*=e.dtRatio;this.m_angularImpulse*=e.dtRatio;var v=this.m_linearImpulse;i.m_linearVelocity.x-=l*v.x;i.m_linearVelocity.y-=l*v.y;i.m_angularVelocity-=h*(o*v.y-u*v.x+this.m_angularImpulse);s.m_linearVelocity.x+=c*v.x;s.m_linearVelocity.y+=c*v.y;s.m_angularVelocity+=p*(a*v.y-f*v.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};h.prototype.SolveVelocityConstraints=function(e){var t;var n=0;var r=this.m_bodyA;var i=this.m_bodyB;var o=r.m_linearVelocity;var u=r.m_angularVelocity;var f=i.m_linearVelocity;var l=i.m_angularVelocity;var c=r.m_invMass;var h=i.m_invMass;var p=r.m_invI;var d=i.m_invI;t=r.m_xf.R;var v=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var m=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m;m=t.col1.y*v+t.col2.y*m;v=n;t=i.m_xf.R;var g=this.m_localAnchorB.x-i.m_sweep.localCenter.x;var y=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y;y=t.col1.y*g+t.col2.y*y;g=n;var b=0;{var w=l-u;var E=-this.m_angularMass*w;var S=this.m_angularImpulse;b=e.dt*this.m_maxTorque;this.m_angularImpulse=s.Clamp(this.m_angularImpulse+E,-b,b);E=this.m_angularImpulse-S;u-=p*E;l+=d*E}{var x=f.x-l*y-o.x+u*m;var T=f.y+l*g-o.y-u*v;var N=s.MulMV(this.m_linearMass,new a(-x,-T));var C=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(N);b=e.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>b*b){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(b)}N=s.SubtractVV(this.m_linearImpulse,C);o.x-=c*N.x;o.y-=c*N.y;u-=p*(v*N.y-m*N.x);f.x+=h*N.x;f.y+=h*N.y;l+=d*(g*N.y-y*N.x)}r.m_angularVelocity=u;i.m_angularVelocity=l};h.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;return true};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a};p.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_frictionJoint;this.maxForce=0;this.maxTorque=0};p.prototype.Initialize=function(e,t,n){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new a;this.m_groundAnchor2=new a;this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_J=new m};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};d.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)};d.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;var t=this.m_bodyB.m_xf.R;var n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var i=t.col1.x*n+t.col2.x*r;r=t.col1.y*n+t.col2.y*r;n=i;var s=this.m_impulse*this.m_J.linearB.x;var o=this.m_impulse*this.m_J.linearB.y;return e*(this.m_impulse*this.m_J.angularB-n*o+r*s)};d.prototype.GetRatio=function(){return this.m_ratio};d.prototype.SetRatio=function(e){if(e===undefined)e=0;this.m_ratio=e};d.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type);var n=parseInt(e.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var r=0;var i=0;this.m_ground1=e.joint1.GetBodyA();this.m_bodyA=e.joint1.GetBodyB();if(t==g.e_revoluteJoint){this.m_revolute1=e.joint1 instanceof L?e.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);r=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=e.joint1 instanceof T?e.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);r=this.m_prismatic1.GetJointTranslation()}this.m_ground2=e.joint2.GetBodyA();this.m_bodyB=e.joint2.GetBodyB();if(n==g.e_revoluteJoint){this.m_revolute2=e.joint2 instanceof L?e.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);i=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=e.joint2 instanceof T?e.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);i=this.m_prismatic2.GetJointTranslation()}this.m_ratio=e.ratio;this.m_constant=r+this.m_ratio*i;this.m_impulse=0};d.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1;var n=this.m_ground2;var r=this.m_bodyA;var i=this.m_bodyB;var s=0;var o=0;var u=0;var a=0;var f;var l;var c=0;var h=0;var p=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;p+=r.m_invI}else{f=t.m_xf.R;l=this.m_prismatic1.m_localXAxis1;s=f.col1.x*l.x+f.col2.x*l.y;o=f.col1.y*l.x+f.col2.y*l.y;f=r.m_xf.R;u=this.m_localAnchor1.x-r.m_sweep.localCenter.x;a=this.m_localAnchor1.y-r.m_sweep.localCenter.y;h=f.col1.x*u+f.col2.x*a;a=f.col1.y*u+f.col2.y*a;u=h;c=u*o-a*s;this.m_J.linearA.Set(-s,-o);this.m_J.angularA=-c;p+=r.m_invMass+r.m_invI*c*c}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;p+=this.m_ratio*this.m_ratio*i.m_invI}else{f=n.m_xf.R;l=this.m_prismatic2.m_localXAxis1;s=f.col1.x*l.x+f.col2.x*l.y;o=f.col1.y*l.x+f.col2.y*l.y;f=i.m_xf.R;u=this.m_localAnchor2.x-i.m_sweep.localCenter.x;a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;h=f.col1.x*u+f.col2.x*a;a=f.col1.y*u+f.col2.y*a;u=h;c=u*o-a*s;this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o);this.m_J.angularB=-this.m_ratio*c;p+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*c*c)}this.m_mass=p>0?1/p:0;if(e.warmStarting){r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};d.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA;var n=this.m_bodyB;var r=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity);var i=-this.m_mass*r;this.m_impulse+=i;t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearA.x;t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearA.y;t.m_angularVelocity+=t.m_invI*i*this.m_J.angularA;n.m_linearVelocity.x+=n.m_invMass*i*this.m_J.linearB.x;n.m_linearVelocity.y+=n.m_invMass*i*this.m_J.linearB.y;n.m_angularVelocity+=n.m_invI*i*this.m_J.angularB};d.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=0;var r=this.m_bodyA;var i=this.m_bodyB;var s=0;var o=0;if(this.m_revolute1){s=this.m_revolute1.GetJointAngle()}else{s=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){o=this.m_revolute2.GetJointAngle()}else{o=this.m_prismatic2.GetJointTranslation()}var u=this.m_constant-(s+this.m_ratio*o);var a=-this.m_mass*u;r.m_sweep.c.x+=r.m_invMass*a*this.m_J.linearA.x;r.m_sweep.c.y+=r.m_invMass*a*this.m_J.linearA.y;r.m_sweep.a+=r.m_invI*a*this.m_J.angularA;i.m_sweep.c.x+=i.m_invMass*a*this.m_J.linearB.x;i.m_sweep.c.y+=i.m_invMass*a*this.m_J.linearB.y;i.m_sweep.a+=i.m_invI*a*this.m_J.angularB;r.SynchronizeTransform();i.SynchronizeTransform();return t<n.b2_linearSlop};Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef);v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;v.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};v.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};m.b2Jacobian=function(){this.linearA=new a;this.linearB=new a};m.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};m.prototype.Set=function(e,t,n,r){if(t===undefined)t=0;if(r===undefined)r=0;this.linearA.SetV(e);this.angularA=t;this.linearB.SetV(n);this.angularB=r};m.prototype.Compute=function(e,t,n,r){if(t===undefined)t=0;if(r===undefined)r=0;return this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r};g.b2Joint=function(){this.m_edgeA=new b;this.m_edgeB=new b;this.m_localCenterA=new a;this.m_localCenterB=new a};g.prototype.GetType=function(){return this.m_type};g.prototype.GetAnchorA=function(){return null};g.prototype.GetAnchorB=function(){return null};g.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return null};g.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return 0};g.prototype.GetBodyA=function(){return this.m_bodyA};g.prototype.GetBodyB=function(){return this.m_bodyB};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetUserData=function(){return this.m_userData};g.prototype.SetUserData=function(e){this.m_userData=e};g.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};g.Create=function(e,t){var n=null;switch(e.type){case g.e_distanceJoint:{n=new l(e instanceof c?e:null)}break;case g.e_mouseJoint:{n=new S(e instanceof x?e:null)}break;case g.e_prismaticJoint:{n=new T(e instanceof N?e:null)}break;case g.e_revoluteJoint:{n=new L(e instanceof A?e:null)}break;case g.e_pulleyJoint:{n=new C(e instanceof k?e:null)}break;case g.e_gearJoint:{n=new d(e instanceof v?e:null)}break;case g.e_lineJoint:{n=new w(e instanceof E?e:null)}break;case g.e_weldJoint:{n=new O(e instanceof M?e:null)}break;case g.e_frictionJoint:{n=new h(e instanceof p?e:null)}break;default:break}return n};g.Destroy=function(e,t){};g.prototype.b2Joint=function(e){n.b2Assert(e.bodyA!=e.bodyB);this.m_type=e.type;this.m_prev=null;this.m_next=null;this.m_bodyA=e.bodyA;this.m_bodyB=e.bodyB;this.m_collideConnected=e.collideConnected;this.m_islandFlag=false;this.m_userData=e.userData};g.prototype.InitVelocityConstraints=function(e){};g.prototype.SolveVelocityConstraints=function(e){};g.prototype.FinalizeVelocityConstraints=function(){};g.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});y.b2JointDef=function(){};y.prototype.b2JointDef=function(){this.type=g.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};b.b2JointEdge=function(){};Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint);w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;w.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_localXAxis1=new a;this.m_localYAxis1=new a;this.m_axis=new a;this.m_perp=new a;this.m_K=new r;this.m_impulse=new a};w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};w.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};w.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.y};w.prototype.GetJointTranslation=function(){var e=this.m_bodyA;var t=this.m_bodyB;var n;var r=e.GetWorldPoint(this.m_localAnchor1);var i=t.GetWorldPoint(this.m_localAnchor2);var s=i.x-r.x;var o=i.y-r.y;var u=e.GetWorldVector(this.m_localXAxis1);var a=u.x*s+u.y*o;return a};w.prototype.GetJointSpeed=function(){var e=this.m_bodyA;var t=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var i=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i;r=s;n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u;u=n.col1.y*o+n.col2.y*u;o=s;var a=e.m_sweep.c.x+r;var f=e.m_sweep.c.y+i;var l=t.m_sweep.c.x+o;var c=t.m_sweep.c.y+u;var h=l-a;var p=c-f;var d=e.GetWorldVector(this.m_localXAxis1);var v=e.m_linearVelocity;var m=t.m_linearVelocity;var g=e.m_angularVelocity;var y=t.m_angularVelocity;var b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b};w.prototype.IsLimitEnabled=function(){return this.m_enableLimit};w.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=e};w.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};w.prototype.GetUpperLimit=function(){return this.m_upperTranslation};w.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=e;this.m_upperTranslation=t};w.prototype.IsMotorEnabled=function(){return this.m_enableMotor};w.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=e};w.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};w.prototype.SetMaxMotorForce=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=e};w.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};w.prototype.GetMotorForce=function(){return this.m_motorImpulse};w.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e);var t;var n=0;var r=0;this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_localXAxis1.SetV(e.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=e.lowerTranslation;this.m_upperTranslation=e.upperTranslation;this.m_maxMotorForce=e.maxMotorForce;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};w.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA;var r=this.m_bodyB;var i;var o=0;this.m_localCenterA.SetV(t.GetLocalCenter());this.m_localCenterB.SetV(r.GetLocalCenter());var u=t.GetTransform();var a=r.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x;var l=this.m_localAnchor1.y-this.m_localCenterA.y;o=i.col1.x*f+i.col2.x*l;l=i.col1.y*f+i.col2.y*l;f=o;i=r.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var h=this.m_localAnchor2.y-this.m_localCenterB.y;o=i.col1.x*c+i.col2.x*h;h=i.col1.y*c+i.col2.y*h;c=o;var p=r.m_sweep.c.x+c-t.m_sweep.c.x-f;var d=r.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass;this.m_invMassB=r.m_invMass;this.m_invIA=t.m_invI;this.m_invIB=r.m_invI;{this.m_axis.SetV(s.MulMV(u.R,this.m_localXAxis1));this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x;this.m_a2=c*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(s.MulMV(u.R,this.m_localYAxis1));this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x;this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA;var m=this.m_invMassB;var y=this.m_invIA;var b=this.m_invIB;this.m_K.col1.x=v+m+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2;this.m_K.col1.y=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+m+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2}if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(w<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.y=0}}else if(w>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var x=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var T=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E;t.m_linearVelocity.y-=this.m_invMassA*S;t.m_angularVelocity-=this.m_invIA*x;r.m_linearVelocity.x+=this.m_invMassB*E;r.m_linearVelocity.y+=this.m_invMassB*S;r.m_angularVelocity+=this.m_invIB*T}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};w.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA;var n=this.m_bodyB;var r=t.m_linearVelocity;var i=t.m_angularVelocity;var o=n.m_linearVelocity;var u=n.m_angularVelocity;var f=0;var l=0;var c=0;var h=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var p=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i;var d=this.m_motorMass*(this.m_motorSpeed-p);var v=this.m_motorImpulse;var m=e.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+d,-m,m);d=this.m_motorImpulse-v;f=d*this.m_axis.x;l=d*this.m_axis.y;c=d*this.m_a1;h=d*this.m_a2;r.x-=this.m_invMassA*f;r.y-=this.m_invMassA*l;i-=this.m_invIA*c;o.x+=this.m_invMassB*f;o.y+=this.m_invMassB*l;u+=this.m_invIB*h}var y=this.m_perp.x*(o.x-r.x)+this.m_perp.y*(o.y-r.y)+this.m_s2*u-this.m_s1*i;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var b=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i;var w=this.m_impulse.Copy();var E=this.m_K.Solve(new a,-y,-b);this.m_impulse.Add(E);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.y=s.Max(this.m_impulse.y,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.y=s.Min(this.m_impulse.y,0)}var S=-y-(this.m_impulse.y-w.y)*this.m_K.col2.x;var x=0;if(this.m_K.col1.x!=0){x=S/this.m_K.col1.x+w.x}else{x=w.x}this.m_impulse.x=x;E.x=this.m_impulse.x-w.x;E.y=this.m_impulse.y-w.y;f=E.x*this.m_perp.x+E.y*this.m_axis.x;l=E.x*this.m_perp.y+E.y*this.m_axis.y;c=E.x*this.m_s1+E.y*this.m_a1;h=E.x*this.m_s2+E.y*this.m_a2;r.x-=this.m_invMassA*f;r.y-=this.m_invMassA*l;i-=this.m_invIA*c;o.x+=this.m_invMassB*f;o.y+=this.m_invMassB*l;u+=this.m_invIB*h}else{var T=0;if(this.m_K.col1.x!=0){T=-y/this.m_K.col1.x}else{T=0}this.m_impulse.x+=T;f=T*this.m_perp.x;l=T*this.m_perp.y;c=T*this.m_s1;h=T*this.m_s2;r.x-=this.m_invMassA*f;r.y-=this.m_invMassA*l;i-=this.m_invIA*c;o.x+=this.m_invMassB*f;o.y+=this.m_invMassB*l;u+=this.m_invIB*h}t.m_linearVelocity.SetV(r);t.m_angularVelocity=i;n.m_linearVelocity.SetV(o);n.m_angularVelocity=u};w.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=0;var i=0;var o=this.m_bodyA;var u=this.m_bodyB;var f=o.m_sweep.c;var l=o.m_sweep.a;var c=u.m_sweep.c;var h=u.m_sweep.a;var p;var d=0;var v=0;var m=0;var g=0;var y=0;var b=0;var w=0;var E=false;var S=0;var x=r.FromAngle(l);var T=r.FromAngle(h);p=x;var N=this.m_localAnchor1.x-this.m_localCenterA.x;var C=this.m_localAnchor1.y-this.m_localCenterA.y;d=p.col1.x*N+p.col2.x*C;C=p.col1.y*N+p.col2.y*C;N=d;p=T;var k=this.m_localAnchor2.x-this.m_localCenterB.x;var L=this.m_localAnchor2.y-this.m_localCenterB.y;d=p.col1.x*k+p.col2.x*L;L=p.col1.y*k+p.col2.y*L;k=d;var A=c.x+k-f.x-N;var O=c.y+L-f.y-C;if(this.m_enableLimit){this.m_axis=s.MulMV(x,this.m_localXAxis1);this.m_a1=(A+N)*this.m_axis.y-(O+C)*this.m_axis.x;this.m_a2=k*this.m_axis.y-L*this.m_axis.x;var M=this.m_axis.x*A+this.m_axis.y*O;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop){S=s.Clamp(M,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection);b=s.Abs(M);E=true}else if(M<=this.m_lowerTranslation){S=s.Clamp(M-this.m_lowerTranslation+n.b2_linearSlop,-n.b2_maxLinearCorrection,0);b=this.m_lowerTranslation-M;E=true}else if(M>=this.m_upperTranslation){S=s.Clamp(M-this.m_upperTranslation+n.b2_linearSlop,0,n.b2_maxLinearCorrection);b=M-this.m_upperTranslation;E=true}}this.m_perp=s.MulMV(x,this.m_localYAxis1);this.m_s1=(A+N)*this.m_perp.y-(O+C)*this.m_perp.x;this.m_s2=k*this.m_perp.y-L*this.m_perp.x;var _=new a;var D=this.m_perp.x*A+this.m_perp.y*O;b=s.Max(b,s.Abs(D));w=0;if(E){v=this.m_invMassA;m=this.m_invMassB;g=this.m_invIA;y=this.m_invIB;this.m_K.col1.x=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+m+g*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2;this.m_K.Solve(_,-D,-S)}else{v=this.m_invMassA;m=this.m_invMassB;g=this.m_invIA;y=this.m_invIB;var P=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;var H=0;if(P!=0){H=-D/P}else{H=0}_.x=H;_.y=0}var B=_.x*this.m_perp.x+_.y*this.m_axis.x;var j=_.x*this.m_perp.y+_.y*this.m_axis.y;var F=_.x*this.m_s1+_.y*this.m_a1;var I=_.x*this.m_s2+_.y*this.m_a2;f.x-=this.m_invMassA*B;f.y-=this.m_invMassA*j;l-=this.m_invIA*F;c.x+=this.m_invMassB*B;c.y+=this.m_invMassB*j;h+=this.m_invIB*I;o.m_sweep.a=l;u.m_sweep.a=h;o.SynchronizeTransform();u.SynchronizeTransform();return b<=n.b2_linearSlop&&w<=n.b2_angularSlop};Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef);E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;E.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a;this.localAxisA=new a};E.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};E.prototype.Initialize=function(e,t,n,r){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(n);this.localAnchorB=this.bodyB.GetLocalPoint(n);this.localAxisA=this.bodyA.GetLocalVector(r)};Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint);S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;S.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new r;this.K1=new r;this.K2=new r;this.m_localAnchor=new a;this.m_target=new a;this.m_impulse=new a;this.m_mass=new r;this.m_C=new a};S.prototype.GetAnchorA=function(){return this.m_target};S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};S.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse.x,e*this.m_impulse.y)};S.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return 0};S.prototype.GetTarget=function(){return this.m_target};S.prototype.SetTarget=function(e){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=e};S.prototype.GetMaxForce=function(){return this.m_maxForce};S.prototype.SetMaxForce=function(e){if(e===undefined)e=0;this.m_maxForce=e};S.prototype.GetFrequency=function(){return this.m_frequencyHz};S.prototype.SetFrequency=function(e){if(e===undefined)e=0;this.m_frequencyHz=e};S.prototype.GetDampingRatio=function(){return this.m_dampingRatio};S.prototype.SetDampingRatio=function(e){if(e===undefined)e=0;this.m_dampingRatio=e};S.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e);this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x;var n=this.m_target.y-this.m_bodyB.m_xf.position.y;var r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y;this.m_localAnchor.y=t*r.col2.x+n*r.col2.y;this.m_maxForce=e.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=e.frequencyHz;this.m_dampingRatio=e.dampingRatio;this.m_beta=0;this.m_gamma=0};S.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB;var n=t.GetMass();var r=2*Math.PI*this.m_frequencyHz;var i=2*n*this.m_dampingRatio*r;var s=n*r*r;this.m_gamma=e.dt*(i+e.dt*s);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=e.dt*s*this.m_gamma;var o;o=t.m_xf.R;var u=this.m_localAnchor.x-t.m_sweep.localCenter.x;var a=this.m_localAnchor.y-t.m_sweep.localCenter.y;var f=o.col1.x*u+o.col2.x*a;a=o.col1.y*u+o.col2.y*a;u=f;var l=t.m_invMass;var c=t.m_invI;this.K1.col1.x=l;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=l;this.K2.col1.x=c*a*a;this.K2.col2.x=-c*u*a;this.K2.col1.y=-c*u*a;this.K2.col2.y=c*u*u;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=t.m_sweep.c.x+u-this.m_target.x;this.m_C.y=t.m_sweep.c.y+a-this.m_target.y;t.m_angularVelocity*=.98;this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;t.m_linearVelocity.x+=l*this.m_impulse.x;t.m_linearVelocity.y+=l*this.m_impulse.y;t.m_angularVelocity+=c*(u*this.m_impulse.y-a*this.m_impulse.x)};S.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB;var n;var r=0;var i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x;var o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o;o=n.col1.y*s+n.col2.y*o;s=r;var u=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var a=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass;r=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;i=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var f=-(n.col1.x*r+n.col2.x*i);var l=-(n.col1.y*r+n.col2.y*i);var c=this.m_impulse.x;var h=this.m_impulse.y;this.m_impulse.x+=f;this.m_impulse.y+=l;var p=e.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>p*p){this.m_impulse.Multiply(p/this.m_impulse.Length())}f=this.m_impulse.x-c;l=this.m_impulse.y-h;t.m_linearVelocity.x+=t.m_invMass*f;t.m_linearVelocity.y+=t.m_invMass*l;t.m_angularVelocity+=t.m_invI*(s*l-o*f)};S.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;return true};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new a};x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint);T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;T.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_localXAxis1=new a;this.m_localYAxis1=new a;this.m_axis=new a;this.m_perp=new a;this.m_K=new i;this.m_impulse=new f};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};T.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};T.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.y};T.prototype.GetJointTranslation=function(){var e=this.m_bodyA;var t=this.m_bodyB;var n;var r=e.GetWorldPoint(this.m_localAnchor1);var i=t.GetWorldPoint(this.m_localAnchor2);var s=i.x-r.x;var o=i.y-r.y;var u=e.GetWorldVector(this.m_localXAxis1);var a=u.x*s+u.y*o;return a};T.prototype.GetJointSpeed=function(){var e=this.m_bodyA;var t=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var i=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i;r=s;n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u;u=n.col1.y*o+n.col2.y*u;o=s;var a=e.m_sweep.c.x+r;var f=e.m_sweep.c.y+i;var l=t.m_sweep.c.x+o;var c=t.m_sweep.c.y+u;var h=l-a;var p=c-f;var d=e.GetWorldVector(this.m_localXAxis1);var v=e.m_linearVelocity;var m=t.m_linearVelocity;var g=e.m_angularVelocity;var y=t.m_angularVelocity;var b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b};T.prototype.IsLimitEnabled=function(){return this.m_enableLimit};T.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=e};T.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};T.prototype.GetUpperLimit=function(){return this.m_upperTranslation};T.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=e;this.m_upperTranslation=t};T.prototype.IsMotorEnabled=function(){return this.m_enableMotor};T.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=e};T.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};T.prototype.SetMaxMotorForce=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=e};T.prototype.GetMotorForce=function(){return this.m_motorImpulse};T.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e);var t;var n=0;var r=0;this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_localXAxis1.SetV(e.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=e.lowerTranslation;this.m_upperTranslation=e.upperTranslation;this.m_maxMotorForce=e.maxMotorForce;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};T.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA;var r=this.m_bodyB;var i;var o=0;this.m_localCenterA.SetV(t.GetLocalCenter());this.m_localCenterB.SetV(r.GetLocalCenter());var u=t.GetTransform();var a=r.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x;var l=this.m_localAnchor1.y-this.m_localCenterA.y;o=i.col1.x*f+i.col2.x*l;l=i.col1.y*f+i.col2.y*l;f=o;i=r.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var h=this.m_localAnchor2.y-this.m_localCenterB.y;o=i.col1.x*c+i.col2.x*h;h=i.col1.y*c+i.col2.y*h;c=o;var p=r.m_sweep.c.x+c-t.m_sweep.c.x-f;var d=r.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass;this.m_invMassB=r.m_invMass;this.m_invIA=t.m_invI;this.m_invIB=r.m_invI;{this.m_axis.SetV(s.MulMV(u.R,this.m_localXAxis1));this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x;this.m_a2=c*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(s.MulMV(u.R,this.m_localYAxis1));this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x;this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA;var m=this.m_invMassB;var y=this.m_invIA;var b=this.m_invIB;this.m_K.col1.x=v+m+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2;this.m_K.col1.y=y*this.m_s1+b*this.m_s2;this.m_K.col1.z=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+b;this.m_K.col2.z=y*this.m_a1+b*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=v+m+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2}if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(w<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.z=0}}else if(w>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var x=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E;t.m_linearVelocity.y-=this.m_invMassA*S;t.m_angularVelocity-=this.m_invIA*x;r.m_linearVelocity.x+=this.m_invMassB*E;r.m_linearVelocity.y+=this.m_invMassB*S;r.m_angularVelocity+=this.m_invIB*T}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};T.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA;var n=this.m_bodyB;var r=t.m_linearVelocity;var i=t.m_angularVelocity;var o=n.m_linearVelocity;var u=n.m_angularVelocity;var l=0;var c=0;var h=0;var p=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var d=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i;var v=this.m_motorMass*(this.m_motorSpeed-d);var m=this.m_motorImpulse;var y=e.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+v,-y,y);v=this.m_motorImpulse-m;l=v*this.m_axis.x;c=v*this.m_axis.y;h=v*this.m_a1;p=v*this.m_a2;r.x-=this.m_invMassA*l;r.y-=this.m_invMassA*c;i-=this.m_invIA*h;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*c;u+=this.m_invIB*p}var b=this.m_perp.x*(o.x-r.x)+this.m_perp.y*(o.y-r.y)+this.m_s2*u-this.m_s1*i;var w=u-i;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var E=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i;var S=this.m_impulse.Copy();var x=this.m_K.Solve33(new f,-b,-w,-E);this.m_impulse.Add(x);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.z=s.Max(this.m_impulse.z,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.z=s.Min(this.m_impulse.z,0)}var T=-b-(this.m_impulse.z-S.z)*this.m_K.col3.x;var N=-w-(this.m_impulse.z-S.z)*this.m_K.col3.y;var C=this.m_K.Solve22(new a,T,N);C.x+=S.x;C.y+=S.y;this.m_impulse.x=C.x;this.m_impulse.y=C.y;x.x=this.m_impulse.x-S.x;x.y=this.m_impulse.y-S.y;x.z=this.m_impulse.z-S.z;l=x.x*this.m_perp.x+x.z*this.m_axis.x;c=x.x*this.m_perp.y+x.z*this.m_axis.y;h=x.x*this.m_s1+x.y+x.z*this.m_a1;p=x.x*this.m_s2+x.y+x.z*this.m_a2;r.x-=this.m_invMassA*l;r.y-=this.m_invMassA*c;i-=this.m_invIA*h;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*c;u+=this.m_invIB*p}else{var k=this.m_K.Solve22(new a,-b,-w);this.m_impulse.x+=k.x;this.m_impulse.y+=k.y;l=k.x*this.m_perp.x;c=k.x*this.m_perp.y;h=k.x*this.m_s1+k.y;p=k.x*this.m_s2+k.y;r.x-=this.m_invMassA*l;r.y-=this.m_invMassA*c;i-=this.m_invIA*h;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*c;u+=this.m_invIB*p}t.m_linearVelocity.SetV(r);t.m_angularVelocity=i;n.m_linearVelocity.SetV(o);n.m_angularVelocity=u};T.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=0;var i=0;var o=this.m_bodyA;var u=this.m_bodyB;var l=o.m_sweep.c;var c=o.m_sweep.a;var h=u.m_sweep.c;var p=u.m_sweep.a;var d;var v=0;var m=0;var g=0;var y=0;var b=0;var w=0;var E=0;var S=false;var x=0;var T=r.FromAngle(c);var N=r.FromAngle(p);d=T;var C=this.m_localAnchor1.x-this.m_localCenterA.x;var k=this.m_localAnchor1.y-this.m_localCenterA.y;v=d.col1.x*C+d.col2.x*k;k=d.col1.y*C+d.col2.y*k;C=v;d=N;var L=this.m_localAnchor2.x-this.m_localCenterB.x;var A=this.m_localAnchor2.y-this.m_localCenterB.y;v=d.col1.x*L+d.col2.x*A;A=d.col1.y*L+d.col2.y*A;L=v;var O=h.x+L-l.x-C;var M=h.y+A-l.y-k;if(this.m_enableLimit){this.m_axis=s.MulMV(T,this.m_localXAxis1);this.m_a1=(O+C)*this.m_axis.y-(M+k)*this.m_axis.x;this.m_a2=L*this.m_axis.y-A*this.m_axis.x;var _=this.m_axis.x*O+this.m_axis.y*M;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop){x=s.Clamp(_,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection);w=s.Abs(_);S=true}else if(_<=this.m_lowerTranslation){x=s.Clamp(_-this.m_lowerTranslation+n.b2_linearSlop,-n.b2_maxLinearCorrection,0);w=this.m_lowerTranslation-_;S=true}else if(_>=this.m_upperTranslation){x=s.Clamp(_-this.m_upperTranslation+n.b2_linearSlop,0,n.b2_maxLinearCorrection);w=_-this.m_upperTranslation;S=true}}this.m_perp=s.MulMV(T,this.m_localYAxis1);this.m_s1=(O+C)*this.m_perp.y-(M+k)*this.m_perp.x;this.m_s2=L*this.m_perp.y-A*this.m_perp.x;var D=new f;var P=this.m_perp.x*O+this.m_perp.y*M;var H=p-c-this.m_refAngle;w=s.Max(w,s.Abs(P));E=s.Abs(H);if(S){m=this.m_invMassA;g=this.m_invMassB;y=this.m_invIA;b=this.m_invIB;this.m_K.col1.x=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2;this.m_K.col1.y=y*this.m_s1+b*this.m_s2;this.m_K.col1.z=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+b;this.m_K.col2.z=y*this.m_a1+b*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=m+g+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;this.m_K.Solve33(D,-P,-H,-x)}else{m=this.m_invMassA;g=this.m_invMassB;y=this.m_invIA;b=this.m_invIB;var B=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2;var j=y*this.m_s1+b*this.m_s2;var F=y+b;this.m_K.col1.Set(B,j,0);this.m_K.col2.Set(j,F,0);var I=this.m_K.Solve22(new a,-P,-H);D.x=I.x;D.y=I.y;D.z=0}var q=D.x*this.m_perp.x+D.z*this.m_axis.x;var R=D.x*this.m_perp.y+D.z*this.m_axis.y;var U=D.x*this.m_s1+D.y+D.z*this.m_a1;var z=D.x*this.m_s2+D.y+D.z*this.m_a2;l.x-=this.m_invMassA*q;l.y-=this.m_invMassA*R;c-=this.m_invIA*U;h.x+=this.m_invMassB*q;h.y+=this.m_invMassB*R;p+=this.m_invIB*z;o.m_sweep.a=c;u.m_sweep.a=p;o.SynchronizeTransform();u.SynchronizeTransform();return w<=n.b2_linearSlop&&E<=n.b2_angularSlop};Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef);N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;N.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a;this.localAxisA=new a};N.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};N.prototype.Initialize=function(e,t,n,r){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(n);this.localAnchorB=this.bodyB.GetLocalPoint(n);this.localAxisA=this.bodyA.GetLocalVector(r);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint);C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;C.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new a;this.m_groundAnchor2=new a;this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_u1=new a;this.m_u2=new a};C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};C.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)};C.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return 0};C.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();e.Add(this.m_groundAnchor1);return e};C.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();e.Add(this.m_groundAnchor2);return e};C.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var t=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var n=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var r=e.x-t;var i=e.y-n;return Math.sqrt(r*r+i*i)};C.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var r=e.x-t;var i=e.y-n;return Math.sqrt(r*r+i*i)};C.prototype.GetRatio=function(){return this.m_ratio};C.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e);var t;var n=0;var r=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_ratio=e.ratio;this.m_constant=e.lengthA+this.m_ratio*e.lengthB;this.m_maxLength1=s.Min(e.maxLengthA,this.m_constant-this.m_ratio*C.b2_minPulleyLength);this.m_maxLength2=s.Min(e.maxLengthB,(this.m_constant-C.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};C.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA;var r=this.m_bodyB;var i;i=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o;s=u;i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f;f=i.col1.y*a+i.col2.y*f;a=u;var l=t.m_sweep.c.x+s;var c=t.m_sweep.c.y+o;var h=r.m_sweep.c.x+a;var p=r.m_sweep.c.y+f;var d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var v=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(l-d,c-v);this.m_u2.Set(h-m,p-y);var b=this.m_u1.Length();var w=this.m_u2.Length();if(b>n.b2_linearSlop){this.m_u1.Multiply(1/b)}else{this.m_u1.SetZero()}if(w>n.b2_linearSlop){this.m_u2.Multiply(1/w)}else{this.m_u2.SetZero()}var E=this.m_constant-b-this.m_ratio*w;if(E>0){this.m_state=g.e_inactiveLimit;this.m_impulse=0}else{this.m_state=g.e_atUpperLimit}if(b<this.m_maxLength1){this.m_limitState1=g.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=g.e_atUpperLimit}if(w<this.m_maxLength2){this.m_limitState2=g.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=g.e_atUpperLimit}var S=s*this.m_u1.y-o*this.m_u1.x;var x=a*this.m_u2.y-f*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*S*S;this.m_limitMass2=r.m_invMass+r.m_invI*x*x;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(e.warmStarting){this.m_impulse*=e.dtRatio;this.m_limitImpulse1*=e.dtRatio;this.m_limitImpulse2*=e.dtRatio;var T=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var N=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var C=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*T;t.m_linearVelocity.y+=t.m_invMass*N;t.m_angularVelocity+=t.m_invI*(s*N-o*T);r.m_linearVelocity.x+=r.m_invMass*C;r.m_linearVelocity.y+=r.m_invMass*k;r.m_angularVelocity+=r.m_invI*(a*k-f*C)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};C.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA;var n=this.m_bodyB;var r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var u=r.col1.x*i+r.col2.x*o;o=r.col1.y*i+r.col2.y*o;i=u;r=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;u=r.col1.x*a+r.col2.x*f;f=r.col1.y*a+r.col2.y*f;a=u;var l=0;var c=0;var h=0;var p=0;var d=0;var v=0;var m=0;var y=0;var b=0;var w=0;var E=0;if(this.m_state==g.e_atUpperLimit){l=t.m_linearVelocity.x+ -t.m_angularVelocity*o;c=t.m_linearVelocity.y+t.m_angularVelocity*i;h=n.m_linearVelocity.x+ -n.m_angularVelocity*f;p=n.m_linearVelocity.y+n.m_angularVelocity*a;b=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*h+this.m_u2.y*p);w=this.m_pulleyMass*-b;E=this.m_impulse;this.m_impulse=s.Max(0,this.m_impulse+w);w=this.m_impulse-E;d=-w*this.m_u1.x;v=-w*this.m_u1.y;m=-this.m_ratio*w*this.m_u2.x;y=-this.m_ratio*w*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*d;t.m_linearVelocity.y+=t.m_invMass*v;t.m_angularVelocity+=t.m_invI*(i*v-o*d);n.m_linearVelocity.x+=n.m_invMass*m;n.m_linearVelocity.y+=n.m_invMass*y;n.m_angularVelocity+=n.m_invI*(a*y-f*m)}if(this.m_limitState1==g.e_atUpperLimit){l=t.m_linearVelocity.x+ -t.m_angularVelocity*o;c=t.m_linearVelocity.y+t.m_angularVelocity*i;b=-(this.m_u1.x*l+this.m_u1.y*c);w=-this.m_limitMass1*b;E=this.m_limitImpulse1;this.m_limitImpulse1=s.Max(0,this.m_limitImpulse1+w);w=this.m_limitImpulse1-E;d=-w*this.m_u1.x;v=-w*this.m_u1.y;t.m_linearVelocity.x+=t.m_invMass*d;t.m_linearVelocity.y+=t.m_invMass*v;t.m_angularVelocity+=t.m_invI*(i*v-o*d)}if(this.m_limitState2==g.e_atUpperLimit){h=n.m_linearVelocity.x+ -n.m_angularVelocity*f;p=n.m_linearVelocity.y+n.m_angularVelocity*a;b=-(this.m_u2.x*h+this.m_u2.y*p);w=-this.m_limitMass2*b;E=this.m_limitImpulse2;this.m_limitImpulse2=s.Max(0,this.m_limitImpulse2+w);w=this.m_limitImpulse2-E;m=-w*this.m_u2.x;y=-w*this.m_u2.y;n.m_linearVelocity.x+=n.m_invMass*m;n.m_linearVelocity.y+=n.m_invMass*y;n.m_angularVelocity+=n.m_invI*(a*y-f*m)}};C.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=this.m_bodyA;var r=this.m_bodyB;var i;var o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var a=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var l=0;var c=0;var h=0;var p=0;var d=0;var v=0;var m=0;var y=0;var b=0;var w=0;var E=0;var S=0;var x=0;var T=0;var N=0;var C=0;if(this.m_state==g.e_atUpperLimit){i=t.m_xf.R;l=this.m_localAnchor1.x-t.m_sweep.localCenter.x;c=this.m_localAnchor1.y-t.m_sweep.localCenter.y;N=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=N;i=r.m_xf.R;h=this.m_localAnchor2.x-r.m_sweep.localCenter.x;p=this.m_localAnchor2.y-r.m_sweep.localCenter.y;N=i.col1.x*h+i.col2.x*p;p=i.col1.y*h+i.col2.y*p;h=N;d=t.m_sweep.c.x+l;v=t.m_sweep.c.y+c;m=r.m_sweep.c.x+h;y=r.m_sweep.c.y+p;this.m_u1.Set(d-o,v-u);this.m_u2.Set(m-a,y-f);b=this.m_u1.Length();w=this.m_u2.Length();if(b>n.b2_linearSlop){this.m_u1.Multiply(1/b)}else{this.m_u1.SetZero()}if(w>n.b2_linearSlop){this.m_u2.Multiply(1/w)}else{this.m_u2.SetZero()}E=this.m_constant-b-this.m_ratio*w;C=s.Max(C,-E);E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0);S=-this.m_pulleyMass*E;d=-S*this.m_u1.x;v=-S*this.m_u1.y;m=-this.m_ratio*S*this.m_u2.x;y=-this.m_ratio*S*this.m_u2.y;t.m_sweep.c.x+=t.m_invMass*d;t.m_sweep.c.y+=t.m_invMass*v;t.m_sweep.a+=t.m_invI*(l*v-c*d);r.m_sweep.c.x+=r.m_invMass*m;r.m_sweep.c.y+=r.m_invMass*y;r.m_sweep.a+=r.m_invI*(h*y-p*m);t.SynchronizeTransform();r.SynchronizeTransform()}if(this.m_limitState1==g.e_atUpperLimit){i=t.m_xf.R;l=this.m_localAnchor1.x-t.m_sweep.localCenter.x;c=this.m_localAnchor1.y-t.m_sweep.localCenter.y;N=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=N;d=t.m_sweep.c.x+l;v=t.m_sweep.c.y+c;this.m_u1.Set(d-o,v-u);b=this.m_u1.Length();if(b>n.b2_linearSlop){this.m_u1.x*=1/b;this.m_u1.y*=1/b}else{this.m_u1.SetZero()}E=this.m_maxLength1-b;C=s.Max(C,-E);E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0);S=-this.m_limitMass1*E;d=-S*this.m_u1.x;v=-S*this.m_u1.y;t.m_sweep.c.x+=t.m_invMass*d;t.m_sweep.c.y+=t.m_invMass*v;t.m_sweep.a+=t.m_invI*(l*v-c*d);t.SynchronizeTransform()}if(this.m_limitState2==g.e_atUpperLimit){i=r.m_xf.R;h=this.m_localAnchor2.x-r.m_sweep.localCenter.x;p=this.m_localAnchor2.y-r.m_sweep.localCenter.y;N=i.col1.x*h+i.col2.x*p;p=i.col1.y*h+i.col2.y*p;h=N;m=r.m_sweep.c.x+h;y=r.m_sweep.c.y+p;this.m_u2.Set(m-a,y-f);w=this.m_u2.Length();if(w>n.b2_linearSlop){this.m_u2.x*=1/w;this.m_u2.y*=1/w}else{this.m_u2.SetZero()}E=this.m_maxLength2-w;C=s.Max(C,-E);E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0);S=-this.m_limitMass2*E;m=-S*this.m_u2.x;y=-S*this.m_u2.y;r.m_sweep.c.x+=r.m_invMass*m;r.m_sweep.c.y+=r.m_invMass*y;r.m_sweep.a+=r.m_invI*(h*y-p*m);r.SynchronizeTransform()}return C<n.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef);k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;k.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new a;this.groundAnchorB=new a;this.localAnchorA=new a;this.localAnchorB=new a};k.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};k.prototype.Initialize=function(e,t,n,r,i,s,o){if(o===undefined)o=0;this.bodyA=e;this.bodyB=t;this.groundAnchorA.SetV(n);this.groundAnchorB.SetV(r);this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(s);var u=i.x-n.x;var a=i.y-n.y;this.lengthA=Math.sqrt(u*u+a*a);var f=s.x-r.x;var l=s.y-r.y;this.lengthB=Math.sqrt(f*f+l*l);this.ratio=o;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*C.b2_minPulleyLength;this.maxLengthB=(c-C.b2_minPulleyLength)/this.ratio};Box2D.inherit(L,Box2D.Dynamics.Joints.b2Joint);L.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;L.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new r;this.K1=new r;this.K2=new r;this.K3=new r;this.impulse3=new f;this.impulse2=new a;this.reduced=new a;this.m_localAnchor1=new a;this.m_localAnchor2=new a;this.m_impulse=new f;this.m_mass=new i};L.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};L.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};L.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse.x,e*this.m_impulse.y)};L.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.z};L.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};L.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};L.prototype.IsLimitEnabled=function(){return this.m_enableLimit};L.prototype.EnableLimit=function(e){this.m_enableLimit=e};L.prototype.GetLowerLimit=function(){return this.m_lowerAngle};L.prototype.GetUpperLimit=function(){return this.m_upperAngle};L.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_lowerAngle=e;this.m_upperAngle=t};L.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};L.prototype.EnableMotor=function(e){this.m_enableMotor=e};L.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};L.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};L.prototype.SetMaxMotorTorque=function(e){if(e===undefined)e=0;this.m_maxMotorTorque=e};L.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};L.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_referenceAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=e.lowerAngle;this.m_upperAngle=e.upperAngle;this.m_maxMotorTorque=e.maxMotorTorque;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=g.e_inactiveLimit};L.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA;var r=this.m_bodyB;var i;var o=0;if(this.m_enableMotor||this.m_enableLimit){}i=t.m_xf.R;var u=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-t.m_sweep.localCenter.y;o=i.col1.x*u+i.col2.x*a;a=i.col1.y*u+i.col2.y*a;u=o;i=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=i.col1.x*f+i.col2.x*l;l=i.col1.y*f+i.col2.y*l;f=o;var c=t.m_invMass;var h=r.m_invMass;var p=t.m_invI;var d=r.m_invI;this.m_mass.col1.x=c+h+a*a*p+l*l*d;this.m_mass.col2.x=-a*u*p-l*f*d;this.m_mass.col3.x=-a*p-l*d;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+h+u*u*p+f*f*d;this.m_mass.col3.y=u*p+f*d;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+d;this.m_motorMass=1/(p+d);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var v=r.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;if(s.Abs(this.m_upperAngle-this.m_lowerAngle)<2*n.b2_angularSlop){this.m_limitState=g.e_equalLimits}else if(v<=this.m_lowerAngle){if(this.m_limitState!=g.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=g.e_atLowerLimit}else if(v>=this.m_upperAngle){if(this.m_limitState!=g.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=g.e_atUpperLimit}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit}if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_motorImpulse*=e.dtRatio;var m=this.m_impulse.x;var y=this.m_impulse.y;t.m_linearVelocity.x-=c*m;t.m_linearVelocity.y-=c*y;t.m_angularVelocity-=p*(u*y-a*m+this.m_motorImpulse+this.m_impulse.z);r.m_linearVelocity.x+=h*m;r.m_linearVelocity.y+=h*y;r.m_angularVelocity+=d*(f*y-l*m+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};L.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA;var n=this.m_bodyB;var r;var i=0;var o=0;var u=0;var a=0;var f=0;var l=0;var c=t.m_linearVelocity;var h=t.m_angularVelocity;var p=n.m_linearVelocity;var d=n.m_angularVelocity;var v=t.m_invMass;var m=n.m_invMass;var y=t.m_invI;var b=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var w=d-h-this.m_motorSpeed;var E=this.m_motorMass*-w;var S=this.m_motorImpulse;var x=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+E,-x,x);E=this.m_motorImpulse-S;h-=y*E;d+=b*E}if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){r=t.m_xf.R;u=this.m_localAnchor1.x-t.m_sweep.localCenter.x;a=this.m_localAnchor1.y-t.m_sweep.localCenter.y;i=r.col1.x*u+r.col2.x*a;a=r.col1.y*u+r.col2.y*a;u=i;r=n.m_xf.R;f=this.m_localAnchor2.x-n.m_sweep.localCenter.x;l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=r.col1.x*f+r.col2.x*l;l=r.col1.y*f+r.col2.y*l;f=i;var T=p.x+ -d*l-c.x- -h*a;var N=p.y+d*f-c.y-h*u;var C=d-h;this.m_mass.Solve33(this.impulse3,-T,-N,-C);if(this.m_limitState==g.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==g.e_atLowerLimit){o=this.m_impulse.z+this.impulse3.z;if(o<0){this.m_mass.Solve22(this.reduced,-T,-N);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==g.e_atUpperLimit){o=this.m_impulse.z+this.impulse3.z;if(o>0){this.m_mass.Solve22(this.reduced,-T,-N);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}c.x-=v*this.impulse3.x;c.y-=v*this.impulse3.y;h-=y*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z);p.x+=m*this.impulse3.x;p.y+=m*this.impulse3.y;d+=b*(f*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else{r=t.m_xf.R;u=this.m_localAnchor1.x-t.m_sweep.localCenter.x;a=this.m_localAnchor1.y-t.m_sweep.localCenter.y;i=r.col1.x*u+r.col2.x*a;a=r.col1.y*u+r.col2.y*a;u=i;r=n.m_xf.R;f=this.m_localAnchor2.x-n.m_sweep.localCenter.x;l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=r.col1.x*f+r.col2.x*l;l=r.col1.y*f+r.col2.y*l;f=i;var k=p.x+ -d*l-c.x- -h*a;var L=p.y+d*f-c.y-h*u;this.m_mass.Solve22(this.impulse2,-k,-L);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;c.x-=v*this.impulse2.x;c.y-=v*this.impulse2.y;h-=y*(u*this.impulse2.y-a*this.impulse2.x);p.x+=m*this.impulse2.x;p.y+=m*this.impulse2.y;d+=b*(f*this.impulse2.y-l*this.impulse2.x)}t.m_linearVelocity.SetV(c);t.m_angularVelocity=h;n.m_linearVelocity.SetV(p);n.m_angularVelocity=d};L.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t=0;var r=0;var i;var o=this.m_bodyA;var u=this.m_bodyB;var a=0;var f=0;var l=0;var c=0;var h=0;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var p=u.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;var d=0;if(this.m_limitState==g.e_equalLimits){r=s.Clamp(p-this.m_lowerAngle,-n.b2_maxAngularCorrection,n.b2_maxAngularCorrection);d=-this.m_motorMass*r;a=s.Abs(r)}else if(this.m_limitState==g.e_atLowerLimit){r=p-this.m_lowerAngle;a=-r;r=s.Clamp(r+n.b2_angularSlop,-n.b2_maxAngularCorrection,0);d=-this.m_motorMass*r}else if(this.m_limitState==g.e_atUpperLimit){r=p-this.m_upperAngle;a=r;r=s.Clamp(r-n.b2_angularSlop,0,n.b2_maxAngularCorrection);d=-this.m_motorMass*r}o.m_sweep.a-=o.m_invI*d;u.m_sweep.a+=u.m_invI*d;o.SynchronizeTransform();u.SynchronizeTransform()}{i=o.m_xf.R;var v=this.m_localAnchor1.x-o.m_sweep.localCenter.x;var m=this.m_localAnchor1.y-o.m_sweep.localCenter.y;l=i.col1.x*v+i.col2.x*m;m=i.col1.y*v+i.col2.y*m;v=l;i=u.m_xf.R;var y=this.m_localAnchor2.x-u.m_sweep.localCenter.x;var b=this.m_localAnchor2.y-u.m_sweep.localCenter.y;l=i.col1.x*y+i.col2.x*b;b=i.col1.y*y+i.col2.y*b;y=l;var w=u.m_sweep.c.x+y-o.m_sweep.c.x-v;var E=u.m_sweep.c.y+b-o.m_sweep.c.y-m;var S=w*w+E*E;var x=Math.sqrt(S);f=x;var T=o.m_invMass;var N=u.m_invMass;var C=o.m_invI;var k=u.m_invI;var A=10*n.b2_linearSlop;if(S>A*A){var O=w/x;var M=E/x;var _=T+N;var D=1/_;c=D*-w;h=D*-E;var P=.5;o.m_sweep.c.x-=P*T*c;o.m_sweep.c.y-=P*T*h;u.m_sweep.c.x+=P*N*c;u.m_sweep.c.y+=P*N*h;w=u.m_sweep.c.x+y-o.m_sweep.c.x-v;E=u.m_sweep.c.y+b-o.m_sweep.c.y-m}this.K1.col1.x=T+N;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=T+N;this.K2.col1.x=C*m*m;this.K2.col2.x=-C*v*m;this.K2.col1.y=-C*v*m;this.K2.col2.y=C*v*v;this.K3.col1.x=k*b*b;this.K3.col2.x=-k*y*b;this.K3.col1.y=-k*y*b;this.K3.col2.y=k*y*y;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(L.tImpulse,-w,-E);c=L.tImpulse.x;h=L.tImpulse.y;o.m_sweep.c.x-=o.m_invMass*c;o.m_sweep.c.y-=o.m_invMass*h;o.m_sweep.a-=o.m_invI*(v*h-m*c);u.m_sweep.c.x+=u.m_invMass*c;u.m_sweep.c.y+=u.m_invMass*h;u.m_sweep.a+=u.m_invI*(y*h-b*c);o.SynchronizeTransform();u.SynchronizeTransform()}return f<=n.b2_linearSlop&&a<=n.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new a});Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a};A.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};A.prototype.Initialize=function(e,t,n){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(n);this.localAnchorB=this.bodyB.GetLocalPoint(n);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(O,Box2D.Dynamics.Joints.b2Joint);O.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;O.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new a;this.m_localAnchorB=new a;this.m_impulse=new f;this.m_mass=new i};O.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};O.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};O.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new a(e*this.m_impulse.x,e*this.m_impulse.y)};O.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.z};O.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchorA.SetV(e.localAnchorA);this.m_localAnchorB.SetV(e.localAnchorB);this.m_referenceAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_mass=new i};O.prototype.InitVelocityConstraints=function(e){var t;var n=0;var r=this.m_bodyA;var i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o;o=t.col1.y*s+t.col2.y*o;s=n;t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x;var a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a;a=t.col1.y*u+t.col2.y*a;u=n;var f=r.m_invMass;var l=i.m_invMass;var c=r.m_invI;var h=i.m_invI;this.m_mass.col1.x=f+l+o*o*c+a*a*h;this.m_mass.col2.x=-o*s*c-a*u*h;this.m_mass.col3.x=-o*c-a*h;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=f+l+s*s*c+u*u*h;this.m_mass.col3.y=s*c+u*h;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=c+h;if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_impulse.z*=e.dtRatio;r.m_linearVelocity.x-=f*this.m_impulse.x;r.m_linearVelocity.y-=f*this.m_impulse.y;r.m_angularVelocity-=c*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z);i.m_linearVelocity.x+=l*this.m_impulse.x;i.m_linearVelocity.y+=l*this.m_impulse.y;i.m_angularVelocity+=h*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};O.prototype.SolveVelocityConstraints=function(e){var t;var n=0;var r=this.m_bodyA;var i=this.m_bodyB;var s=r.m_linearVelocity;var o=r.m_angularVelocity;var u=i.m_linearVelocity;var a=i.m_angularVelocity;var l=r.m_invMass;var c=i.m_invMass;var h=r.m_invI;var p=i.m_invI;t=r.m_xf.R;var d=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*d+t.col2.x*v;v=t.col1.y*d+t.col2.y*v;d=n;t=i.m_xf.R;var m=this.m_localAnchorB.x-i.m_sweep.localCenter.x;var g=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*m+t.col2.x*g;g=t.col1.y*m+t.col2.y*g;m=n;var y=u.x-a*g-s.x+o*v;var b=u.y+a*m-s.y-o*d;var w=a-o;var E=new f;this.m_mass.Solve33(E,-y,-b,-w);this.m_impulse.Add(E);s.x-=l*E.x;s.y-=l*E.y;o-=h*(d*E.y-v*E.x+E.z);u.x+=c*E.x;u.y+=c*E.y;a+=p*(m*E.y-g*E.x+E.z);r.m_angularVelocity=o;i.m_angularVelocity=a};O.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;var t;var r=0;var i=this.m_bodyA;var o=this.m_bodyB;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x;var a=this.m_localAnchorA.y-i.m_sweep.localCenter.y;r=t.col1.x*u+t.col2.x*a;a=t.col1.y*u+t.col2.y*a;u=r;t=o.m_xf.R;var l=this.m_localAnchorB.x-o.m_sweep.localCenter.x;var c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;r=t.col1.x*l+t.col2.x*c;c=t.col1.y*l+t.col2.y*c;l=r;var h=i.m_invMass;var p=o.m_invMass;var d=i.m_invI;var v=o.m_invI;var m=o.m_sweep.c.x+l-i.m_sweep.c.x-u;var g=o.m_sweep.c.y+c-i.m_sweep.c.y-a;var y=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle;var b=10*n.b2_linearSlop;var w=Math.sqrt(m*m+g*g);var E=s.Abs(y);if(w>b){d*=1;v*=1}this.m_mass.col1.x=h+p+a*a*d+c*c*v;this.m_mass.col2.x=-a*u*d-c*l*v;this.m_mass.col3.x=-a*d-c*v;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=h+p+u*u*d+l*l*v;this.m_mass.col3.y=u*d+l*v;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=d+v;var S=new f;this.m_mass.Solve33(S,-m,-g,-y);i.m_sweep.c.x-=h*S.x;i.m_sweep.c.y-=h*S.y;i.m_sweep.a-=d*(u*S.y-a*S.x+S.z);o.m_sweep.c.x+=p*S.x;o.m_sweep.c.y+=p*S.y;o.m_sweep.a+=v*(l*S.y-c*S.x+S.z);i.SynchronizeTransform();o.SynchronizeTransform();return w<=n.b2_linearSlop&&E<=n.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new a;this.localAnchorB=new a};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(e,t,n){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var e=Box2D.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var e=this;this.m_sprite={graphics:{clear:function(){}}}};e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"};e.prototype.b2DebugDraw=function(){this.m_drawFlags=0};e.prototype.SetFlags=function(e){if(e===undefined)e=0;this.m_drawFlags=e};e.prototype.GetFlags=function(){return this.m_drawFlags};e.prototype.AppendFlags=function(e){if(e===undefined)e=0;this.m_drawFlags|=e};e.prototype.ClearFlags=function(e){if(e===undefined)e=0;this.m_drawFlags&=~e};e.prototype.SetSprite=function(e){this.m_ctx=e};e.prototype.GetSprite=function(){return this.m_ctx};e.prototype.SetDrawScale=function(e){if(e===undefined)e=0;this.m_drawScale=e};e.prototype.GetDrawScale=function(){return this.m_drawScale};e.prototype.SetLineThickness=function(e){if(e===undefined)e=0;this.m_lineThickness=e;this.m_ctx.strokeWidth=e};e.prototype.GetLineThickness=function(){return this.m_lineThickness};e.prototype.SetAlpha=function(e){if(e===undefined)e=0;this.m_alpha=e};e.prototype.GetAlpha=function(){return this.m_alpha};e.prototype.SetFillAlpha=function(e){if(e===undefined)e=0;this.m_fillAlpha=e};e.prototype.GetFillAlpha=function(){return this.m_fillAlpha};e.prototype.SetXFormScale=function(e){if(e===undefined)e=0;this.m_xformScale=e};e.prototype.GetXFormScale=function(){return this.m_xformScale};e.prototype.DrawPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx;var i=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++){r.lineTo(e[s].x*i,e[s].y*i)}r.lineTo(e[0].x*i,e[0].y*i);r.closePath();r.stroke()};e.prototype.DrawSolidPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx;var i=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.fillStyle=this._color(n.color,this.m_fillAlpha);r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++){r.lineTo(e[s].x*i,e[s].y*i)}r.lineTo(e[0].x*i,e[0].y*i);r.closePath();r.fill();r.stroke()};e.prototype.DrawCircle=function(e,t,n){if(!t)return;var r=this.m_ctx;var i=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,true);r.closePath();r.stroke()};e.prototype.DrawSolidCircle=function(e,t,n,r){if(!t)return;var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0);i.beginPath();i.strokeStyle=this._color(r.color,this.m_alpha);i.arc(o,u,t*s,0,Math.PI*2,true);i.moveTo(o,u);i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s);i.closePath();i.stroke()};e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha);r.beginPath();r.moveTo(e.x*i,e.y*i);r.lineTo(t.x*i,t.y*i);r.closePath();r.stroke()};e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath();t.strokeStyle=this._color(16711680,this.m_alpha);t.moveTo(e.position.x*n,e.position.y*n);t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n);t.stroke();t.beginPath();t.strokeStyle=this._color(65280,this.m_alpha);t.moveTo(e.position.x*n,e.position.y*n);t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n);t.closePath();t.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;var b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2Shape=Box2D.Collision.Shapes.b2Shape,b2CircleContact=Box2D.Dynamics.Contacts.b2CircleContact,b2Contact=Box2D.Dynamics.Contacts.b2Contact,b2ContactConstraint=Box2D.Dynamics.Contacts.b2ContactConstraint,b2ContactConstraintPoint=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,b2ContactEdge=Box2D.Dynamics.Contacts.b2ContactEdge,b2ContactFactory=Box2D.Dynamics.Contacts.b2ContactFactory,b2ContactRegister=Box2D.Dynamics.Contacts.b2ContactRegister,b2ContactResult=Box2D.Dynamics.Contacts.b2ContactResult,b2ContactSolver=Box2D.Dynamics.Contacts.b2ContactSolver,b2EdgeAndCircleContact=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,b2NullContact=Box2D.Dynamics.Contacts.b2NullContact,b2PolyAndCircleContact=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,b2PolyAndEdgeContact=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,b2PolygonContact=Box2D.Dynamics.Contacts.b2PolygonContact,b2PositionSolverManifold=Box2D.Dynamics.Contacts.b2PositionSolverManifold,b2Body=Box2D.Dynamics.b2Body,b2_staticBody=Box2D.Dynamics.b2Body.b2_staticBody,b2_kinematicBody=Box2D.Dynamics.b2Body.b2_kinematicBody,b2_dynamicBody=Box2D.Dynamics.b2Body.b2_dynamicBody,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2ContactFilter=Box2D.Dynamics.b2ContactFilter,b2ContactImpulse=Box2D.Dynamics.b2ContactImpulse,b2ContactListener=Box2D.Dynamics.b2ContactListener,b2ContactManager=Box2D.Dynamics.b2ContactManager,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2DestructionListener=Box2D.Dynamics.b2DestructionListener,b2FilterData=Box2D.Dynamics.b2FilterData,b2Fixture=Box2D.Dynamics.b2Fixture,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Island=Box2D.Dynamics.b2Island,b2TimeStep=Box2D.Dynamics.b2TimeStep,b2World=Box2D.Dynamics.b2World,b2Color=Box2D.Common.b2Color,b2internal=Box2D.Common.b2internal,b2Settings=Box2D.Common.b2Settings,b2Mat22=Box2D.Common.Math.b2Mat22,b2Mat33=Box2D.Common.Math.b2Mat33,b2Math=Box2D.Common.Math.b2Math,b2Sweep=Box2D.Common.Math.b2Sweep,b2Transform=Box2D.Common.Math.b2Transform,b2Vec2=Box2D.Common.Math.b2Vec2,b2Vec3=Box2D.Common.Math.b2Vec3,b2AABB=Box2D.Collision.b2AABB,b2Bound=Box2D.Collision.b2Bound,b2BoundValues=Box2D.Collision.b2BoundValues,b2Collision=Box2D.Collision.b2Collision,b2ContactID=Box2D.Collision.b2ContactID,b2ContactPoint=Box2D.Collision.b2ContactPoint,b2Distance=Box2D.Collision.b2Distance,b2DistanceInput=Box2D.Collision.b2DistanceInput,b2DistanceOutput=Box2D.Collision.b2DistanceOutput,b2DistanceProxy=Box2D.Collision.b2DistanceProxy,b2DynamicTree=Box2D.Collision.b2DynamicTree,b2DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,b2DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,b2DynamicTreePair=Box2D.Collision.b2DynamicTreePair,b2Manifold=Box2D.Collision.b2Manifold,b2ManifoldPoint=Box2D.Collision.b2ManifoldPoint,b2Point=Box2D.Collision.b2Point,b2RayCastInput=Box2D.Collision.b2RayCastInput,b2RayCastOutput=Box2D.Collision.b2RayCastOutput,b2Segment=Box2D.Collision.b2Segment,b2SeparationFunction=Box2D.Collision.b2SeparationFunction,b2Simplex=Box2D.Collision.b2Simplex,b2SimplexCache=Box2D.Collision.b2SimplexCache,b2SimplexVertex=Box2D.Collision.b2SimplexVertex,b2TimeOfImpact=Box2D.Collision.b2TimeOfImpact,b2TOIInput=Box2D.Collision.b2TOIInput,b2WorldManifold=Box2D.Collision.b2WorldManifold,ClipVertex=Box2D.Collision.ClipVertex,Features=Box2D.Collision.Features,IBroadPhase=Box2D.Collision.IBroadPhase,b2Joint=Box2D.Dynamics.Joints.b2Joint,b2JointDef=Box2D.Dynamics.Joints.b2JointDef,b2JointEdge=Box2D.Dynamics.Joints.b2JointEdge,b2LineJoint=Box2D.Dynamics.Joints.b2LineJoint,b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,b2MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,b2PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,b2RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,b2WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef,b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,b2FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,b2FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef